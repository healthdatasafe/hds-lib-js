var HDSLib;(()=>{var e={196:(e,t,r)=>{const{deepFreeze:o}=r(413),s={streams:r(876),authorizations:r(763),itemsDefs:r(697)};class n{#e;#t;laziliyLoadedMap;constructor(e){this.#e=e,this.laziliyLoadedMap={}}async load(){const e=await fetch(this.#e),t=await e.text(),r=JSON.parse(t);this.#t=r;for(const[e,t]of Object.entries(this.#t.items))t.key=e;o(this.#t)}get modelData(){if(!this.#t)throw new Error("Model not loaded call `await model.load()` first.");return this.#t}}for(const[e,t]of Object.entries(s))Object.defineProperty(n.prototype,e,{get:function(){return this.laziliyLoadedMap[e]||(this.laziliyLoadedMap[e]=new t(this)),this.laziliyLoadedMap[e]}});e.exports=n},413:e=>{e.exports={deepFreeze:function e(t){const r=Reflect.ownKeys(t);for(const o of r){const r=t[o];(r&&"object"==typeof r||"function"==typeof r)&&e(r)}return Object.freeze(t)}}},697:(e,t,r)=>{const o=r(831);e.exports=class{#r;#o;#s;constructor(e){this.#r=e,this.#o={},this.#s={},function(e,t){for(const r of Object.values(e)){const e=[];r.eventType?e.push(r.eventType):e.push(...Object.keys(r.variations.eventType));for(const o of e){const e=r.streamId+":"+o;if(t[e])throw new Error(`Duplicate streamId + eventType "${e}" for item ${JSON.stringify(r)}`);t[e]=r}}}(this.#r.modelData.items,this.#s)}forKey(e,t=!0){if(this.#o[e])return this.#o[e];const r=this.#r.modelData.items[e];if(!r){if(t)throw new Error("Cannot find item definition with key: "+e);return null}return this.#o[e]=new o(e,r),this.#o[e]}forEvent(e,t=!0){const r=[];for(const t of e.streamIds){const o=t+":"+e.type,s=this.#s[o];s&&r.push(s)}if(0===r.length){if(t)throw new Error("Cannot find definition for event: "+JSON.stringify(e));return null}if(r.length>1)throw new Error(`Found multiple matching definitions "${r.map(e=>e.key).join(", ")}" for event: ${JSON.stringify(e)}`);return this.forKey(r[0].key,t)}}},763:e=>{function t(e,t){return e===t||"manage"===e||"contribute"===e&&"manage"!==t}function r(e,t){if(e===t)return e;const r=[e,t].sort();if(r.includes("manage"))return"manage";if("contribute"===r[0])return"contribute";if("writeOnly"===r[1])return"contribute";throw new Error(`Invalid level found level1: ${e}, level2 ${t}`)}e.exports=class{#r;constructor(e){this.#r=e}forItemKeys(e,o={}){const s={defaultLevel:"read",preRequest:[],includeDefaultName:!0};Object.assign(s,o);const n={};for(const e of s.preRequest){if(!e.streamId)throw new Error(`Missing streamId in options.preRequest item: ${JSON.stringify(e)}`);if(s.includeDefaultName&&!e.defaultName){const t=this.#r.streams.getDataById(e.streamId,!1);if(!t)throw new Error(`No "defaultName" in options.preRequest item: ${JSON.stringify(e)} and cannot find matching streams in default list`);e.defaultName=t.name}if(!s.includeDefaultName&&e.defaultName)throw new Error(`Do not include defaultName when not included explicitely on ${JSON.stringify(e)}`);e.level||(e.level=s.defaultLevel),n[e.streamId]=e}for(const t of e){const e=this.#r.itemsDefs.forKey(t).data.streamId;if(n[e])n[e].level=r(n[e].level,s.defaultLevel);else{const t={streamId:e,level:s.defaultLevel};if(s.includeDefaultName){const r=this.#r.streams.getDataById(e);t.defaultName=r.name}n[e]=t}}for(const e of Object.values(n)){const r=this.#r.streams.getParentsIds(e.streamId,!1);for(const o of r){const r=n[o];r&&t(r.level,e.level)&&delete n[e.streamId]}}return Object.values(n)}}},831:e=>{e.exports=class{#n;#a;constructor(e,t){this.#a=e,this.#n=t}get eventTypes(){return this.#n.eventType?[this.#n.eventType]:Object.keys(this.#n.variations.eventType)}get key(){return this.#a}get data(){return this.#n}}},876:e=>{function t(e,r){if(e)for(const o of e){if(r[o.id])throw new Error(`Duplicate streamId "${o.id}" for strean ${JSON.stringify(o)}`);r[o.id]=o,t(o.children,r)}}e.exports=class{#r;#i;constructor(e){this.#r=e,this.#i={},t(this.#r.modelData.streams,this.#i)}getNecessaryListForItemKeys(e){const t=[],r=new Map;for(const o of e){const e=this.#r.itemsDefs.forKey(o),s=this.getParentsIds(e.data.streamId,!0,[e.data.streamId]);for(const e of s){if(r.has(e))continue;const o=this.getDataById(e);r.set(e,!0),t.push({id:e,name:o.name,parentId:o.parentId})}}return t}getDataById(e,t=!0){const r=this.#i[e];if(t&&!r)throw new Error(`Stream with id: "${e}" not found`);return r}getParentsIds(e,t=!0,r=[]){const o=this.getDataById(e,t);return o?(null!==o.parentId&&(r.unshift(o.parentId),this.getParentsIds(o.parentId,!0,r)),r):r}}}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{"use strict";r.r(o),r.d(o,{HDSLib:()=>t});var e=r(196);const t={HDSModel:r.n(e)()}})(),HDSLib=o})();
//# sourceMappingURL=hds-lib.js.map