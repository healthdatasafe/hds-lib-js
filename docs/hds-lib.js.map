{"version":3,"file":"hds-lib.js","mappings":"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","sources":["webpack://HDSLib/./src/HDSModel.js","webpack://HDSLib/./src/HDSItemDef.js","webpack://HDSLib/webpack/bootstrap","webpack://HDSLib/webpack/runtime/define property getters","webpack://HDSLib/webpack/runtime/hasOwnProperty shorthand","webpack://HDSLib/webpack/runtime/make namespace object","webpack://HDSLib/./src/index-webpack.js"],"sourcesContent":["const HDSItemDef = require('./HDSItemDef');\n\nclass HDSModel {\n  /**\n   * JSON definition file\n   * Should come from service/info assets.hds-model\n   * @type {string}\n   */\n  #modelUrl;\n\n  /**\n   * Content on model definitions\n   * @type {object}\n   */\n  #modelData;\n\n  /**\n   * ItemDefs Cache\n   * KeyValue of itemsDefs\n   */\n  #itemsDefs;\n\n  /**\n   * get itemsDefs by streamId and eventType\n   */\n  #modelDataByStreamIdEventTypes;\n\n  /**\n   * streamsById\n   * Map to find streams by Id\n   */\n  #modelStreamsById;\n\n  /**\n   * JSON definition file\n   * Should come from service/info assets.hds-model\n   * @type {string}\n   */\n  constructor (modelUrl) {\n    this.#modelUrl = modelUrl;\n    this.#itemsDefs = {};\n    this.#modelDataByStreamIdEventTypes = {};\n    this.#modelStreamsById = {};\n  }\n\n  /**\n   * Load model definitions\n   */\n  async load () {\n    const response = await fetch(this.#modelUrl);\n    const resultText = await response.text();\n    const result = JSON.parse(resultText);\n    this.#modelData = result;\n    loadModelDataByStreamIdEventTypes(this.#modelData.items, this.#modelDataByStreamIdEventTypes);\n    loadModelStreamsById(this.#modelData.streams, this.#modelStreamsById);\n    deepFreeze(this.#modelData); // make sure it cannot be modified\n  }\n\n  /**\n   * get item for a key\n   * @param {string} key\n   * @param {boolean} [throwErrorIfNotFound] default `true`\n   */\n  itemDefForKey (key, throwErrorIfNotFound = true) {\n    if (this.#itemsDefs[key]) return this.#itemsDefs[key];\n    const defData = this.#modelData.items[key];\n    if (!defData) {\n      if (throwErrorIfNotFound) throw new Error('Cannot find item definition with key: ' + key);\n      return null;\n    }\n    this.#itemsDefs[key] = new HDSItemDef(key, defData);\n    return this.#itemsDefs[key];\n  }\n\n  /**\n   * get a definition for an event\n   * @param {Event} event\n   * @param {boolean} [throwErrorIfNotFound] default `true`\n   */\n  itemDefForEvent (event, throwErrorIfNotFound = true) {\n    const candidates = [];\n    for (const streamId of event.streamIds) {\n      const keyStreamIdEventType = streamId + ':' + event.type;\n      const candidate = this.#modelDataByStreamIdEventTypes[keyStreamIdEventType];\n      if (candidate) candidates.push(candidate);\n    }\n    if (candidates.length === 0) {\n      if (throwErrorIfNotFound) throw new Error('Cannot find definition for event: ' + JSON.stringify(event));\n      return null;\n    }\n    if (candidates.length > 1) {\n      throw new Error(`Found multiple matching definitions \"${candidates.map(c => (c.key)).join(', ')}\" for event: ${JSON.stringify(event)}`);\n    }\n    return this.itemDefForKey(candidates[0].key, throwErrorIfNotFound);\n  }\n\n  /**\n   * Get a list of streams to be created for usage of these keys (whithout children)\n   * @param {Array<string>} itemKeys\n   */\n  streamsGetNecessaryListForItemKeys (itemKeys) {\n    const result = [];\n    const streams = new Map(); // tempMap to keep streams already in\n    for (const itemKey of itemKeys) {\n      const itemDef = this.itemDefForKey(itemKey);\n      const streamParentIds = this.streamGetParentsIds(itemDef.data.streamId, true, [itemDef.data.streamId]);\n      for (const streamId of streamParentIds) {\n        if (streams.has(streamId)) continue;\n        const stream = this.streamDataGetById(streamId);\n        streams.set(streamId, true); // just to flag\n        result.push({\n          id: streamId,\n          name: stream.name, // to be translated\n          parentId: stream.parentId\n        });\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Get stream Data by Id;\n   * @param {string} streamId\n   */\n  streamDataGetById (streamId, throwErrorIfNotFound = true) {\n    const streamData = this.#modelStreamsById[streamId];\n    if (throwErrorIfNotFound && !streamData) throw new Error(`Stream with id: \"${streamId}\" not found`);\n    return streamData;\n  }\n\n  /**\n   * Get all parents id;\n   * @param {string} streamId\n   * @param {boolean} [throwErrorIfNotFound] default `true`\n   * @param {Array} [initialArray] - a pre-filled array\n   */\n  streamGetParentsIds (streamId, throwErrorIfNotFound = true, initialArray = []) {\n    const streamData = this.streamDataGetById(streamId, throwErrorIfNotFound);\n    if (streamData.parentId !== null) {\n      initialArray.unshift(streamData.parentId);\n      this.streamGetParentsIds(streamData.parentId, true, initialArray);\n    }\n    return initialArray;\n  }\n}\n\nmodule.exports = HDSModel;\n\n/**\n * Recursively make immutable an object\n * @param {*} object\n * @returns {*}\n */\nfunction deepFreeze (object) {\n  // Retrieve the property names defined on object\n  const propNames = Reflect.ownKeys(object);\n\n  // Freeze properties before freezing self\n  for (const name of propNames) {\n    const value = object[name];\n\n    if ((value && typeof value === 'object') || typeof value === 'function') {\n      deepFreeze(value);\n    }\n  }\n\n  return Object.freeze(object);\n}\n\n/**\n * @private\n * Add key to model items and\n * load modeldata item into modelDataByStreamIdEventTypes for fast search\n */\nfunction loadModelDataByStreamIdEventTypes (model, map) {\n  for (const [key, item] of Object.entries(model)) {\n    // add key to item\n    item.key = key;\n    const eventTypes = [];\n    if (item.eventType) {\n      eventTypes.push(item.eventType);\n    } else {\n      eventTypes.push(...Object.keys(item.variations.eventType));\n    }\n    for (const eventType of eventTypes) {\n      const keyStreamIdEventType = item.streamId + ':' + eventType;\n      if (map[keyStreamIdEventType]) throw new Error(`Duplicate streamId + eventType \"${keyStreamIdEventType}\" for item ${JSON.stringify(item)}`);\n      map[keyStreamIdEventType] = item;\n    }\n  }\n}\n\n/**\n * @param {Array<stream>} streams \n * @param {Object<string, stream>} map - key value map\n */\nfunction loadModelStreamsById (streams, map) {\n  if (!streams) return;\n  for (const stream of streams) {\n    if (map[stream.id]) throw new Error(`Duplicate streamId \"${stream.id}\" for strean ${JSON.stringify(stream)}`);\n    map[stream.id] = stream;\n    loadModelStreamsById(stream.children, map);\n  }\n}","class HDSItemDef {\n  #data;\n  #key;\n\n  constructor (key, definitionData) {\n    this.#key = key;\n    this.#data = definitionData;\n  }\n\n  get eventTypes () {\n    if (this.#data.eventType) return [this.#data.eventType];\n    return Object.keys(this.#data.variations.eventType);\n  }\n\n  get key () {\n    return this.#key;\n  }\n\n  get data () {\n    return this.#data;\n  }\n}\n\nmodule.exports = HDSItemDef;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Export for webpack build\n */\nexport const HDSModel = require('./HDSModel');\n"],"names":["HDSItemDef","deepFreeze","object","propNames","Reflect","ownKeys","name","value","Object","freeze","loadModelStreamsById","streams","map","stream","id","Error","JSON","stringify","children","module","exports","constructor","modelUrl","this","load","response","fetch","resultText","text","result","parse","model","key","item","entries","eventTypes","eventType","push","keys","variations","keyStreamIdEventType","streamId","loadModelDataByStreamIdEventTypes","items","itemDefForKey","throwErrorIfNotFound","defData","itemDefForEvent","event","candidates","streamIds","type","candidate","length","c","join","streamsGetNecessaryListForItemKeys","itemKeys","Map","itemKey","itemDef","streamParentIds","streamGetParentsIds","data","has","streamDataGetById","set","parentId","streamData","initialArray","unshift","definitionData","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","HDSModel"],"sourceRoot":""}