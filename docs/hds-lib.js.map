{"version":3,"file":"hds-lib.js","mappings":"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","sources":["webpack://HDSLib/./src/HDSModel.js","webpack://HDSLib/./src/HDSItemDef.js","webpack://HDSLib/webpack/bootstrap","webpack://HDSLib/webpack/runtime/define property getters","webpack://HDSLib/webpack/runtime/hasOwnProperty shorthand","webpack://HDSLib/webpack/runtime/make namespace object","webpack://HDSLib/./src/index-webpack.js"],"sourcesContent":["const HDSItemDef = require('./HDSItemDef');\n\nclass HDSModel {\n  /**\n   * JSON definition file\n   * Should come from service/info assets.hds-model\n   * @type {string}\n   */\n  #modelUrl;\n\n  /**\n   * Content on model definitions\n   * @type {object}\n   */\n  #modelData;\n\n  /**\n   * ItemDefs Cache\n   * KeyValue of itemsDefs\n   */\n  #itemsDefs;\n\n  /**\n   * get itemsDefs by streamId and eventType\n   */\n  #modelDataByStreamIdEventTypes;\n\n  /**\n   * JSON definition file\n   * Should come from service/info assets.hds-model\n   * @type {string}\n   */\n  constructor (modelUrl) {\n    this.#modelUrl = modelUrl;\n    this.#itemsDefs = {};\n    this.#modelDataByStreamIdEventTypes = {};\n  }\n\n  /**\n   * Load model definitions\n   */\n  async load () {\n    const response = await fetch(this.#modelUrl);\n    const resultText = await response.text();\n    const result = JSON.parse(resultText);\n    this.#modelData = result;\n    loadModelDataByStreamIdEventTypes(this.#modelData.items, this.#modelDataByStreamIdEventTypes);\n    deepFreeze(this.#modelData); // make sure it cannot be modified\n  }\n\n  /**\n   * get item for a key\n   * @param {string} key\n   * @param {boolean} [throwErrorIfNotFound] default `true`\n   */\n  itemDefForKey (key, throwErrorIfNotFound = true) {\n    if (this.#itemsDefs[key]) return this.#itemsDefs[key];\n    const defData = this.#modelData.items[key];\n    if (!defData) {\n      if (throwErrorIfNotFound) throw new Error('Cannot find item definition with key: ' + key);\n      return null;\n    }\n    this.#itemsDefs[key] = new HDSItemDef(key, defData);\n    return this.#itemsDefs[key];\n  }\n\n  /**\n   * get a definition for an event\n   * @param {Event} event\n   * @param {boolean} [throwErrorIfNotFound] default `true`\n   */\n  itemDefForEvent (event, throwErrorIfNotFound = true) {\n    const candidates = [];\n    for (const streamId of event.streamIds) {\n      const keyStreamIdEventType = streamId + ':' + event.type;\n      const candidate = this.#modelDataByStreamIdEventTypes[keyStreamIdEventType];\n      if (candidate) candidates.push(candidate);\n    }\n    if (candidates.length === 0) {\n      if (throwErrorIfNotFound) throw new Error('Cannot find definition for event: ' + JSON.stringify(event));\n      return null;\n    }\n    if (candidates.length > 1) {\n      throw new Error(`Found multiple matching definitions \"${candidates.map(c => (c.key)).join(', ')}\" for event: ${JSON.stringify(event)}`);\n    }\n    return this.itemDefForKey(candidates[0].key, throwErrorIfNotFound);\n  }\n}\n\nmodule.exports = HDSModel;\n\n/**\n * Recursively make immutable an object\n * @param {*} object\n * @returns {*}\n */\nfunction deepFreeze (object) {\n  // Retrieve the property names defined on object\n  const propNames = Reflect.ownKeys(object);\n\n  // Freeze properties before freezing self\n  for (const name of propNames) {\n    const value = object[name];\n\n    if ((value && typeof value === 'object') || typeof value === 'function') {\n      deepFreeze(value);\n    }\n  }\n\n  return Object.freeze(object);\n}\n\n/**\n * @private\n * Add key to model items and\n * load modeldata item into modelDataByStreamIdEventTypes for fast search\n */\nfunction loadModelDataByStreamIdEventTypes (model, map) {\n  for (const [key, item] of Object.entries(model)) {\n    // add key to item\n    item.key = key;\n    const eventTypes = [];\n    if (item.eventType) {\n      eventTypes.push(item.eventType);\n    } else {\n      eventTypes.push(...Object.keys(item.variations.eventType));\n    }\n    for (const eventType of eventTypes) {\n      const keyStreamIdEventType = item.streamId + ':' + eventType;\n      if (map[keyStreamIdEventType]) throw new Error(`Duplicate sreamId + eventType \"${keyStreamIdEventType}\" for item ${JSON.stringify(item)}`);\n      map[keyStreamIdEventType] = item;\n    }\n  }\n}\n","class HDSItemDef {\n  #data;\n  #key;\n\n  constructor (key, definitionData) {\n    this.#key = key;\n    this.#data = definitionData;\n  }\n\n  get eventTypes () {\n    if (this.#data.eventType) return [this.#data.eventType];\n    return Object.keys(this.#data.variations.eventType);\n  }\n\n  get key () {\n    return this.#key;\n  }\n\n  get data () {\n    return this.#data;\n  }\n}\n\nmodule.exports = HDSItemDef;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Export for webpack build\n */\nexport const HDSModel = require('./HDSModel');\n"],"names":["HDSItemDef","deepFreeze","object","propNames","Reflect","ownKeys","name","value","Object","freeze","module","exports","constructor","modelUrl","this","load","response","fetch","resultText","text","result","JSON","parse","model","map","key","item","entries","eventTypes","eventType","push","keys","variations","keyStreamIdEventType","streamId","Error","stringify","loadModelDataByStreamIdEventTypes","items","itemDefForKey","throwErrorIfNotFound","defData","itemDefForEvent","event","candidates","streamIds","type","candidate","length","c","join","definitionData","data","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","HDSModel"],"sourceRoot":""}