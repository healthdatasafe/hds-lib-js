{"version":3,"file":"hds-lib.js","mappings":"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","sources":["webpack://HDSLib/./js/HDSModel/HDSItemDef.js","webpack://HDSLib/./js/HDSModel/HDSModel-Authorizations.js","webpack://HDSLib/./js/HDSModel/HDSModel-EventTypes.js","webpack://HDSLib/./js/HDSModel/HDSModel-ItemsDefs.js","webpack://HDSLib/./js/HDSModel/HDSModel-Streams.js","webpack://HDSLib/./js/HDSModel/HDSModel.js","webpack://HDSLib/./js/HDSModel/HDSModelInitAndSingleton.js","webpack://HDSLib/./js/HDSModel/internalModelUtils.js","webpack://HDSLib/./js/HDSService.js","webpack://HDSLib/./js/appTemplates/AppClientAccount.js","webpack://HDSLib/./js/appTemplates/AppManagingAccount.js","webpack://HDSLib/./js/appTemplates/Application.js","webpack://HDSLib/./js/appTemplates/Collector.js","webpack://HDSLib/./js/appTemplates/CollectorClient.js","webpack://HDSLib/./js/appTemplates/CollectorInvite.js","webpack://HDSLib/./js/appTemplates/CollectorRequest.js","webpack://HDSLib/./js/appTemplates/appTemplates.js","webpack://HDSLib/./js/errors.js","webpack://HDSLib/./js/index.js","webpack://HDSLib/./js/localizeText.js","webpack://HDSLib/./js/logger.js","webpack://HDSLib/./js/patchedPryv.js","webpack://HDSLib/./js/settings.js","webpack://HDSLib/./js/toolkit/StreamsAutoCreate.js","webpack://HDSLib/./js/toolkit/StreamsTools.js","webpack://HDSLib/./js/toolkit/index.js","webpack://HDSLib/./js/utils.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/Monitor.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/UpdateMethod/EventsTimer.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/UpdateMethod/Socket.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/UpdateMethod/UpdateMethod.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/UpdateMethod/index.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/index.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/lib/Changes.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/lib/updateEvents.js","webpack://HDSLib/./node_modules/@pryv/monitor/src/lib/updateStreams.js","webpack://HDSLib/./node_modules/@pryv/socket.io/src/SocketIO.js","webpack://HDSLib/./node_modules/@pryv/socket.io/src/index.js","webpack://HDSLib/./node_modules/debug/src/browser.js","webpack://HDSLib/./node_modules/debug/src/common.js","webpack://HDSLib/./node_modules/events/events.js","webpack://HDSLib/./node_modules/ms/index.js","webpack://HDSLib/./node_modules/pryv/src/Auth/AuthController.js","webpack://HDSLib/./node_modules/pryv/src/Auth/AuthStates.js","webpack://HDSLib/./node_modules/pryv/src/Auth/LoginMessages.js","webpack://HDSLib/./node_modules/pryv/src/Auth/index.js","webpack://HDSLib/./node_modules/pryv/src/Browser/CookieUtils.js","webpack://HDSLib/./node_modules/pryv/src/Browser/LoginButton.js","webpack://HDSLib/./node_modules/pryv/src/Browser/index.js","webpack://HDSLib/./node_modules/pryv/src/Connection.js","webpack://HDSLib/./node_modules/pryv/src/Service.js","webpack://HDSLib/./node_modules/pryv/src/ServiceAssets.js","webpack://HDSLib/./node_modules/pryv/src/index.js","webpack://HDSLib/./node_modules/pryv/src/lib/PryvError.js","webpack://HDSLib/./node_modules/pryv/src/lib/buildSearchParams.js","webpack://HDSLib/./node_modules/pryv/src/lib/getEventStreamed.js","webpack://HDSLib/./node_modules/pryv/src/lib/json-parser.js","webpack://HDSLib/./node_modules/pryv/src/utils.js","webpack://HDSLib/./node_modules/short-unique-id/dist/short-unique-id.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/contrib/has-cors.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/contrib/parseqs.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/contrib/parseuri.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/globals.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/index.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/socket.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/transport.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/transports/index.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/transports/polling-fetch.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/transports/polling-xhr.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/transports/polling.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/transports/websocket.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/transports/webtransport.js","webpack://HDSLib/./node_modules/engine.io-client/build/cjs/util.js","webpack://HDSLib/./node_modules/engine.io-parser/build/cjs/commons.js","webpack://HDSLib/./node_modules/engine.io-parser/build/cjs/contrib/base64-arraybuffer.js","webpack://HDSLib/./node_modules/engine.io-parser/build/cjs/decodePacket.browser.js","webpack://HDSLib/./node_modules/engine.io-parser/build/cjs/encodePacket.browser.js","webpack://HDSLib/./node_modules/engine.io-parser/build/cjs/index.js","webpack://HDSLib/./node_modules/socket.io-client/build/cjs/contrib/backo2.js","webpack://HDSLib/./node_modules/socket.io-client/build/cjs/index.js","webpack://HDSLib/./node_modules/socket.io-client/build/cjs/manager.js","webpack://HDSLib/./node_modules/socket.io-client/build/cjs/on.js","webpack://HDSLib/./node_modules/socket.io-client/build/cjs/socket.js","webpack://HDSLib/./node_modules/socket.io-client/build/cjs/url.js","webpack://HDSLib/./node_modules/socket.io-parser/build/cjs/binary.js","webpack://HDSLib/./node_modules/socket.io-parser/build/cjs/index.js","webpack://HDSLib/./node_modules/socket.io-parser/build/cjs/is-binary.js","webpack://HDSLib/./node_modules/@socket.io/component-emitter/lib/esm/index.js","webpack://HDSLib/webpack/bootstrap","webpack://HDSLib/webpack/runtime/define property getters","webpack://HDSLib/webpack/runtime/hasOwnProperty shorthand","webpack://HDSLib/webpack/runtime/make namespace object","webpack://HDSLib/webpack/startup"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSItemDef = void 0;\nconst localizeText_1 = require(\"../localizeText\");\nclass HDSItemDef {\n    #data;\n    #key;\n    constructor(key, definitionData) {\n        this.#key = key;\n        this.#data = definitionData;\n    }\n    get eventTypes() {\n        if (this.#data.eventType)\n            return [this.#data.eventType];\n        return this.#data.variations.eventType.options.map((o) => o.value);\n    }\n    get key() {\n        return this.#key;\n    }\n    get data() {\n        return this.#data;\n    }\n    /** label Localized */\n    get label() {\n        return (0, localizeText_1.localizeText)(this.#data.label);\n    }\n    /** description Localized */\n    get description() {\n        return (0, localizeText_1.localizeText)(this.#data.description);\n    }\n    /**\n     * a template event with eventType and streamIds\n     * // TODO handle variations\n     */\n    eventTemplate() {\n        return {\n            streamIds: [this.#data.streamId],\n            type: this.eventTypes[0]\n        };\n    }\n}\nexports.HDSItemDef = HDSItemDef;\n//# sourceMappingURL=HDSItemDef.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSModelAuthorizations = void 0;\n/**\n * Authorizations - Extension of HDSModel\n */\nclass HDSModelAuthorizations {\n    /**\n     * Model instance\n     */\n    #model;\n    constructor(model) {\n        this.#model = model;\n    }\n    /**\n     * Get minimal Authorization set for itemKeys\n     * /!\\ Does not handle requests with streamId = \"*\"\n     */\n    forItemKeys(itemKeys, options = {}) {\n        const opts = {\n            defaultLevel: 'read',\n            preRequest: [],\n            includeDefaultName: true\n        };\n        Object.assign(opts, options);\n        const streamsRequested = {};\n        for (const pre of opts.preRequest) {\n            if (!pre.streamId)\n                throw new Error(`Missing streamId in options.preRequest item: ${JSON.stringify(pre)}`);\n            // complete pre with defaultName if missing\n            if (opts.includeDefaultName && !pre.defaultName) {\n                // try to get it from streams Data\n                const stream = this.#model.streams.getDataById(pre.streamId, false);\n                if (stream) {\n                    pre.defaultName = stream.name;\n                }\n                else {\n                    throw new Error(`No \"defaultName\" in options.preRequest item: ${JSON.stringify(pre)} and cannot find matching streams in default list`);\n                }\n            }\n            // check there is no defaultName if not required\n            if (!opts.includeDefaultName) {\n                if (pre.defaultName)\n                    throw new Error(`Do not include defaultName when not included explicitely on ${JSON.stringify(pre)}`);\n            }\n            // add default level\n            if (!pre.level) {\n                pre.level = opts.defaultLevel;\n            }\n            streamsRequested[pre.streamId] = pre;\n        }\n        // add streamId not already in\n        for (const itemKey of itemKeys) {\n            const itemDef = this.#model.itemsDefs.forKey(itemKey);\n            const streamId = itemDef.data.streamId;\n            if (!streamsRequested[streamId]) { // new streamId\n                const auth = { streamId, level: opts.defaultLevel };\n                if (opts.includeDefaultName) {\n                    const stream = this.#model.streams.getDataById(streamId);\n                    auth.defaultName = stream.name;\n                }\n                streamsRequested[streamId] = auth;\n            }\n            else { // existing just adapt level\n                streamsRequested[streamId].level = mixAuthorizationLevels(streamsRequested[streamId].level, opts.defaultLevel);\n            }\n        }\n        // remove all permissions with a parent having identical or higher level\n        for (const auth of Object.values(streamsRequested)) {\n            const parents = this.#model.streams.getParentsIds(auth.streamId, false);\n            for (const parent of parents) {\n                const found = streamsRequested[parent];\n                if (found && authorizationOverride(found.level, auth.level)) {\n                    // delete entry\n                    delete streamsRequested[auth.streamId];\n                    // break loop\n                    continue;\n                }\n            }\n        }\n        return Object.values(streamsRequested);\n    }\n}\nexports.HDSModelAuthorizations = HDSModelAuthorizations;\n/**\n * Authorization level1 (parent) does override level2\n * Return \"true\" if identical or level1 == \"manage\"\n */\nfunction authorizationOverride(level1, level2) {\n    if (level1 === level2)\n        return true;\n    if (level1 === 'manage')\n        return true;\n    if (level1 === 'contribute' && level2 !== 'manage')\n        return true;\n    return false;\n}\n/**\n * Given two authorization level, give the resulting one\n */\nfunction mixAuthorizationLevels(level1, level2) {\n    if (level1 === level2)\n        return level1;\n    // sort level in orders [ 'contribute', 'manage', 'read', 'writeOnly' ]\n    const levels = [level1, level2].sort();\n    if (levels.includes('manage'))\n        return 'manage'; // any & manage\n    if (levels[0] === 'contribute')\n        return 'contribute'; // read ore writeOnly & contribute\n    if (levels[1] === 'writeOnly')\n        return 'contribute'; // mix read & writeOnly\n    /* c8 ignore next */ // error if there .. 'read' & 'read' should have already be found\n    throw new Error(`Invalid level found level1: ${level1}, level2 ${level2}`);\n}\n//# sourceMappingURL=HDSModel-Authorizations.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSModelEventTypes = void 0;\n/**\n * Streams - Extension of HDSModel\n */\nclass HDSModelEventTypes {\n    /**\n     * Model instance\n     */\n    #model;\n    constructor(model) {\n        this.#model = model;\n    }\n    getEventTypeDefinition(eventType) {\n        return this.#model.modelData.eventTypes.types[eventType];\n    }\n    getEventTypeExtra(eventType) {\n        return this.#model.modelData.eventTypes.extras[eventType];\n    }\n    getEventTypeSymbol(eventType) {\n        return this.#model.modelData.eventTypes.extras[eventType]?.symbol || null;\n    }\n}\nexports.HDSModelEventTypes = HDSModelEventTypes;\n//# sourceMappingURL=HDSModel-EventTypes.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSModelItemsDefs = void 0;\nconst HDSItemDef_1 = require(\"./HDSItemDef\");\n/**\n * ItemsDefs - Extension of HDSModel\n */\nclass HDSModelItemsDefs {\n    /**\n     * Model instance\n     */\n    #model;\n    /**\n     * ItemDefs Cache\n     * KeyValue of itemsDefs\n     */\n    #itemsDefs;\n    /**\n     * get itemsData by streamId and eventType\n     */\n    #modelDataByStreamIdEventTypes;\n    constructor(model) {\n        this.#model = model;\n        this.#itemsDefs = {};\n        this.#modelDataByStreamIdEventTypes = {};\n        loadModelDataByStreamIdEventTypes(this.#model.modelData.items, this.#modelDataByStreamIdEventTypes);\n    }\n    /**\n     * get all itemDefs\n     */\n    getAll() {\n        const res = [];\n        for (const key of Object.keys(this.#model.modelData.items)) {\n            res.push(this.forKey(key));\n        }\n        return res;\n    }\n    /**\n     * get item for a key\n     */\n    forKey(key, throwErrorIfNotFound = true) {\n        if (this.#itemsDefs[key])\n            return this.#itemsDefs[key];\n        const defData = this.#model.modelData.items[key];\n        if (!defData) {\n            if (throwErrorIfNotFound)\n                throw new Error('Cannot find item definition with key: ' + key);\n            return null;\n        }\n        this.#itemsDefs[key] = new HDSItemDef_1.HDSItemDef(key, defData);\n        return this.#itemsDefs[key];\n    }\n    /**\n     * get a definition for an event\n     */\n    forEvent(event, throwErrorIfNotFound = true) {\n        const candidates = [];\n        for (const streamId of event.streamIds) {\n            const keyStreamIdEventType = streamId + ':' + event.type;\n            const candidate = this.#modelDataByStreamIdEventTypes[keyStreamIdEventType];\n            if (candidate)\n                candidates.push(candidate);\n        }\n        if (candidates.length === 0) {\n            if (throwErrorIfNotFound)\n                throw new Error('Cannot find definition for event: ' + JSON.stringify(event));\n            return null;\n        }\n        if (candidates.length > 1) {\n            throw new Error(`Found multiple matching definitions \"${candidates.map(c => (c.key)).join(', ')}\" for event: ${JSON.stringify(event)}`);\n        }\n        return this.forKey(candidates[0].key, throwErrorIfNotFound);\n    }\n}\nexports.HDSModelItemsDefs = HDSModelItemsDefs;\n/**\n * Add key to model items and\n * load modeldata item into modelDataByStreamIdEventTypes for fast search\n */\nfunction loadModelDataByStreamIdEventTypes(model, map) {\n    for (const item of Object.values(model)) {\n        const eventTypes = [];\n        if (item.eventType) {\n            eventTypes.push(item.eventType);\n        }\n        else {\n            const types = item.variations.eventType.options.map((o) => o.value);\n            eventTypes.push(...types);\n        }\n        for (const eventType of eventTypes) {\n            const keyStreamIdEventType = item.streamId + ':' + eventType;\n            if (map[keyStreamIdEventType]) {\n                // should be tested with a faulty model\n                throw new Error(`Duplicate streamId + eventType \"${keyStreamIdEventType}\" for item ${JSON.stringify(item)}`);\n            }\n            map[keyStreamIdEventType] = item;\n        }\n    }\n}\n//# sourceMappingURL=HDSModel-ItemsDefs.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSModelStreams = void 0;\nconst internalModelUtils_1 = require(\"./internalModelUtils\");\n/**\n * Streams - Extension of HDSModel\n */\nclass HDSModelStreams {\n    /**\n     * Model instance\n     */\n    #model;\n    /**\n     * streamsById\n     * Map to find streams by Id\n     */\n    #modelStreamsById;\n    constructor(model) {\n        this.#model = model;\n        this.#modelStreamsById = {};\n        loadModelStreamsById(this.#model.modelData.streams, this.#modelStreamsById);\n    }\n    /**\n     * Get a list of streams to be created for usage of these keys (whithout children)\n     */\n    getNecessaryListForItems(itemKeysOrDefs, params = {}) {\n        const itemDefs = (0, internalModelUtils_1.itemKeysOrDefsToDefs)(this.#model, itemKeysOrDefs);\n        const knowExistingStreamsIds = params.knowExistingStreamsIds || [];\n        const nameProperty = params.nameProperty || 'name';\n        const result = [];\n        const streams = new Map(); // tempMap to keep streams already in\n        for (const knowStreamId of knowExistingStreamsIds) {\n            const strs = this.getParentsIds(knowStreamId, false, [knowStreamId]).reverse();\n            for (const strId of strs) {\n                streams.set(strId, true);\n            }\n        }\n        for (const itemDef of itemDefs) {\n            const streamParentIds = this.getParentsIds(itemDef.data.streamId, true, [itemDef.data.streamId]);\n            const resultToBeReversed = [];\n            for (let i = streamParentIds.length - 1; i > -1; i--) { // loop reverse to break as soon as we find an existing stream\n                const streamId = streamParentIds[i];\n                if (streams.has(streamId))\n                    break;\n                const stream = this.getDataById(streamId);\n                streams.set(streamId, true); // just to flag\n                const itemStream = { id: streamId, parentId: stream.parentId };\n                if (nameProperty !== 'none') {\n                    itemStream[nameProperty] = stream.name; // to be translated\n                }\n                resultToBeReversed.push(itemStream);\n            }\n            // result need to be reversed in order to get parents created before\n            result.push(...resultToBeReversed.reverse());\n        }\n        return result;\n    }\n    /**\n     * Get stream Data by Id;\n     */\n    getDataById(streamId, throwErrorIfNotFound = true) {\n        const streamData = this.#modelStreamsById[streamId];\n        if (throwErrorIfNotFound && !streamData)\n            throw new Error(`Stream with id: \"${streamId}\" not found`);\n        return streamData;\n    }\n    /**\n     * Get all parents id;\n     */\n    getParentsIds(streamId, throwErrorIfNotFound = true, initialArray = []) {\n        const streamData = this.getDataById(streamId, throwErrorIfNotFound);\n        if (!streamData)\n            return initialArray;\n        if (streamData.parentId !== null) {\n            initialArray.unshift(streamData.parentId);\n            this.getParentsIds(streamData.parentId, true, initialArray);\n        }\n        return initialArray;\n    }\n}\nexports.HDSModelStreams = HDSModelStreams;\n/**\n * @param streams\n * @param map - key value map\n */\nfunction loadModelStreamsById(streams, map) {\n    if (!streams)\n        return;\n    for (const stream of streams) {\n        if (map[stream.id]) {\n            // should be tested with a faulty model\n            throw new Error(`Duplicate streamId \"${stream.id}\" for strean ${JSON.stringify(stream)}`);\n        }\n        map[stream.id] = stream;\n        loadModelStreamsById(stream.children, map);\n    }\n}\n//# sourceMappingURL=HDSModel-Streams.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSModel = void 0;\nconst errors_1 = require(\"../errors\");\nconst utils_1 = require(\"../utils\");\nconst HDSModel_Streams_1 = require(\"./HDSModel-Streams\");\nconst HDSModel_Authorizations_1 = require(\"./HDSModel-Authorizations\");\nconst HDSModel_ItemsDefs_1 = require(\"./HDSModel-ItemsDefs\");\nconst HDSModel_EventTypes_1 = require(\"./HDSModel-EventTypes\");\nclass HDSModel {\n    /**\n     * JSON definition file URL.\n     * Should come from service/info assets.hds-model\n     */\n    #modelUrl;\n    /** RAW content of model definitions */\n    #modelData;\n    /**\n     * Map of properties loaded \"on demand\"\n     */\n    laziliyLoadedMap = {};\n    /**\n     * @param modelUrl - JSON definition file URL. Should come from service/info assets.hds-model\n     */\n    constructor(modelUrl) {\n        this.#modelUrl = modelUrl;\n        this.laziliyLoadedMap = {};\n        this.#modelData = null;\n    }\n    get isLoaded() {\n        return !!this.#modelData;\n    }\n    /**\n     * Load model definitions\n     */\n    async load(modelUrl = null) {\n        if (modelUrl) {\n            this.#modelUrl = modelUrl;\n        }\n        const response = await fetch(this.#modelUrl);\n        const resultText = await response.text();\n        const result = JSON.parse(resultText);\n        this.#modelData = result;\n        // add key to items before freezing;\n        for (const [key, item] of Object.entries(this.#modelData.items)) {\n            item.key = key;\n        }\n        // make sure it cannot be modified\n        (0, utils_1.deepFreeze)(this.#modelData);\n    }\n    /** RAW model data */\n    get modelData() {\n        if (!this.isLoaded)\n            throwNotLoadedError();\n        return this.#modelData;\n    }\n    get itemsDefs() {\n        if (!this.isLoaded)\n            throwNotLoadedError();\n        if (!this.laziliyLoadedMap.itemsDefs) {\n            this.laziliyLoadedMap.itemsDefs = new HDSModel_ItemsDefs_1.HDSModelItemsDefs(this);\n        }\n        return this.laziliyLoadedMap.itemsDefs;\n    }\n    get streams() {\n        if (!this.isLoaded)\n            throwNotLoadedError();\n        if (!this.laziliyLoadedMap.streams) {\n            this.laziliyLoadedMap.streams = new HDSModel_Streams_1.HDSModelStreams(this);\n        }\n        return this.laziliyLoadedMap.streams;\n    }\n    get authorizations() {\n        if (!this.isLoaded)\n            throwNotLoadedError();\n        if (!this.laziliyLoadedMap.authorizations) {\n            this.laziliyLoadedMap.authorizations = new HDSModel_Authorizations_1.HDSModelAuthorizations(this);\n        }\n        return this.laziliyLoadedMap.authorizations;\n    }\n    get eventTypes() {\n        if (!this.isLoaded)\n            throwNotLoadedError();\n        if (!this.laziliyLoadedMap.eventTypes) {\n            this.laziliyLoadedMap.eventTypes = new HDSModel_EventTypes_1.HDSModelEventTypes(this);\n        }\n        return this.laziliyLoadedMap.eventTypes;\n    }\n}\nexports.HDSModel = HDSModel;\nfunction throwNotLoadedError() {\n    throw new errors_1.HDSLibError('Model not loaded call `HDSLib.initHDSModel()` or `await model.load()` first.');\n}\n//# sourceMappingURL=HDSModel.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getModel = getModel;\nexports.resetModel = resetModel;\nexports.initHDSModel = initHDSModel;\nconst HDSModel_1 = require(\"./HDSModel\");\nconst HDSService_1 = require(\"../HDSService\");\nlet hdsModelInstance = null;\nfunction getModel() {\n    if (hdsModelInstance == null) {\n        hdsModelInstance = new HDSModel_1.HDSModel('');\n    }\n    return hdsModelInstance;\n}\n/**\n * Mostly used during test to unload model\n */\nfunction resetModel() {\n    hdsModelInstance = null;\n}\n/**\n * Initialized model singleton\n */\nasync function initHDSModel() {\n    if (!hdsModelInstance) {\n        getModel();\n    }\n    if (!hdsModelInstance.isLoaded) {\n        const service = new HDSService_1.HDSService();\n        const serviceInfo = await service.info();\n        await hdsModelInstance.load(serviceInfo.assets['hds-model']);\n    }\n    return hdsModelInstance;\n}\n//# sourceMappingURL=HDSModelInitAndSingleton.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.itemKeysOrDefsToDefs = itemKeysOrDefsToDefs;\nexports.itemKeyOrDefToDef = itemKeyOrDefToDef;\nconst HDSItemDef_1 = require(\"./HDSItemDef\");\n/**\n * Some call support either arrays of itemKeys or itemDefs\n * test if they are strings or itemDefs and returns an array of itemDefs\n */\nfunction itemKeysOrDefsToDefs(model, keysOrDefs) {\n    const res = [];\n    for (const keyOrDef of keysOrDefs) {\n        res.push(itemKeyOrDefToDef(model, keyOrDef));\n    }\n    return res;\n}\n/**\n * Some call support either itemKey or itemDef\n * test if string or itemDef and returns an itemDef\n */\nfunction itemKeyOrDefToDef(model, keyOrDef) {\n    if (keyOrDef instanceof HDSItemDef_1.HDSItemDef)\n        return keyOrDef;\n    return model.itemsDefs.forKey(keyOrDef);\n}\n//# sourceMappingURL=internalModelUtils.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSService = void 0;\nconst settings = __importStar(require(\"./settings\"));\nconst patchedPryv_1 = require(\"./patchedPryv\");\n// makes Pryv service aware of default serviceUrl\nclass HDSService extends patchedPryv_1.pryv.Service {\n    constructor(serviceInfoUrl, serviceCustomizations) {\n        serviceInfoUrl = serviceInfoUrl || settings.getServiceInfoURL();\n        super(serviceInfoUrl, serviceCustomizations);\n    }\n}\nexports.HDSService = HDSService;\n//# sourceMappingURL=HDSService.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppClientAccount = void 0;\nconst errors_1 = require(\"../errors\");\nconst patchedPryv_1 = require(\"../patchedPryv\");\nconst Application_1 = require(\"./Application\");\nconst CollectorClient_1 = require(\"./CollectorClient\");\nconst logger = __importStar(require(\"../logger\"));\n/**\n * - applications\n *   - [baseStreamId] \"Root\" stream from this app\n */\nconst MAX_COLLECTORS = 1000;\nclass AppClientAccount extends Application_1.Application {\n    constructor(baseStreamId, connection, appName, features) {\n        super(baseStreamId, connection, appName, features);\n        this.cache.collectorClientsMap = {};\n    }\n    get appSettings() {\n        return {\n            canBePersonnal: true,\n            mustBeMaster: true\n        };\n    }\n    /**\n     * When the app receives a new request for data sharing\n     */\n    async handleIncomingRequest(apiEndpoint, incomingEventId) {\n        // make sure that collectorClientsMap is initialized\n        await this.getCollectorClients();\n        const requesterConnection = new patchedPryv_1.pryv.Connection(apiEndpoint);\n        const accessInfo = await requesterConnection.accessInfo();\n        // check if request is known\n        const collectorClientKey = CollectorClient_1.CollectorClient.keyFromInfo(accessInfo);\n        logger.debug('AppClient:handleIncomingRequest', { collectorClientKey, accessInfo, incomingEventId });\n        if (this.cache.collectorClientsMap[collectorClientKey]) {\n            const collectorClient = this.cache.collectorClientsMap[collectorClientKey];\n            logger.debug('AppClient:handleIncomingRequest found existing', { collectorClient });\n            if (collectorClient.requesterApiEndpoint !== apiEndpoint) {\n                // console.log(' RESET! Found existing collectorClient with a different apiEndpoint', { actual: collectorClient.requesterApiEndpoint, incoming: apiEndpoint });\n                throw new errors_1.HDSLibError('Found existing collectorClient with a different apiEndpoint', { actual: collectorClient.requesterApiEndpoint, incoming: apiEndpoint });\n                // we might consider reseting() in the future;\n                // return await collectorClient.reset(apiEndpoint, incomingEventId, accessInfo);\n            }\n            if (incomingEventId && collectorClient.requesterEventId !== incomingEventId) {\n                throw new errors_1.HDSLibError('Found existing collectorClient with a different eventId', { actual: collectorClient.requesterEventId, incoming: incomingEventId });\n                // console.log(' RESET! Found existing collectorClient with a different eventId', { actual: collectorClient.requesterEventId, incoming: incomingEventId });\n                // we might consider reseting() in the future;\n                // return await collectorClient.reset(apiEndpoint, incomingEventId, accessInfo);\n                // return null;\n            }\n            return collectorClient;\n        }\n        // check if comming form hdsCollector\n        if (!accessInfo?.clientData?.hdsCollector || accessInfo.clientData?.hdsCollector?.version !== 0) {\n            throw new errors_1.HDSLibError('Invalid collector request, cannot find clientData.hdsCollector or wrong version', { clientData: accessInfo?.clientData });\n        }\n        // else create it\n        const collectorClient = await CollectorClient_1.CollectorClient.create(this, apiEndpoint, incomingEventId, accessInfo);\n        this.cache.collectorClientsMap[collectorClient.key] = collectorClient;\n        return collectorClient;\n    }\n    async getCollectorClientByKey(collectorKey) {\n        // ensure collectors are initialized\n        await this.getCollectorClients();\n        return this.cache.collectorClientsMap[collectorKey];\n    }\n    async getCollectorClients(forceRefresh = false) {\n        if (!forceRefresh && this.cache.collectorClientsMapInitialized)\n            return Object.values(this.cache.collectorClientsMap);\n        const apiCalls = [{\n                method: 'accesses.get',\n                params: { includeDeletions: true }\n            }, {\n                method: 'events.get',\n                params: { types: ['request/collector-client-v1'], streams: [this.baseStreamId], limit: MAX_COLLECTORS }\n            }];\n        const [accessesRes, eventRes] = await this.connection.api(apiCalls);\n        const accessHDSCollectorMap = {};\n        for (const access of accessesRes.accesses) {\n            if (access.clientData?.hdsCollectorClient) {\n                accessHDSCollectorMap[access.name] = access;\n            }\n        }\n        for (const event of eventRes.events) {\n            const collectorClient = new CollectorClient_1.CollectorClient(this, event);\n            if (accessHDSCollectorMap[collectorClient.key] != null)\n                collectorClient.accessData = accessHDSCollectorMap[collectorClient.key];\n            // temp process - might be removed\n            await collectorClient.checkConsistency();\n            this.cache.collectorClientsMap[collectorClient.key] = collectorClient;\n        }\n        this.cache.collectorClientsMapInitialized = true;\n        return Object.values(this.cache.collectorClientsMap);\n    }\n    /**\n     * - Check connection validity\n     * - Make sure stream structure exists\n     */\n    async init() {\n        return super.init();\n    }\n}\nexports.AppClientAccount = AppClientAccount;\n//# sourceMappingURL=AppClientAccount.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppManagingAccount = void 0;\nconst short_unique_id_1 = __importDefault(require(\"short-unique-id\"));\nconst Application_1 = require(\"./Application\");\nconst Collector_1 = require(\"./Collector\");\nconst collectorIdGenerator = new short_unique_id_1.default({ dictionary: 'alphanum_lower', length: 7 });\n/**\n * App which manages Collectors\n * A \"Collector\" can be seen as a \"Request\" and set of \"Responses\"\n * - Responses are authorization tokens from individuals\n *\n * The App can create multiple \"collectors e.g. Questionnaires\"\n *\n * Stream structure\n * - applications\n *   - [baseStreamId]  \"Root\" stream for this app\n *     - [baseStreamId]-[collectorsId] Each \"questionnaire\" or \"request for a set of data\" has it's own stream\n *       - [baseStreamId]-[collectorsId]-internal Private stuff not to be shared\n *       - [baseStreamId]-[collectorsId]-public Contains events with the current settings of this app (this stream will be shared in \"read\" with the request)\n *       - [baseStreamId]-[collectorsId]-pending Contains events with \"pending\" requests\n *       - [baseStreamId]-[collectorsId]-inbox Contains events with \"inbox\" requests Will be shared in createOnly\n *       - [baseStreamId]-[collectorsId]-active Contains events with \"active\" users\n *       - [baseStreamId]-[scollectorsId]-errors Contains events with \"revoked\" or \"erroneous\" users\n */\nclass AppManagingAccount extends Application_1.Application {\n    // used by Application.init();\n    get appSettings() {\n        return {\n            canBePersonnal: true,\n            mustBeMaster: true,\n            appNameFromAccessInfo: true // application name will be taken from Access-Info Name\n        };\n    }\n    async init() {\n        await super.init();\n        // -- check if stream structure exists\n        await this.getCollectors();\n        return this;\n    }\n    async getCollectors(forceRefresh) {\n        await this.#updateCollectorsIfNeeded(forceRefresh);\n        return Object.values(this.cache.collectorsMap);\n    }\n    async getCollectorById(id) {\n        await this.#updateCollectorsIfNeeded();\n        return this.cache.collectorsMap[id];\n    }\n    async #updateCollectorsIfNeeded(forceRefresh = false) {\n        if (!forceRefresh && this.cache.collectorsMap)\n            return;\n        if (forceRefresh)\n            await this.loadStreamData();\n        // TODO do not replace the map, but update collectors if streamData has changed and add new collectors\n        const streams = this.streamData.children || [];\n        const collectorsMap = {};\n        for (const stream of streams) {\n            const collector = new Collector_1.Collector(this, stream);\n            collectorsMap[collector.id] = collector;\n        }\n        this.cache.collectorsMap = collectorsMap;\n    }\n    /**\n     * Create an initialized Collector\n     */\n    async createCollector(name) {\n        const collector = await this.createCollectorUnitialized(name);\n        await collector.init();\n        return collector;\n    }\n    /**\n     * Create an un-initialized Collector (mostly used by tests)\n     */\n    async createCollectorUnitialized(name) {\n        const streamId = this.baseStreamId + '-' + collectorIdGenerator.rnd();\n        const params = {\n            id: streamId,\n            name,\n            parentId: this.baseStreamId\n        };\n        const stream = await this.connection.apiOne('streams.create', params, 'stream');\n        // add new stream to streamCache\n        this.streamData.children.push(stream);\n        const collector = new Collector_1.Collector(this, stream);\n        this.cache.collectorsMap[collector.streamId] = collector;\n        return collector;\n    }\n}\nexports.AppManagingAccount = AppManagingAccount;\n//# sourceMappingURL=AppManagingAccount.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Application = void 0;\nconst patchedPryv_1 = require(\"../patchedPryv\");\nconst toolkit_1 = require(\"../toolkit\");\nconst APPS_ROOT_STREAM = 'applications';\n/**\n * Common code for AppClientAccount and AppManagingAccount\n */\nclass Application {\n    /** Pryv.Connection */\n    connection;\n    /** string */\n    baseStreamId;\n    /** string */\n    appName;\n    cache = {};\n    /** ApplicationFeatures */\n    features;\n    /**\n     * Get application stream structure\n     * Initialized at init()\n     * Can be refreshed with loadStreamData\n     */\n    get streamData() {\n        if (!this.cache.streamData)\n            throw new Error('Call .init() first');\n        return this.cache.streamData;\n    }\n    get appSettings() {\n        throw new Error('appSettings must be implemented');\n        // possible return values:\n        /**\n         * return {\n         *  canBePersonnal: true,\n         *  mustBeMaster: true\n         *  appNameFromAccessInfo: true // application name will be taken from Access-Info Name\n         * };\n         */\n    }\n    /**\n     * Create with an apiEnpoint\n     */\n    static async newFromApiEndpoint(baseStreamId, apiEndpoint, appName, features) {\n        const connection = new patchedPryv_1.pryv.Connection(apiEndpoint);\n        // in a static method, \"this\" is the class (here the extending class)\n        return await this.newFromConnection(baseStreamId, connection, appName, features);\n    }\n    /**\n    * Create with an apiEnpoint\n    */\n    static async newFromConnection(baseStreamId, connection, appName, features) {\n        // in a static method \"this\" is the class (here the extending class)\n        const app = new this(baseStreamId, connection, appName, features);\n        await app.init();\n        return app;\n    }\n    /**\n     * @private\n     * use .newFrom...() to create new AppManagingAccount\n     */\n    constructor(baseStreamId, connection, appName, features) {\n        if (!baseStreamId || baseStreamId.length < 2)\n            throw new Error('Missing or too short baseStreamId');\n        this.baseStreamId = baseStreamId;\n        if (appName == null && !this.appSettings.appNameFromAccessInfo) {\n            throw new Error('appName must be given unless appSettings.appNameFromAccessInfo = true');\n        }\n        this.appName = appName || '';\n        this.connection = connection;\n        this.features = Object.assign({ streamsAutoCreate: true }, features);\n        if (this.features.streamsAutoCreate) {\n            toolkit_1.StreamsAutoCreate.attachToConnection(this.connection, undefined);\n        }\n        this.cache = {};\n    }\n    async init() {\n        await createAppStreams(this);\n        return this;\n    }\n    /**\n     * Save anything you want for your app\n     */\n    async setCustomSettings(content) {\n        const currentCustomSettings = await this.getCustomSettings();\n        if (currentCustomSettings != null) { // update\n            const id = this.cache.customSettingsEvent.id;\n            const updatedEvent = await this.connection.apiOne('events.update', { id, update: { content } }, 'event');\n            this.cache.customSettingsEvent = updatedEvent;\n        }\n        else {\n            await this.#createCustomSettings(content);\n        }\n        return this.cache.customSettingsEvent?.content;\n    }\n    /**\n     * @private\n     * Used by getCustomSettings & setCustomSettings\n     */\n    async #createCustomSettings(content) {\n        const createdEvent = await this.connection.apiOne('events.create', { streamIds: [this.baseStreamId], type: 'settings/any', content }, 'event');\n        this.cache.customSettingsEvent = createdEvent;\n    }\n    /**\n     * Get all current settings previously set with setCustomSettings()\n     */\n    async getCustomSettings(forceRefresh = false) {\n        if (forceRefresh || !this.cache.customSettingsEvent) {\n            const customSettingsEvent = (await this.connection.apiOne('events.get', { streams: [this.baseStreamId], types: ['settings/any'], limit: 1 }, 'events'))[0];\n            this.cache.customSettingsEvent = customSettingsEvent;\n        }\n        if (!this.cache.customSettingsEvent) {\n            await this.#createCustomSettings({});\n        }\n        return this.cache.customSettingsEvent?.content;\n    }\n    /**\n     * Update value of a custom setting by its key\n     * @param {*} value if value is `null` key will be deleted\n     */\n    async setCustomSetting(key, value) {\n        const currentCustomSettings = await this.getCustomSettings();\n        if (value === null) {\n            delete currentCustomSettings[key];\n        }\n        else {\n            currentCustomSettings[key] = value;\n        }\n        return this.setCustomSettings(currentCustomSettings);\n    }\n    /**\n     * Force loading of streamData\n     */\n    async loadStreamData() {\n        const streams = (await this.connection.apiOne('streams.get', {}, 'streams'));\n        const streamData = findStreamByid(streams, this.baseStreamId);\n        if (streamData) {\n            this.cache.streamData = streamData;\n        }\n        return streamData;\n    }\n}\nexports.Application = Application;\n// findStream in a tree\nfunction findStreamByid(streams, streamId) {\n    for (const stream of streams) {\n        if (stream.id === streamId)\n            return stream;\n        if (stream.children?.length > 0) {\n            const streamFromChildren = findStreamByid(stream.children, streamId);\n            if (streamFromChildren != null)\n                return streamFromChildren;\n        }\n    }\n    return null;\n}\n// create app Streams\nasync function createAppStreams(app) {\n    // check that connection has a personal or master token or has \"manage\" rights on baseStream\n    const infos = await app.connection.accessInfo();\n    if (app.appSettings.appNameFromAccessInfo) {\n        app.appName = infos.name;\n    }\n    let isPersonalOrMaster = infos.type === 'personal';\n    if (!app.appSettings.canBePersonnal && infos.type === 'personal') {\n        throw new Error('Application should not use a personal token');\n    }\n    if (!isPersonalOrMaster) {\n        const allowPersonalStr = app.appSettings.canBePersonnal ? '\"personal\" or ' : '';\n        if (infos.type !== 'app')\n            throw new Error(`Application requires a ${allowPersonalStr} \"app\" type of access`);\n        const masterFound = infos.permissions.find((p) => (p.streamId === '*' && p.level === 'manage'));\n        isPersonalOrMaster = true;\n        if (app.appSettings.mustBemaster && !masterFound) {\n            throw new Error('Application with \"app\" type of access requires \"master\" token (streamId = \"*\", level = \"manage\")');\n        }\n        if (!masterFound) { // check that app has \"manage\" level on baseStreamId\n            const baseStreamFound = infos.permissions.find((p) => (p.streamId === app.baseStreamId && p.level === 'manage'));\n            if (!baseStreamFound)\n                throw new Error(`Application with \"app\" type of access requires  (streamId = \"${app.baseStreamId}\", level = \"manage\") or master access`);\n        }\n    }\n    // get streamStructure\n    let found = false;\n    try {\n        const streamData = await app.loadStreamData();\n        if (streamData)\n            found = true;\n    }\n    catch (e) {\n        if (e.innerObject?.id !== 'unknown-referenced-resource' || e.innerObject?.data?.id !== app.baseStreamId) {\n            throw e;\n        }\n    }\n    // not found create streams\n    if (!found) {\n        if (!isPersonalOrMaster) {\n            throw new Error('Token has not sufficient right to create App streams. Create them upfront');\n        }\n        const apiCalls = [\n            { method: 'streams.create', params: { id: APPS_ROOT_STREAM, name: 'Applications' } },\n            { method: 'streams.create', params: { id: app.baseStreamId, name: app.appName, parentId: APPS_ROOT_STREAM } }\n        ];\n        const streamCreateResult = await app.connection.api(apiCalls);\n        if (streamCreateResult[1].error)\n            throw new Error('Failed creating app streams ' + JSON.stringify(streamCreateResult[1].error));\n        const stream = streamCreateResult[1].stream;\n        app.cache.streamData = stream;\n    }\n}\n//# sourceMappingURL=Application.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Collector = void 0;\nconst CollectorRequest_1 = require(\"./CollectorRequest\");\nconst errors_1 = require(\"../errors\");\nconst utils_1 = require(\"../utils\");\nconst CollectorInvite_1 = require(\"./CollectorInvite\");\nconst logger = __importStar(require(\"../logger\"));\nconst COLLECTOR_STREAMID_SUFFIXES = {\n    archive: 'archive',\n    internal: 'internal',\n    public: 'public',\n    pending: 'pending',\n    inbox: 'inbox',\n    active: 'active',\n    error: 'error'\n};\nObject.freeze(COLLECTOR_STREAMID_SUFFIXES);\n/**\n * Collector is used by AppManagingAccount\n * A \"Collector\" can be seen as a \"Request\" and set of \"Responses\"\n * - Responses are authorization tokens from individuals\n */\nclass Collector {\n    static STREAMID_SUFFIXES = COLLECTOR_STREAMID_SUFFIXES;\n    static STATUSES = Object.freeze({\n        draft: 'draft',\n        active: 'active',\n        deactivated: 'deactivated'\n    });\n    appManaging;\n    streamId;\n    name;\n    #streamData;\n    #cache;\n    request;\n    /**\n     * @param appManaging\n     * @param streamData\n     */\n    constructor(appManaging, streamData) {\n        this.streamId = streamData.id;\n        this.name = streamData.name;\n        this.appManaging = appManaging;\n        this.#streamData = streamData;\n        this.request = new CollectorRequest_1.CollectorRequest({\n            id: this.id\n        });\n        this.#cache = {\n            initialized: false,\n            invites: {},\n            invitesInitialized: false,\n            invitesInitializing: false,\n            statusEvent: null\n        };\n    }\n    /**\n     * @property {string} id - shortcut for streamId\n     */\n    get id() {\n        return this.streamId;\n    }\n    /**\n     * @property {string} one of 'draft', 'active', 'deactivated'\n     */\n    get statusCode() {\n        if (this.#cache.statusEvent == null)\n            throw new Error('Init Collector first');\n        return this.#cache.statusEvent.content.status;\n    }\n    /**\n     * Fetch online data\n     */\n    async init(forceRefresh = false) {\n        if (!forceRefresh && this.#cache.initialized)\n            return;\n        await this.checkStreamStructure();\n        await this.#loadStatus(forceRefresh);\n        this.#cache.initialized = true;\n    }\n    /**\n     * @type {StatusEvent} - extends PryvEvent with a specific content\n     * @property {Object} content - content\n     * @property {String} content.status - one of 'draft', 'active', 'deactivated'\n     * @property {CollectorRequestData} content.request - app specific data\n     */\n    /**\n     * Load Collector status,\n     * @param forceRefresh - if true, forces fetching the status from the server\n     */\n    async #loadStatus(forceRefresh = false) {\n        if (!forceRefresh && this.#cache.statusEvent)\n            return this.#cache.statusEvent;\n        const params = { types: ['status/collector-v1'], limit: 1, streams: [this.streamIdFor(_a.STREAMID_SUFFIXES.internal)] };\n        const statusEvents = await this.appManaging.connection.apiOne('events.get', params, 'events');\n        if (statusEvents.length === 0) { // non existent set \"draft\" status\n            return this.#setStatus(_a.STATUSES.draft);\n        }\n        this.#cache.statusEvent = statusEvents[0];\n        this.request.loadFromStatusEvent(statusEvents[0]);\n    }\n    /**\n     * Change the status\n     * @param status one of 'draft', 'active', 'deactivated'\n     * @returns {StatusEvent}\n     */\n    async #setStatus(status) {\n        if (!_a.STATUSES[status])\n            throw new errors_1.HDSLibError('Unknown status key', { status });\n        const event = {\n            type: 'status/collector-v1',\n            streamIds: [this.streamIdFor(_a.STREAMID_SUFFIXES.internal)],\n            content: {\n                status,\n                request: this.request.content\n            }\n        };\n        const statusEvent = await this.appManaging.connection.apiOne('events.create', event, 'event');\n        this.#cache.statusEvent = statusEvent;\n        this.request.loadFromStatusEvent(statusEvent);\n        return this.#cache.statusEvent;\n    }\n    async save() {\n        if (this.statusCode !== _a.STATUSES.draft)\n            throw new Error(`Cannot save when status = \"${this.statusCode}\".`);\n        return await this.#setStatus(_a.STATUSES.draft);\n    }\n    async publish() {\n        const publicEventData = {\n            type: 'request/collector-v1',\n            streamIds: [this.streamIdFor(_a.STREAMID_SUFFIXES.public)],\n            content: this.request.content\n        };\n        await this.appManaging.connection.apiOne('events.create', publicEventData, 'event');\n        return await this.#setStatus(_a.STATUSES.active);\n    }\n    #addOrUpdateInvite(eventData) {\n        const key = CollectorInvite_1.CollectorInvite.getKeyForEvent(eventData);\n        if (this.#cache.invites[key]) {\n            this.#cache.invites[key].setEventData(eventData);\n        }\n        else {\n            this.#cache.invites[key] = new CollectorInvite_1.CollectorInvite(this, eventData);\n        }\n        return this.#cache.invites[key];\n    }\n    /**\n     * Retrieve an invite by its key\n     */\n    async getInviteByKey(key) {\n        await this.init(); // do not forceRefresh on Init();\n        await this.#initInvites(false);\n        return this.#cache.invites[key];\n    }\n    /**\n     * Retreive all invites\n     * @param {boolean} [forceRefresh]\n     * @returns {Array<CollectorInvite>}\n     */\n    async getInvites(forceRefresh = false) {\n        await this.init(); // do not forceRefresh on Init();\n        await this.#initInvites(forceRefresh);\n        return Object.values(this.#cache.invites);\n    }\n    async #initInvites(forceRefresh) {\n        await (0, utils_1.waitUntilFalse)(() => (this.#cache.invitesInitializing));\n        if (!forceRefresh && this.#cache.invitesInitialized)\n            return;\n        this.#cache.invitesInitializing = true;\n        const queryParams = { types: ['invite/collector-v1'], streams: [this.streamId], fromTime: 0, toTime: 8640000000000000, limit: 10000 };\n        try {\n            await this.appManaging.connection.getEventsStreamed(queryParams, (eventData) => {\n                this.#addOrUpdateInvite(eventData);\n            });\n        }\n        catch (e) {\n            this.#cache.invitesInitialized = true;\n            this.#cache.invitesInitializing = false;\n            throw e;\n        }\n        this.#cache.invitesInitialized = true;\n        this.#cache.invitesInitializing = false;\n    }\n    async checkInbox() {\n        const newCollectorInvites = [];\n        const params = { types: ['response/collector-v1'], limit: 1000, streams: [this.streamIdFor(_a.STREAMID_SUFFIXES.inbox)] };\n        const responseEvents = await this.appManaging.connection.apiOne('events.get', params, 'events');\n        for (const responseEvent of responseEvents) {\n            // fetch corresponding invite\n            const inviteEvent = await this.appManaging.connection.apiOne('events.getOne', { id: responseEvent.content.eventId }, 'event');\n            if (inviteEvent == null)\n                throw new errors_1.HDSLibError(`Cannot find invite event matching id: ${responseEvent.content.eventId}`, responseEvent);\n            const updateInvite = {\n                content: structuredClone(inviteEvent.content)\n            };\n            updateInvite.content.sourceEventId = responseEvent.id;\n            // check type of response\n            switch (responseEvent.content.type) {\n                case 'accept':\n                    updateInvite.streamIds = [this.streamIdFor(_a.STREAMID_SUFFIXES.active)];\n                    updateInvite.content.apiEndpoint = responseEvent.content.apiEndpoint;\n                    if (responseEvent.content.chat)\n                        updateInvite.content.chat = responseEvent.content.chat;\n                    break;\n                case 'refuse':\n                    updateInvite.streamIds = [this.streamIdFor(_a.STREAMID_SUFFIXES.error)];\n                    updateInvite.content.errorType = 'refused';\n                    break;\n                case 'revoke':\n                    updateInvite.streamIds = [this.streamIdFor(_a.STREAMID_SUFFIXES.error)];\n                    updateInvite.content.errorType = 'revoked';\n                    break;\n                default:\n                    throw new errors_1.HDSLibError(`Unkown or undefined ${responseEvent.content.type}`, responseEvent);\n            }\n            // update inviteEvent and archive inbox message\n            const apiCalls = [\n                {\n                    method: 'events.update',\n                    params: {\n                        id: inviteEvent.id,\n                        update: updateInvite\n                    }\n                },\n                {\n                    method: 'events.update',\n                    params: {\n                        id: responseEvent.id,\n                        update: {\n                            streamIds: [this.streamIdFor(_a.STREAMID_SUFFIXES.archive)]\n                        }\n                    }\n                }\n            ];\n            const results = await this.appManaging.connection.api(apiCalls);\n            const errors = results.filter((r) => (!r.event));\n            if (errors.length > 0)\n                throw new errors_1.HDSLibError('Error activating incoming request', errors);\n            const eventUpdated = results[0].event;\n            const inviteUpdated = this.#addOrUpdateInvite(eventUpdated);\n            newCollectorInvites.push(inviteUpdated);\n        }\n        return newCollectorInvites;\n    }\n    /**\n     * Create a \"pending\" invite to be sent to an app using AppSharingAccount\n     * @param {string} name a default display name for this request\n     * @param {Object} [options]\n     * @param {Object} [options.customData] any data to be used by the client app\n     */\n    async createInvite(name, options = {}) {\n        if (this.statusCode !== _a.STATUSES.active)\n            throw new Error(`Collector must be in \"active\" state error to create invite, current: ${this.statusCode}`);\n        const eventParams = {\n            type: 'invite/collector-v1',\n            streamIds: [this.streamIdFor(_a.STREAMID_SUFFIXES.pending)],\n            content: {\n                name,\n                customData: options.customData || {}\n            }\n        };\n        const newInvite = await this.appManaging.connection.apiOne('events.create', eventParams, 'event');\n        const invite = this.#addOrUpdateInvite(newInvite);\n        return invite;\n    }\n    /**\n     * Get sharing api endpoint\n     */\n    async sharingApiEndpoint() {\n        if (this.statusCode !== _a.STATUSES.active)\n            throw new Error(`Collector must be in \"active\" state error to get sharing link, current: ${this.statusCode}`);\n        if (this.#cache.sharingApiEndpoint)\n            return this.#cache.sharingApiEndpoint;\n        // check if sharing present\n        const sharedAccessId = 'a-' + this.streamId;\n        const accesses = await this.appManaging.connection.apiOne('accesses.get', {}, 'accesses');\n        const sharedAccess = accesses.find((access) => access.name === sharedAccessId);\n        // found return it\n        if (sharedAccess) {\n            this.#cache.sharingApiEndpoint = sharedAccess.apiEndpoint;\n            return sharedAccess.apiEndpoint;\n        }\n        // not found create it\n        const permissions = [\n            { streamId: this.streamIdFor(_a.STREAMID_SUFFIXES.inbox), level: 'create-only' },\n            { streamId: this.streamIdFor(_a.STREAMID_SUFFIXES.public), level: 'read' },\n            // for \"publicly shared access\" always forbid the selfRevoke feature\n            { feature: 'selfRevoke', setting: 'forbidden' },\n            // for \"publicly shared access\" always forbid the selfAudit feature\n            { feature: 'selfAudit', setting: 'forbidden' }\n        ];\n        const clientData = {\n            hdsCollector: {\n                version: 0,\n                public: {\n                    streamId: this.streamIdFor(_a.STREAMID_SUFFIXES.public)\n                },\n                inbox: {\n                    streamId: this.streamIdFor(_a.STREAMID_SUFFIXES.inbox)\n                }\n            }\n        };\n        const params = { name: sharedAccessId, type: 'shared', permissions, clientData };\n        const access = await this.appManaging.connection.apiOne('accesses.create', params, 'access');\n        const newSharingApiEndpoint = access?.apiEndpoint;\n        if (!newSharingApiEndpoint)\n            throw new errors_1.HDSLibError('Cannot find apiEndpoint in sharing creation request', { result: access, requestParams: params });\n        this.#cache.sharingApiEndpoint = newSharingApiEndpoint;\n        return newSharingApiEndpoint;\n    }\n    /**\n     * @private\n     * @param {CollectorInvite} invite\n     * @param {boolean} alreadyChecked // to avoid loops\n     * @returns {CollectorInvite}\n     */\n    async revokeInvite(invite, alreadyChecked = false) {\n        // Invalidate Invite APIEndpoint(s)\n        if (invite.status === 'active' && !alreadyChecked) { // invalidate eventual authorization granted\n            const accessInfo = await invite.checkAndGetAccessInfo(true);\n            const deletionResult = await invite.connection.apiOne('accesses.delete', { id: accessInfo.id });\n            if (deletionResult?.accessDeletion?.id == null) {\n                logger.warn(`Failed revoking invite access for ${accessInfo.name}`);\n            }\n        }\n        // invalidate this access\n        const updateInvite = {\n            id: invite.eventData.id,\n            update: {\n                content: structuredClone(invite.eventData.content),\n                streamIds: [this.streamIdFor(_a.STREAMID_SUFFIXES.error)]\n            }\n        };\n        updateInvite.update.content.errorType = 'revoked';\n        const eventData = await this.appManaging.connection.apiOne('events.update', updateInvite, 'event');\n        invite.eventData = eventData;\n        return invite;\n    }\n    /**\n     * check if required streams are present, if not create them\n     */\n    async checkStreamStructure() {\n        // if streamData has correct child structure, we assume all is OK\n        const childrenData = this.#streamData.children;\n        const toCreate = Object.values(_a.STREAMID_SUFFIXES)\n            .filter((suffix) => {\n            if (!childrenData)\n                return true;\n            if (childrenData.find(child => child.id === this.streamIdFor(suffix)))\n                return false;\n            return true;\n        });\n        if (toCreate.length === 0)\n            return { created: [] };\n        // create required streams\n        const apiCalls = toCreate.map(suffix => ({\n            method: 'streams.create',\n            params: {\n                id: this.streamIdFor(suffix),\n                parentId: this.streamId,\n                name: this.name + ' ' + suffix\n            }\n        }));\n        const result = { created: [], errors: [] };\n        const resultsApi = await this.appManaging.connection.api(apiCalls);\n        for (const resultCreate of resultsApi) {\n            if (resultCreate.error) {\n                result.errors.push(resultCreate.error);\n                continue;\n            }\n            if (resultCreate.stream) {\n                result.created.push(resultCreate.stream);\n                if (!this.#streamData.children)\n                    this.#streamData.children = [];\n                this.#streamData.children.push(resultCreate.stream);\n                continue;\n            }\n            result.errors.push({ id: 'unkown-error', message: 'Cannot find stream in result', data: resultCreate });\n        }\n        return result;\n    }\n    /**\n     * @param {string} suffix\n     */\n    streamIdFor(suffix) {\n        return this.streamId + '-' + suffix;\n    }\n    /**\n     * Invite Status for streamId\n     * reverse of streamIdFor\n     */\n    inviteStatusForStreamId(streamId) {\n        // init cache if needed\n        if (!this.#cache.inviteStatusForStreamId) {\n            this.#cache.inviteStatusForStreamId = {};\n            for (const status of [COLLECTOR_STREAMID_SUFFIXES.pending, COLLECTOR_STREAMID_SUFFIXES.active, COLLECTOR_STREAMID_SUFFIXES.error]) {\n                this.#cache.inviteStatusForStreamId[this.streamIdFor(status)] = status;\n            }\n        }\n        // look for status\n        const status = this.#cache.inviteStatusForStreamId[streamId];\n        if (status == null)\n            throw new errors_1.HDSLibError(`Cannot find status for streamId: ${streamId}`);\n        return status;\n    }\n}\nexports.Collector = Collector;\n_a = Collector;\n/**\n * @typedef {CollectorRequest}\n * @property {number} version\n * @property {Localizable} description\n * @property {Localizable} consent\n * @property {Array<Permission>} permissions - Like Pryv permission request\n * @property {Object} app\n * @property {String} app.id\n * @property {String} app.url\n * @property {Object} app.data - to be finalized\n */\n//# sourceMappingURL=Collector.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CollectorClient = void 0;\nconst CollectorRequest_1 = require(\"./CollectorRequest\");\nconst patchedPryv_1 = require(\"../patchedPryv\");\nconst errors_1 = require(\"../errors\");\nconst logger = __importStar(require(\"../logger\"));\n/**\n * Client App in relation to an AppManagingAccount/Collector\n */\nclass CollectorClient {\n    static STATUSES = Object.freeze({\n        incoming: 'Incoming',\n        active: 'Active',\n        deactivated: 'Deactivated',\n        refused: 'Refused'\n    });\n    app;\n    eventData;\n    accessData;\n    request;\n    #requesterConnection;\n    /** @property {String} - identified within user's account - can be used to retrieve a Collector Client from an app */\n    get key() {\n        return _a.keyFromInfo(this.eventData.content.accessInfo);\n    }\n    /** @property {String} - id matching an event within requester's account - used as a reference to communicate with requester */\n    get requesterEventId() {\n        return this.eventData.content.requesterEventId;\n    }\n    /** @property {String}  */\n    get requesterApiEndpoint() {\n        return this.eventData.content.apiEndpoint;\n    }\n    get requesterUsername() {\n        return this.eventData.content.accessInfo.user.username;\n    }\n    get requesterConnection() {\n        if (!this.#requesterConnection) {\n            this.#requesterConnection = new patchedPryv_1.pryv.Connection(this.requesterApiEndpoint);\n        }\n        return this.#requesterConnection;\n    }\n    /** @property {Object} - full content of the request */\n    get requestData() {\n        return this.eventData.content.requesterEventData.content;\n    }\n    get hasChatFeature() {\n        return this.requestData.features?.chat != null;\n    }\n    get chatSettings() {\n        if (!this.hasChatFeature)\n            return null;\n        return {\n            chatStreamIncoming: `chat-${this.requesterUsername}-in`,\n            chatStreamMain: `chat-${this.requesterUsername}`\n        };\n    }\n    /** @property {string} - one of 'Incoming', 'Active', 'Deactivated', 'Refused' */\n    get status() {\n        const eventStatus = this.eventData.content.status;\n        if (eventStatus === _a.STATUSES.deactivated || eventStatus === _a.STATUSES.refused) {\n            if (!this.accessData?.deleted) {\n                logger.error('>> CollectorClient.status TODO check consistency when access is still valid and deactivated or refused', this.accessData);\n            }\n            return eventStatus;\n        }\n        if (this.accessData && !this.accessData.deleted && this.eventData.content.status !== _a.STATUSES.active) {\n            logger.error('>> CollectorClient.status: accessData ', this.accessData);\n            throw new errors_1.HDSLibError('Should be active, try checkConsistency()');\n        }\n        if (!eventStatus) {\n            logger.error('>> CollectorClient.status is null', { eventData: this.eventData, accessData: this.accessData });\n        }\n        return eventStatus;\n    }\n    constructor(app, eventData, accessData = null) {\n        this.app = app;\n        this.eventData = eventData;\n        this.accessData = accessData;\n        this.request = new CollectorRequest_1.CollectorRequest({});\n        this.request.loadFromInviteEvent(eventData.content.requesterEventData);\n    }\n    /**\n     * @private\n     * used by appClientAccount.handleIncomingRequest\n     */\n    static async create(app, apiEndpoint, requesterEventId, accessInfo) {\n        // check content of accessInfo\n        const publicStreamId = accessInfo.clientData.hdsCollector.public.streamId;\n        // get request event cont\n        const requesterConnection = new patchedPryv_1.pryv.Connection(apiEndpoint);\n        const requesterEvents = await requesterConnection.apiOne('events.get', { types: ['request/collector-v1'], streams: [publicStreamId], limit: 1 }, 'events');\n        if (!requesterEvents[0])\n            throw new errors_1.HDSLibError('Cannot find requester event in public stream', requesterEvents);\n        const eventData = {\n            type: 'request/collector-client-v1',\n            streamIds: [app.baseStreamId],\n            content: {\n                apiEndpoint,\n                requesterEventId,\n                requesterEventData: requesterEvents[0],\n                accessInfo,\n                status: _a.STATUSES.incoming\n            }\n        };\n        const event = await app.connection.apiOne('events.create', eventData, 'event');\n        return new _a(app, event);\n    }\n    /**\n     * @private\n     * reset with new request Event of ApiEndpoint\n     * Identical as create but keep current event\n     */\n    async reset(apiEndpoint, requesterEventId) {\n        if (this.accessData && this.accessData?.deleted != null) {\n            logger.error('TODO try to revoke current access');\n        }\n        // get accessInfo\n        const requesterConnection = new patchedPryv_1.pryv.Connection(apiEndpoint);\n        const accessInfo = await requesterConnection.accessInfo();\n        // check content of accessInfo\n        const publicStreamId = accessInfo.clientData.hdsCollector.public.streamId;\n        // get request event cont\n        const requesterEvents = await requesterConnection.apiOne('events.get', { types: ['request/collector-v1'], streams: [publicStreamId], limit: 1 }, 'events');\n        if (!requesterEvents[0])\n            throw new errors_1.HDSLibError('Cannot find requester event in public stream', requesterEvents);\n        const eventData = await this.app.connection.apiOne('events.update', {\n            id: this.eventData.id,\n            update: {\n                content: {\n                    apiEndpoint,\n                    requesterEventId,\n                    requesterEventData: requesterEvents[0],\n                    accessInfo,\n                    status: _a.STATUSES.incoming\n                }\n            }\n        }, 'event');\n        this.eventData = eventData;\n        this.request.loadFromInviteEvent(requesterEvents[0]);\n        return this;\n    }\n    /**\n     * Update business event with new status\n     * @param {string} newStatus\n     * @param {Object} [extraData] - if given this will be added to content  - This can overide content!\n     */\n    async #updateStatus(newStatus, extraData = null) {\n        const newContent = structuredClone(this.eventData.content);\n        newContent.status = newStatus;\n        if (extraData !== null)\n            Object.assign(newContent, extraData);\n        const eventData = await this.app.connection.apiOne('events.update', {\n            id: this.eventData.id,\n            update: {\n                content: newContent\n            }\n        }, 'event');\n        this.eventData = eventData;\n    }\n    /**\n     * Accept current request\n     * @param {boolean} forceAndSkipAccessCreation - internal temporary option,\n     */\n    async accept(forceAndSkipAccessCreation = false) {\n        const responseContent = {};\n        if (this.accessData && this.accessData.deleted == null && this.status !== 'Active') {\n            forceAndSkipAccessCreation = true;\n            logger.error('CollectorClient.accept TODO fix accept when access valid');\n        }\n        if (forceAndSkipAccessCreation) {\n            if (!this.accessData?.apiEndpoint || this.accessData?.delete)\n                throw new errors_1.HDSLibError('Cannot force accept with empty or deleted accessData', this.accessData);\n        }\n        else {\n            if (this.status === 'Active')\n                throw new errors_1.HDSLibError('Cannot accept an Active CollectorClient');\n            // create access for requester\n            const cleanedPermissions = this.requestData.permissions.map((p) => {\n                if (p.streamId)\n                    return { streamId: p.streamId, level: p.level };\n                return p;\n            });\n            // ------------- chat ------------------------ //\n            if (this.hasChatFeature) {\n                // user supported mode - might me moved to a lib\n                // 2. create streams\n                const { chatStreamIncoming, chatStreamMain } = this.chatSettings;\n                const chatStreamsCreateApiCalls = [\n                    { method: 'streams.create', params: { name: 'Chats', id: 'chats' } },\n                    { method: 'streams.create', params: { name: `Chat ${this.requesterUsername}`, parentId: 'chats', id: chatStreamMain } },\n                    { method: 'streams.create', params: { name: `Chat ${this.requesterUsername} In`, parentId: chatStreamMain, id: chatStreamIncoming } }\n                ];\n                const streamCreateResults = await this.app.connection.api(chatStreamsCreateApiCalls);\n                streamCreateResults.forEach((r) => {\n                    if (r.stream?.id || r.error?.id === 'item-already-exists')\n                        return;\n                    throw new errors_1.HDSLibError('Failed creating chat stream', streamCreateResults);\n                });\n                // 3. add streams to permissions\n                cleanedPermissions.push(...[\n                    { streamId: chatStreamMain, level: 'read' },\n                    { streamId: chatStreamIncoming, level: 'manage' }\n                ]);\n                responseContent.chat = {\n                    type: 'user',\n                    streamRead: chatStreamMain,\n                    streamWrite: chatStreamIncoming\n                };\n                // ---------- end chat ---------- //\n            }\n            const accessCreateData = {\n                name: this.key,\n                type: 'shared',\n                permissions: cleanedPermissions,\n                clientData: {\n                    hdsCollectorClient: {\n                        version: 0,\n                        eventData: this.eventData\n                    }\n                }\n            };\n            const accessData = await this.app.connection.apiOne('accesses.create', accessCreateData, 'access');\n            this.accessData = accessData;\n            if (!this.accessData?.apiEndpoint)\n                throw new errors_1.HDSLibError('Failed creating request access', accessData);\n        }\n        responseContent.apiEndpoint = this.accessData.apiEndpoint;\n        const requesterEvent = await this.#updateRequester('accept', responseContent);\n        if (requesterEvent != null) {\n            await this.#updateStatus(_a.STATUSES.active);\n            return { accessData: this.accessData, requesterEvent };\n        }\n        return null;\n    }\n    async revoke() {\n        if (!this.accessData) {\n            throw new errors_1.HDSLibError('Cannot revoke if no accessData');\n        }\n        if (this.accessData.deleted && this.status === _a.STATUSES.deactivated) {\n            throw new errors_1.HDSLibError('Already revoked');\n        }\n        // revoke access\n        await this.app.connection.apiOne('accesses.delete', { id: this.accessData.id }, 'accessDeletion');\n        // lazyly flag currentAccess as deleted\n        this.accessData.deleted = Date.now() / 1000;\n        const responseContent = {};\n        const requesterEvent = await this.#updateRequester('revoke', responseContent);\n        if (requesterEvent != null) {\n            await this.#updateStatus(_a.STATUSES.deactivated);\n            return { requesterEvent };\n        }\n        return null;\n    }\n    async refuse() {\n        const responseContent = {};\n        const requesterEvent = await this.#updateRequester('refuse', responseContent);\n        if (requesterEvent != null) {\n            await this.#updateStatus(_a.STATUSES.refused);\n            return { requesterEvent };\n        }\n        return null;\n    }\n    /**\n     * @param {string} type - one of 'accpet', 'revoke', 'refuse'\n     * @param {object} responseContent - content is related to type\n     * @returns {Object} - response\n     */\n    async #updateRequester(type, responseContent) {\n        // sent access credentials to requester\n        // check content of accessInfo\n        const publicStreamId = this.eventData.content.accessInfo.clientData.hdsCollector.inbox.streamId;\n        const requesterEventId = this.requesterEventId;\n        // add eventId to content\n        const content = Object.assign({ type, eventId: requesterEventId }, responseContent);\n        // acceptEvent to be sent to requester\n        const responseEvent = {\n            type: 'response/collector-v1',\n            streamIds: [publicStreamId],\n            content\n        };\n        try {\n            const requesterEvent = await this.requesterConnection.apiOne('events.create', responseEvent, 'event');\n            return requesterEvent;\n        }\n        catch (e) {\n            const deactivatedDetail = {\n                type: 'error',\n                message: e.message\n            };\n            if (e.innerObject)\n                deactivatedDetail.data = e.innerObject;\n            logger.error('Failed activating', deactivatedDetail);\n            const deactivatedResult = await this.#updateStatus(_a.STATUSES.deactivated, { deactivatedDetail });\n            console.log('***** ', { deactivatedResult });\n            return null;\n        }\n    }\n    /**\n     * Probable temporary internal to fix possible inconsenticies during lib early stages\n     */\n    async checkConsistency() {\n        // accessData but not active\n        if (this.accessData && this.eventData.content.status == null) {\n            logger.info('Found discrepency with accessData and status not active, fixing it');\n            if (!this.accessData.deleted) {\n                await this.accept(true);\n            }\n            else {\n                await this.revoke();\n            }\n        }\n        else {\n            // logger.debug('CollectorClient:checkConsistency', this.accessData);\n        }\n    }\n    /**\n     * return the key to discriminate collectorClients\n     * @param {PryvAccessInfo} accessInfo\n     */\n    static keyFromInfo(info) {\n        return info.user.username + ':' + info.name;\n    }\n    // -------------------- sections and forms ------------- //\n    getSections() {\n        return this.request?.sections;\n    }\n    // -------------------- chat methods ----------------- //\n    chatEventInfos(event) {\n        if (event.streamIds.includes(this.chatSettings.chatStreamIncoming))\n            return { source: 'requester' };\n        if (event.streamIds.includes(this.chatSettings.chatStreamMain))\n            return { source: 'me' };\n        return { source: 'unkown' };\n    }\n    async chatPost(hdsConnection, content) {\n        if (!this.hasChatFeature)\n            throw new errors_1.HDSLibError('Cannot chat with this ColleectorClient');\n        const newEvent = {\n            type: 'message/hds-chat-v1',\n            streamIds: [this.chatSettings.chatStreamMain],\n            content\n        };\n        return await hdsConnection.apiOne('events.create', newEvent, 'event');\n    }\n}\nexports.CollectorClient = CollectorClient;\n_a = CollectorClient;\n//# sourceMappingURL=CollectorClient.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CollectorInvite = void 0;\nconst patchedPryv_1 = require(\"../patchedPryv\");\nconst errors_1 = require(\"../errors\");\n/**\n * Collector Invite\n * There is one Collector Invite per Collector => Enduser connection\n */\nclass CollectorInvite {\n    /**\n     * get the key that will be assigned to this event;\n     */\n    static getKeyForEvent(eventData) {\n        return eventData.id;\n    }\n    collector;\n    eventData;\n    #connection = null;\n    #accessInfo = null;\n    get key() {\n        return CollectorInvite.getKeyForEvent(this.eventData);\n    }\n    get status() {\n        return this.collector.inviteStatusForStreamId(this.eventData.streamIds[0]);\n    }\n    get apiEndpoint() {\n        if (this.status !== 'active') {\n            throw new errors_1.HDSLibError('invite.apiEndpoint is accessible only when active');\n        }\n        return this.eventData.content.apiEndpoint;\n    }\n    get errorType() {\n        return this.eventData.content?.errorType;\n    }\n    get dateCreation() {\n        return new Date(this.eventData.created * 1000);\n    }\n    get connection() {\n        if (this.#connection == null) {\n            this.#connection = new patchedPryv_1.pryv.Connection(this.apiEndpoint);\n        }\n        return this.#connection;\n    }\n    get hasChat() {\n        return this.eventData.content.chat != null;\n    }\n    get chatSettings() {\n        return this.eventData.content.chat;\n    }\n    // -------------------- chat methods ----------------- //\n    chatEventInfos(event) {\n        if (event.streamIds.includes(this.chatSettings.streamWrite))\n            return { source: 'me' };\n        if (event.streamIds.includes(this.chatSettings.streamRead))\n            return { source: 'user' };\n        return { source: 'unkown' };\n    }\n    async chatPost(content) {\n        if (!this.hasChat)\n            throw new Error('Cannot chat with this contact');\n        const newEvent = {\n            type: 'message/hds-chat-v1',\n            streamIds: [this.chatSettings.streamWrite],\n            content\n        };\n        return await this.connection.apiOne('events.create', newEvent, 'event');\n    }\n    /**\n     * Check if connection is valid. (only if active)\n     * If result is \"forbidden\" update and set as revoked\n     * @returns accessInfo if valid.\n     */\n    async checkAndGetAccessInfo(forceRefresh = false) {\n        if (!forceRefresh && this.#accessInfo)\n            return this.#accessInfo;\n        try {\n            this.#accessInfo = await this.connection.accessInfo();\n            return this.#accessInfo;\n        }\n        catch (e) {\n            this.#accessInfo = null;\n            if (e.response?.body?.error?.id === 'invalid-access-token') {\n                await this.collector.revokeInvite(this, true);\n                return null;\n            }\n            throw e;\n        }\n    }\n    /**\n     * revoke the invite\n     */\n    async revoke() {\n        return this.collector.revokeInvite(this);\n    }\n    get displayName() {\n        return this.eventData.content.name;\n    }\n    constructor(collector, eventData) {\n        if (eventData.type !== 'invite/collector-v1')\n            throw new errors_1.HDSLibError('Wrong type of event', eventData);\n        this.collector = collector;\n        this.eventData = eventData;\n    }\n    /**\n     * private\n     */\n    setEventData(eventData) {\n        if (eventData.id !== this.eventData.id)\n            throw new errors_1.HDSLibError('CollectInvite event id does not match new Event');\n        this.eventData = eventData;\n    }\n    async getSharingData() {\n        if (this.status !== 'pending')\n            throw new errors_1.HDSLibError('Only pendings can be shared');\n        return {\n            apiEndpoint: await this.collector.sharingApiEndpoint(),\n            eventId: this.eventData.id\n        };\n    }\n}\nexports.CollectorInvite = CollectorInvite;\n//# sourceMappingURL=CollectorInvite.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CollectorRequest = void 0;\nconst errors_1 = require(\"../errors\");\nconst HDSModelInitAndSingleton_1 = require(\"../HDSModel/HDSModelInitAndSingleton\");\nconst localizeText_1 = require(\"../localizeText\");\nconst CURRENT_VERSION = 1;\n/**\n * Each Collector has one Request\n * Which contains\n * - the name of the requester\n * - a title\n * - a description\n * - a consent message\n * - a set of permission requests\n * - a version\n */\nclass CollectorRequest {\n    #version;\n    #title;\n    #description;\n    #consent;\n    #requester;\n    #app;\n    #permissionsExtra;\n    #permissions;\n    #sections;\n    #features;\n    #extraContent;\n    constructor(content) {\n        this.#version = CURRENT_VERSION;\n        this.#requester = { name: null };\n        this.#app = { id: null, url: null, data: {} };\n        this.#permissions = [];\n        this.#permissionsExtra = [];\n        this.#sections = [];\n        this.#features = {};\n        this.setContent(content);\n    }\n    /**\n     * Loadfrom invite event\n     * used by CollectorClient only\n     * @param invite\n     */\n    loadFromInviteEvent(inviteEvent) {\n        this.setContent(inviteEvent.content);\n    }\n    /**\n     * Loadfrom status event from Collector\n     * used by Collector only\n     * @param statusEvent\n     */\n    loadFromStatusEvent(statusEvent) {\n        // content.data is deprecated it was used in a previous version, should be removed\n        let potentialContent = statusEvent.content.request || statusEvent.content.data;\n        // for some reason to be investigated sometime the data is in requestContent\n        if (potentialContent.requestContent)\n            potentialContent = potentialContent.requestContent;\n        this.setContent(potentialContent);\n    }\n    /**\n     * Temp content\n     * @param content\n     */\n    setContent(content) {\n        const futureContent = structuredClone(content);\n        // validate content\n        if (futureContent.version != null) {\n            const numV = Number.parseInt(futureContent.version);\n            if (numV === 0) {\n                vo0ToV1(futureContent); // convert to v1 if needed\n            }\n            else {\n                if (numV !== this.#version)\n                    throw new errors_1.HDSLibError(`Invalid CollectorRequest content version: ${futureContent.version}`);\n            }\n            delete futureContent.version;\n        }\n        // -- title, consent, description\n        for (const key of ['title', 'consent', 'description']) {\n            if (futureContent[key] != null) {\n                this[key] = futureContent[key];\n            }\n            delete futureContent[key];\n        }\n        // -- requester\n        if (futureContent.requester) {\n            if (futureContent.requester.name != null) {\n                this.requesterName = futureContent.requester.name;\n            }\n            delete futureContent.requester;\n        }\n        // -- app\n        if (futureContent.app) {\n            if (futureContent.app.id != null) {\n                this.appId = futureContent.app.id;\n            }\n            if (futureContent.app.url != null) {\n                this.appUrl = futureContent.app.url;\n            }\n            if (futureContent.app.data != null) {\n                this.appCustomData = futureContent.app.data;\n            }\n            delete futureContent.app;\n        }\n        // -- sections\n        if (futureContent.sections != null) {\n            this.#sections = []; // reset sections\n            for (const sectionData of futureContent.sections) {\n                const section = this.createSection(sectionData.key, sectionData.type);\n                section.setName(sectionData.name);\n                section.addItemKeys(sectionData.itemKeys);\n            }\n            delete futureContent.sections;\n        }\n        // -- permissions\n        if (futureContent.permissions) {\n            this.#permissions = []; // reset permissions\n            futureContent.permissions.forEach((p) => {\n                this.addPermission(p.streamId, p.defaultName, p.level);\n            });\n            delete futureContent.permissions;\n        }\n        // -- permissionsExtra\n        if (futureContent.permissionsExtra) {\n            this.#permissionsExtra = []; // reset permissions Extra\n            futureContent.permissionsExtra.forEach((p) => {\n                this.addPermissionExtra(p);\n            });\n            delete futureContent.permissionsExtra;\n        }\n        // -- features\n        if (futureContent.features) {\n            if (futureContent.features.chat) {\n                this.addChatFeature(futureContent.features.chat);\n                delete futureContent.features.chat;\n            }\n            if (Object.keys(futureContent.features).length > 0) {\n                throw new errors_1.HDSLibError('Found unkown features', futureContent.features);\n            }\n            delete futureContent.features;\n        }\n        this.#extraContent = futureContent;\n    }\n    // ------------- getter and setters ------------ //\n    get version() { return this.#version; }\n    set title(title) { this.#title = (0, localizeText_1.validateLocalizableText)('title', title); }\n    get title() { return this.#title; }\n    set consent(consent) { this.#consent = (0, localizeText_1.validateLocalizableText)('consent', consent); }\n    get consent() { return this.#consent; }\n    set description(description) { this.#description = (0, localizeText_1.validateLocalizableText)('description', description); }\n    get description() { return this.#description; }\n    set requesterName(name) { this.#requester.name = validateString('requester:name', name); }\n    get requesterName() { return this.#requester.name; }\n    set appId(id) { this.#app.id = validateString('app:id', id); }\n    get appId() { return this.#app.id; }\n    set appUrl(url) { this.#app.url = validateString('app:url', url); }\n    get appUrl() { return this.#app.url; }\n    set appCustomData(data) { this.#app.data = data; }\n    get appCustomData() { return this.#app.data; }\n    get permissions() { return this.#permissions; }\n    get permissionsExtra() { return this.#permissionsExtra; }\n    get features() { return this.#features; }\n    // --- section --- //\n    get sections() {\n        return this.#sections;\n    }\n    get sectionsData() {\n        const result = [];\n        for (const section of this.#sections) {\n            const data = section.getData();\n            result.push(data);\n        }\n        return result;\n    }\n    createSection(key, type) {\n        if (this.getSectionByKey(key) != null)\n            throw new errors_1.HDSLibError(`Section with key: ${key} already exists`);\n        const section = new CollectorRequestSection(key, type);\n        this.#sections.push(section);\n        return section;\n    }\n    getSectionByKey(key) {\n        return this.#sections.find((s) => (s.key === key));\n    }\n    // ---------- permissions ---------- //\n    addPermissions(permissions) {\n        for (const permission of permissions) {\n            this.addPermission(permission.streamId, permission.defaultName, permission.level);\n        }\n    }\n    addPermission(streamId, defaultName, level) {\n        this.#permissions.push({ streamId, defaultName, level });\n    }\n    /**\n     * Add a static permission, not linked to itemKeys for other usages\n     * @param permission\n     */\n    addPermissionExtra(permission) {\n        // todo standard checks\n        this.#permissionsExtra.push(permission);\n    }\n    /**\n     * Reset permissions\n     */\n    resetPermissions() {\n        this.#permissions.splice(0, this.#permissions.length);\n    }\n    /**\n     * Rebuild permissions based on sections itemKeys and staticPermissions\n     */\n    buildPermissions() {\n        // 1- get all items form the questionnary sections\n        const itemKeys = [];\n        for (const section of this.sections) {\n            itemKeys.push(...section.itemKeys);\n        }\n        // 2 - get the permissions with eventual preRequest\n        const preRequest = this.permissionsExtra || [];\n        const permissions = (0, HDSModelInitAndSingleton_1.getModel)().authorizations.forItemKeys(itemKeys, { preRequest });\n        // 3 - if no error araised - reset permissions\n        this.resetPermissions();\n        this.addPermissions(permissions);\n    }\n    // ---------- features ------------- //\n    get hasChatFeature() {\n        return this.#features.chat != null;\n    }\n    addChatFeature(settings = { type: 'user' }) {\n        if (!['user', 'usernames'].includes(settings.type))\n            throw new errors_1.HDSLibError('Invalid chat type', settings);\n        this.#features.chat = settings;\n    }\n    // ---------- sections ------------- //\n    /**\n     * Return Content to comply with initial implementation as an object\n     */\n    get content() {\n        const content = {\n            version: this.version,\n            title: this.title,\n            consent: this.consent,\n            description: this.description,\n            requester: {\n                name: this.requesterName\n            },\n            features: this.features,\n            permissionsExtra: this.permissionsExtra,\n            permissions: this.permissions,\n            app: {\n                id: this.appId,\n                url: this.appUrl,\n                data: this.appCustomData\n            },\n            sections: this.sectionsData\n        };\n        Object.assign(content, this.#extraContent);\n        return content;\n    }\n}\nexports.CollectorRequest = CollectorRequest;\nfunction validateString(key, totest) {\n    if (totest == null || typeof totest !== 'string')\n        throw new errors_1.HDSLibError(`Invalid ${key} value: ${totest}`, { [key]: totest });\n    return totest;\n}\nclass CollectorRequestSection {\n    #type;\n    #name;\n    #key;\n    #itemKeys;\n    constructor(key, type) {\n        this.#key = key;\n        this.#type = type;\n        this.#itemKeys = [];\n        this.#name = {\n            en: ''\n        };\n    }\n    addItemKeys(keys) {\n        keys.forEach((k) => this.addItemKey(k));\n    }\n    addItemKey(key) {\n        (0, HDSModelInitAndSingleton_1.getModel)().itemsDefs.forKey(key); // will throw error if not found\n        if (this.#itemKeys.includes(key))\n            return; // avoid double entries\n        this.#itemKeys.push(key);\n    }\n    setName(localizedName) {\n        for (const [languageCode, name] of Object.entries(localizedName)) {\n            this.setNameLocal(languageCode, name);\n        }\n    }\n    setNameLocal(languageCode, name) {\n        this.#name[languageCode] = name;\n    }\n    get type() { return this.#type; }\n    get key() { return this.#key; }\n    get itemKeys() { return this.#itemKeys; }\n    get name() { return this.#name; }\n    getData() {\n        return {\n            key: this.key,\n            type: this.#type,\n            name: this.#name,\n            itemKeys: this.#itemKeys\n        };\n    }\n}\n/**\n * Transform data to match v1\n * @param v0Data\n */\nfunction vo0ToV1(v0Data) {\n    if (v0Data.app?.data?.forms) {\n        if (v0Data.sections)\n            throw new errors_1.HDSLibError('Cannot mix data.forms & sections', v0Data);\n        v0Data.sections = [];\n        for (const [key, value] of Object.entries(v0Data.app.data.forms)) {\n            value.key = key;\n            value.name = {\n                en: value.name\n            };\n            v0Data.sections.push(value);\n        }\n        delete v0Data.app.data.forms;\n    }\n    v0Data.version = 1;\n}\n//# sourceMappingURL=CollectorRequest.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CollectorRequest = exports.CollectorInvite = exports.CollectorClient = exports.Collector = exports.Application = exports.AppClientAccount = exports.AppManagingAccount = void 0;\nconst AppManagingAccount_1 = require(\"./AppManagingAccount\");\nObject.defineProperty(exports, \"AppManagingAccount\", { enumerable: true, get: function () { return AppManagingAccount_1.AppManagingAccount; } });\nconst AppClientAccount_1 = require(\"./AppClientAccount\");\nObject.defineProperty(exports, \"AppClientAccount\", { enumerable: true, get: function () { return AppClientAccount_1.AppClientAccount; } });\nconst Application_1 = require(\"./Application\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return Application_1.Application; } });\nconst Collector_1 = require(\"./Collector\");\nObject.defineProperty(exports, \"Collector\", { enumerable: true, get: function () { return Collector_1.Collector; } });\nconst CollectorClient_1 = require(\"./CollectorClient\");\nObject.defineProperty(exports, \"CollectorClient\", { enumerable: true, get: function () { return CollectorClient_1.CollectorClient; } });\nconst CollectorInvite_1 = require(\"./CollectorInvite\");\nObject.defineProperty(exports, \"CollectorInvite\", { enumerable: true, get: function () { return CollectorInvite_1.CollectorInvite; } });\nconst CollectorRequest_1 = require(\"./CollectorRequest\");\nObject.defineProperty(exports, \"CollectorRequest\", { enumerable: true, get: function () { return CollectorRequest_1.CollectorRequest; } });\n//# sourceMappingURL=appTemplates.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HDSLibError = void 0;\nclass HDSLibError extends Error {\n    innerObject;\n    constructor(message, innerObject = {}) {\n        const msg = (innerObject.message != null) ? message + ' >> ' + innerObject.message : message;\n        super(msg);\n        this.innerObject = innerObject;\n    }\n    toString() {\n        const res = super.toString();\n        return res + '\\nInner Object:\\n' + JSON.stringify(this.innerObject, null, 2);\n    }\n}\nexports.HDSLibError = HDSLibError;\n//# sourceMappingURL=errors.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.logger = exports.toolkit = exports.l = exports.localizeText = exports.appTemplates = exports.HDSModel = exports.HDSService = exports.settings = exports.pryv = exports.initHDSModel = exports.getHDSModel = exports.model = void 0;\nconst localizeText_1 = require(\"./localizeText\");\nObject.defineProperty(exports, \"localizeText\", { enumerable: true, get: function () { return localizeText_1.localizeText; } });\nObject.defineProperty(exports, \"l\", { enumerable: true, get: function () { return localizeText_1.localizeText; } });\nconst settings = __importStar(require(\"./settings\"));\nexports.settings = settings;\nconst patchedPryv_1 = require(\"./patchedPryv\");\nObject.defineProperty(exports, \"pryv\", { enumerable: true, get: function () { return patchedPryv_1.pryv; } });\nconst HDSModel_1 = require(\"./HDSModel/HDSModel\");\nObject.defineProperty(exports, \"HDSModel\", { enumerable: true, get: function () { return HDSModel_1.HDSModel; } });\nconst appTemplates = __importStar(require(\"./appTemplates/appTemplates\"));\nexports.appTemplates = appTemplates;\nconst logger = __importStar(require(\"./logger\"));\nexports.logger = logger;\nconst HDSService_1 = require(\"./HDSService\");\nObject.defineProperty(exports, \"HDSService\", { enumerable: true, get: function () { return HDSService_1.HDSService; } });\nconst HDSModelInitAndSingleton = __importStar(require(\"./HDSModel/HDSModelInitAndSingleton\"));\nconst toolkit = __importStar(require(\"./toolkit\"));\nexports.toolkit = toolkit;\nexports.model = (() => {\n    console.warn('HDSLib.model is deprecated use getHDSModel() instead');\n    return HDSModelInitAndSingleton.getModel();\n})();\nexports.getHDSModel = HDSModelInitAndSingleton.getModel;\nexports.initHDSModel = HDSModelInitAndSingleton.initHDSModel;\n// also exporting default for typescript to capture HDSLib.. there is surely a nicer way to do\nconst HDSLib = {\n    getHDSModel: exports.getHDSModel,\n    initHDSModel: exports.initHDSModel,\n    pryv: patchedPryv_1.pryv,\n    settings,\n    HDSService: HDSService_1.HDSService,\n    HDSModel: HDSModel_1.HDSModel,\n    appTemplates,\n    localizeText: localizeText_1.localizeText,\n    l: localizeText_1.localizeText,\n    toolkit,\n    logger\n};\nexports.default = HDSLib;\n//# sourceMappingURL=index.js.map","\"use strict\";\n/**\n * basic localization functions\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getPreferredLocales = getPreferredLocales;\nexports.getSupportedLocales = getSupportedLocales;\nexports.resetPreferredLocales = resetPreferredLocales;\nexports.localizeText = localizeText;\nexports.setPreferredLocales = setPreferredLocales;\nexports.validateLocalizableText = validateLocalizableText;\nconst errors_1 = require(\"./errors\");\nconst supportedLocales = ['en', 'fr', 'es'];\nObject.freeze(supportedLocales);\nlet preferredLocales = [...supportedLocales];\n/**\n * get the current preferred locales\n */\nfunction getPreferredLocales() {\n    return [...preferredLocales];\n}\n/**\n * get the current supported locales\n */\nfunction getSupportedLocales() {\n    return [...supportedLocales];\n}\n/**\n * reset prefferedLocalesTo Original state\n */\nfunction resetPreferredLocales() {\n    setPreferredLocales([...supportedLocales]);\n}\n/**\n * return the translation of this item considering the setting of preffered language\n */\nfunction localizeText(textItem) {\n    if (textItem == null)\n        return null;\n    if (!textItem.en)\n        throw new errors_1.HDSLibError('textItems must have an english translation', { textItem });\n    for (const l of preferredLocales) {\n        if (textItem[l])\n            return textItem[l];\n    }\n    return textItem.en;\n}\n/**\n * Change prefferedLocal order\n */\nfunction setPreferredLocales(arrayOfLocals) {\n    if (!Array.isArray(arrayOfLocals)) {\n        throw new errors_1.HDSLibError('setPreferredLocales takes an array of language codes');\n    }\n    const unsupportedLocales = arrayOfLocals.filter(l => (supportedLocales.indexOf(l) < 0));\n    if (unsupportedLocales.length > 0) {\n        throw new errors_1.HDSLibError(`locales \"${unsupportedLocales.join(', ')}\" are not supported`, arrayOfLocals);\n    }\n    preferredLocales = [...new Set([...arrayOfLocals, ...preferredLocales])];\n}\n/**\n * throw errors if an item is not of type localizableText\n */\nfunction validateLocalizableText(key, toTest) {\n    if (toTest.en == null || typeof toTest.en !== 'string')\n        throw new errors_1.HDSLibError(`Missing or invalid localizable text for ${key}`, { [key]: toTest });\n    for (const optionalLang of supportedLocales) {\n        if (optionalLang === 'en')\n            continue;\n        if (toTest[optionalLang] != null && typeof toTest[optionalLang] !== 'string')\n            throw new errors_1.HDSLibError(`Missing or invalid localizable text for ${key} languagecode: ${optionalLang}`, { [key]: toTest, languageCode: optionalLang });\n    }\n    return toTest;\n}\n//# sourceMappingURL=localizeText.js.map","\"use strict\";\n/**\n * Basic logger\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setLogger = setLogger;\nexports.info = info;\nexports.error = error;\nexports.debug = debug;\nexports.warn = warn;\nlet logger = {\n    info: log('info'),\n    error: log('error'),\n    debug: log('debug')\n};\nfunction setLogger(newLogger) {\n    logger = newLogger;\n}\nfunction info(...args) { logger.info(...args); }\nfunction error(...args) { logger.error(...args); }\nfunction debug(..._args) {\n    // logger.debug(..._args);\n}\nfunction warn(...args) {\n    logger.info(...args); // Use info for warn for now\n}\nfunction log(type) {\n    return function (...args) {\n        console.log(`Logger: [${type}]`, ...args);\n    };\n}\n//# sourceMappingURL=logger.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.pryv = void 0;\n/**\n * While developing this lib some functionalities should be\n * added to pryv js-lib in a second step\n */\nconst pryv = __importStar(require(\"pryv\"));\nexports.pryv = pryv;\nconst monitor_1 = __importDefault(require(\"@pryv/monitor\"));\nconst socket_io_1 = __importDefault(require(\"@pryv/socket.io\"));\n(0, monitor_1.default)(pryv);\n(0, socket_io_1.default)(pryv);\n//# sourceMappingURL=patchedPryv.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setPreferredLocales = void 0;\nexports.setServiceInfoURL = setServiceInfoURL;\nexports.getServiceInfoURL = getServiceInfoURL;\nconst localizeText_1 = require(\"./localizeText\");\nObject.defineProperty(exports, \"setPreferredLocales\", { enumerable: true, get: function () { return localizeText_1.setPreferredLocales; } });\n// todo change when in production\nlet serviceInfoUrl = 'https://demo.datasafe.dev/reg/service/info';\n/**\n * Set default service info URL\n */\nfunction setServiceInfoURL(url) {\n    serviceInfoUrl = url;\n}\n/**\n * Get default service info URL\n */\nfunction getServiceInfoURL() {\n    return serviceInfoUrl;\n}\n//# sourceMappingURL=settings.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StreamsAutoCreate = void 0;\nconst errors_1 = require(\"../errors\");\nconst HDSModelInitAndSingleton_1 = require(\"../HDSModel/HDSModelInitAndSingleton\");\nconst StreamsTools_1 = require(\"./StreamsTools\");\nclass StreamsAutoCreate {\n    connection;\n    knownStreams = {};\n    /**\n     * Safe way to create StreamsAutoCreate as it check if ones is already attached to connection\n     */\n    static attachToConnection(connection, knownStreamStructure) {\n        const streamsAutoCreate = connection.streamsAutoCreate || new StreamsAutoCreate(connection);\n        streamsAutoCreate.addStreamStructure(knownStreamStructure);\n        return streamsAutoCreate;\n    }\n    /**\n     * @private\n     * Don't use.. use StreamsAutoCreate.attachToConnection\n     */\n    constructor(connection) {\n        // make connection a weak reference to avoid cycles\n        this.connection = new WeakRef(connection);\n        this.knownStreams = {};\n        connection.streamsAutoCreate = this;\n    }\n    /**\n     * @param keysOrDefs - Array or Set of itemDefs or itemKeys\n     */\n    async ensureExistsForItems(keysOrDefs) {\n        // get existing streamIds;\n        const modelStreams = (0, HDSModelInitAndSingleton_1.getModel)().streams;\n        const streamsToCreate = modelStreams.getNecessaryListForItems(Array.from(keysOrDefs), { knowExistingStreamsIds: this.knowStreamIds() });\n        const apiCalls = streamsToCreate.map((s) => ({\n            method: 'streams.create',\n            params: s\n        }));\n        const connection = this.connection?.deref();\n        if (!connection) {\n            throw new Error('Lost reference to connection');\n        }\n        const results = await connection.api(apiCalls);\n        const streamsCreated = [];\n        const errors = [];\n        for (const result of results) {\n            if (result.stream?.id) {\n                streamsCreated.push(result.stream);\n                continue;\n            }\n            if (result.error) {\n                if (result.error.id === 'item-already-exists')\n                    continue; // all OK\n                errors.push(result.error);\n                continue;\n            }\n            // shouldn't be there\n            errors.push({\n                id: 'unexpected-error',\n                message: 'Unexpected content in api response',\n                data: result\n            });\n        }\n        if (errors.length > 0) {\n            throw new errors_1.HDSLibError('Error creating streams', errors);\n        }\n        return streamsCreated;\n    }\n    knowStreamIds() {\n        return Object.keys(this.knownStreams);\n    }\n    addStreamStructure(streamStructure) {\n        if (streamStructure == null)\n            return;\n        for (const stream of (0, StreamsTools_1.allStreamsAndChildren)(streamStructure)) {\n            this.#addStream(stream);\n        }\n    }\n    #addStream(stream) {\n        if (!this.knownStreams[stream.id]) {\n            this.knownStreams[stream.id] = {};\n        }\n    }\n}\nexports.StreamsAutoCreate = StreamsAutoCreate;\n//# sourceMappingURL=StreamsAutoCreate.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.allStreamsAndChildren = allStreamsAndChildren;\nexports.getStreamIdAndChildrenIds = getStreamIdAndChildrenIds;\n/**\n * Iterate all streams and children\n */\nfunction* allStreamsAndChildren(streamStructure) {\n    for (const stream of streamStructure) {\n        yield stream;\n        if (stream.children && stream.children.length > 0) {\n            for (const child of allStreamsAndChildren(stream.children)) {\n                yield child;\n            }\n        }\n    }\n}\nfunction getStreamIdAndChildrenIds(stream) {\n    const streamIds = [];\n    for (const s of allStreamsAndChildren([stream])) {\n        streamIds.push(s.id);\n    }\n    return streamIds;\n}\n//# sourceMappingURL=StreamsTools.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StreamTools = exports.StreamsAutoCreate = void 0;\nconst StreamsAutoCreate_1 = require(\"./StreamsAutoCreate\");\nObject.defineProperty(exports, \"StreamsAutoCreate\", { enumerable: true, get: function () { return StreamsAutoCreate_1.StreamsAutoCreate; } });\nconst StreamTools = __importStar(require(\"./StreamsTools\"));\nexports.StreamTools = StreamTools;\n//# sourceMappingURL=index.js.map","\"use strict\";\n/**\n * Set of Misc utilities\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.waitUntilFalse = waitUntilFalse;\nexports.deepFreeze = deepFreeze;\n/**\n * Timed semaphore\n */\nasync function waitUntilFalse(callBackToReturnFalse, maxWaitMs = 5000) {\n    const started = Date.now();\n    while (callBackToReturnFalse()) {\n        await new Promise((resolve) => { setTimeout(resolve, 100); });\n        if (Date.now() - started > maxWaitMs)\n            throw new Error(`Timeout after ${maxWaitMs}ms`);\n    }\n}\n/**\n * Recursively make immutable an object\n */\nfunction deepFreeze(object) {\n    // Retrieve the property names defined on object\n    const propNames = Reflect.ownKeys(object);\n    // Freeze properties before freezing self\n    for (const name of propNames) {\n        const value = object[name];\n        if ((value && typeof value === 'object') || typeof value === 'function') {\n            deepFreeze(value);\n        }\n    }\n    return Object.freeze(object);\n}\n//# sourceMappingURL=utils.js.map","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst EventEmitter = require('events');\nconst UpdateMethod = require('./UpdateMethod/');\nconst _updateEvents = require('./lib/updateEvents');\nconst _updateStreams = require('./lib/updateStreams');\nconst Changes = require('./lib/Changes');\n\n/**\n * Monitor changes on a Pryv.io account.\n * Emits events when data changes are detected.\n * @memberof pryv\n * @extends EventEmitter\n */\nclass Monitor extends EventEmitter {\n  /**\n   * Create a new Monitor\n   * @param {(string|Connection)} apiEndpointOrConnection - API endpoint URL or Connection instance\n   * @param {MonitorScope} [eventsGetScope={}] - The scope to monitor (events.get parameters)\n   */\n  constructor (apiEndpointOrConnection, eventsGetScope = {}) {\n    super();\n    // @ts-ignore - pryv is set at runtime by extendPryvMonitor\n    if (!Monitor.pryv) {\n      throw new Error('package \\'@pryv/monitor\\' must loaded after package \\'pryv\\'');\n    }\n\n    this.eventsGetScope = { // default eventsGetScope values\n      fromTime: -Number.MAX_VALUE,\n      toTime: Number.MAX_VALUE,\n      modifiedSince: -Number.MAX_VALUE\n    };\n    Object.assign(this.eventsGetScope, eventsGetScope);\n\n    // @ts-ignore - pryv is set at runtime\n    if (apiEndpointOrConnection instanceof Monitor.pryv.Connection) {\n      this.connection = apiEndpointOrConnection;\n    } else {\n      // @ts-ignore - pryv is set at runtime\n      this.connection = new Monitor.pryv.Connection(apiEndpointOrConnection);\n    }\n    this.states = {\n      started: false,\n      starting: false, // in phase of initializing\n      updatingEvents: false, // semaphore to prevent updating events in parallel\n      updatingStreams: false // semaphore to prevent updating streams in parallel\n    };\n  }\n\n  /**\n   * Start the monitor and perform initial sync\n   * @returns {Promise<Monitor>} Promise resolving to this Monitor instance\n   */\n  async start () {\n    if (this.states.started || this.states.starting) return this;\n    this.states.starting = true;\n    await _updateStreams(this);\n    await _updateEvents(this);\n    // once initialized we for the eventsGetScope to request also deletions\n    this.eventsGetScope.includeDeletions = true;\n    this.eventsGetScope.state = 'all';\n\n    this.states.starting = false;\n    this.states.started = true;\n    this.ready();\n    return this;\n  }\n\n  /**\n   * Request an events update according to the current scope\n   * @returns {Promise<Monitor>} Promise resolving to this Monitor instance\n   */\n  async updateEvents () {\n    if (!this.states.started) {\n      throw new Error('Start Monitor before calling update Events');\n    }\n    if (this.states.updatingEvents) { // semaphore\n      this.states.updateEventRequired = true;\n      return this;\n    }\n\n    this.states.updatingEvents = true;\n    try {\n      this.states.updateEventRequired = false;\n      await _updateEvents(this);\n    } catch (e) {\n      this.emit(Changes.ERROR, e);\n    }\n    this.states.updatingEvents = false;\n\n    if (this.states.updateEventRequired) { // if another event update is required\n      setTimeout(function () {\n        this.updateEvents();\n      }.bind(this), 1);\n    } else {\n      this.ready();\n    }\n    return this;\n  }\n\n  /**\n   * Request a streams update\n   * @returns {Promise<Monitor>} Promise resolving to this Monitor instance\n   */\n  async updateStreams () {\n    if (!this.states.started) {\n      throw new Error('Start Monitor before calling update Streams');\n    }\n    if (this.states.updatingStreams) { // semaphore\n      this.states.updateStreamsRequired = true;\n      return this;\n    }\n\n    this.states.updatingStreams = true;\n    try {\n      this.states.updateStreamsRequired = false;\n      await _updateStreams(this);\n    } catch (e) {\n      this.emit(Changes.ERROR, e);\n    }\n    this.states.updatingStreams = false;\n\n    if (this.states.updateStreamsRequired) { // if another streams update is required\n      setTimeout(function () {\n        this.updateStreams();\n      }.bind(this), 1);\n    } else {\n      this.ready();\n    }\n    return this;\n  }\n\n  /**\n   * @private\n   * Called after init phase and each updateEvents\n   * Advertise the update method or any listener that the Monitor is ready\n   * for a next event update\n   */\n  ready () {\n    if (!this.states.started) return; // it might be stoped\n    this.emit(Changes.READY);\n  }\n\n  /**\n   * Stop monitoring (no event will be fired anymore)\n   * @returns {Monitor} this\n   */\n  stop () {\n    if (!this.states.started) return this;\n    if (this.states.starting) throw new Error('Process is starting, wait for the end of initialization to stop it');\n    this.emit(Changes.STOP);\n    this.states.started = false;\n    return this;\n  }\n\n  /**\n   * Used by updateMethods to be sure they can call updateXXX methods\n   * @property {Boolean} started - true is monitor is started\n   */\n  get started () {\n    return this.states.started;\n  }\n\n  /**\n   * @private\n   * Called by UpdateMethod to share cross references\n   * Set a custom update method\n   * @param {Object} updateMethod - the auto-update method\n   * @returns {Monitor} this\n   */\n  addUpdateMethod (updateMethod) {\n    updateMethod.setMonitor(this);\n    return this;\n  }\n}\n\nMonitor.UpdateMethod = UpdateMethod;\nmodule.exports = Monitor;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst UpdateMethod = require('./UpdateMethod');\n\n/**\n * Update method that polls for event changes at a fixed interval.\n * @memberof pryv.Monitor\n * @extends UpdateMethod\n */\nclass EventsTimer extends UpdateMethod {\n  /**\n   * @param {number} updateRateMS - The refresh rate in milliseconds (must be > 1)\n   */\n  constructor (updateRateMS) {\n    super();\n    this.timer = null;\n    if (!updateRateMS || isNaN(updateRateMS) || updateRateMS < 1) {\n      throw new Error('Monitor timer refresh rate is not valid. It should be a number > 1');\n    }\n    this.updateRateMS = updateRateMS;\n  }\n\n  async ready () {\n    if (this.timer != null) clearTimeout(this.timer);\n    this.timer = setTimeout(() => {\n      if (this.monitor.started) this.monitor.updateEvents();\n    }, this.updateRateMS);\n  }\n}\n\nmodule.exports = EventsTimer;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nconst UpdateMethod = require('./UpdateMethod');\nconst Changes = require('../lib/Changes');\n\n/**\n * Update method that uses @pryv/socket.io events for real-time updates.\n * Requires @pryv/socket.io to be loaded.\n * @memberof pryv.Monitor\n * @extends UpdateMethod\n */\nclass Socket extends UpdateMethod {\n  async ready () {\n    if (this.socket) return;\n    // @ts-ignore - socket is added by @pryv/socket.io extension\n    if (!this.monitor.connection.socket) {\n      throw new Error('You should load package @pryv/socket.io to use monitor with websockets');\n    }\n    // @ts-ignore - socket is added by @pryv/socket.io extension\n    this.socket = await this.monitor.connection.socket.open();\n    this.socket.on('eventsChanged', () => { this.monitor.updateEvents(); });\n    this.socket.on('streamsChanged', () => { this.monitor.updateStreams(); });\n    this.socket.on('error', (error) => { this.monitor.emit(Changes.ERROR, error); });\n  }\n\n  async stop () {\n    if (!this.socket) return;\n    try { this.socket.close(); } catch (e) { }\n    this.socket = null;\n  }\n}\nmodule.exports = Socket;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Changes = require('../lib/Changes');\n/**\n * Base class for update methods used by Monitor.\n * Subclass this to create custom update strategies.\n * @memberof pryv.Monitor\n */\nclass UpdateMethod {\n  /**\n   * Assign a Monitor to this updater.\n   * Usually called by the monitor itself on monitor.addUpdateMethod()\n   * @param {Monitor} monitor - The monitor to attach to\n   */\n  setMonitor (monitor) {\n    if (this.monitor) {\n      throw new Error('An update Method can be assigned to one monitor only');\n    }\n    this.monitor = monitor;\n    // @ts-ignore - Changes.READY and Changes.STOP are valid event names\n    monitor.on(Changes.READY, this.ready.bind(this));\n    // @ts-ignore\n    monitor.on(Changes.STOP, this.stop.bind(this));\n    if (monitor.started) {\n      this.ready();\n    }\n  }\n\n  /**\n   * Called when all update tasks are done and monitor is ready for next update.\n   * Override in subclasses to implement custom behavior.\n   * @returns {Promise<void>}\n   */\n  async ready () { }\n\n  /**\n   * Called when monitor is stopped. Override to clean up resources.\n   * @returns {Promise<void>}\n   */\n  async stop () { }\n}\n\nmodule.exports = UpdateMethod;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nmodule.exports = {\n  Null: require('./UpdateMethod'),\n  Socket: require('./Socket'),\n  EventsTimer: require('./EventsTimer')\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Monitor = require('./Monitor');\nconst Changes = require('./lib/Changes');\n\nMonitor.Changes = Changes;\n\n/**\n * Load Monitor capabilities onto `pryv`\n * @param {pryv} pryv `pryv` library @see https://github.com/pryv/lib-js\n */\nmodule.exports = function (pryv) {\n  console.log('Pryv version', pryv.version);\n  // check version here\n  if (pryv.Monitor) {\n    throw new Error('Monitor already loaded');\n  }\n  // sharing cross references\n  pryv.Monitor = Monitor;\n  // TODO: remove deprecated `Pryv` alias with next major version\n  Monitor.pryv = Monitor.Pryv = pryv;\n  return Monitor;\n};\n\n/**\n * @typedef pryv.Monitor.Changes\n * @property {string} EVENT \"event\" fired on new or changed event\n * @property {string} EVENT_DELETE \"eventDelete\"\n * @property {string} STREAMS \"streams\"\n * @property {string} ERROR \"error\"\n * @property {string} READY \"ready\"\n * @property {string} STOP \"stop\"\n */\n\n/**\n * A scope corresponding to EventGetParameters @see https://l.backloop.dev:4443/reference#get-events\n * Property `limit` cannot be specified;\n * @typedef {Object} pryv.Monitor.Scope\n * @property {timestamp} [fromTime=TIMERANGE_MIN] (in seconds)\n * @property {timestamp} [toTime=TIMERANGE_MAX] (in seconds)\n * @property {string[]} [streams] - array of streamIds\n * @property {string[]} [tags] - array of tags\n * @property {string[]} [types] - array of EventTypes\n * @property {boolean} [running]\n * @property {boolean} [sortAscending] - If true, events will be sorted from oldest to newest. ! with monitors, this will only determine the way monitor will receive events on each update. The order they will be notified to listener cannot be guranted.\n * @property {('default'|'trashed'|'all')} [state]\n * @property {boolean} [includeDeletions]\n * @property {timestamp} modifiedSince - (in seconds) only events modified after this date\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * Enum trigger messages\n * @readonly\n * @enum {string}\n */\nconst Changes = {\n  EVENT: 'event',\n  EVENT_DELETE: 'eventDelete',\n  STREAMS: 'streams',\n  ERROR: 'error',\n  READY: 'ready',\n  STOP: 'stop'\n};\n\nmodule.exports = Changes;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Changes = require('./Changes');\n\nmodule.exports = async function _updateEvents (monitor) {\n  function forEachEvent (event) {\n    // update eventsGetScope with \"latest modified\" information found\n    if (event.modified > monitor.eventsGetScope.modifiedSince) {\n      monitor.eventsGetScope.modifiedSince = event.modified;\n    }\n    if (event.deleted) {\n      // event.delete is actually the date it was deleted.\n      // use it as \"modified\" information\n      if (event.deleted > monitor.eventsGetScope.modifiedSince) {\n        monitor.eventsGetScope.modifiedSince = event.deleted;\n      }\n      monitor.emit(Changes.EVENT_DELETE, event);\n    } else {\n      monitor.emit(Changes.EVENT, event);\n    }\n  }\n  try {\n    await monitor.connection.getEventsStreamed(monitor.eventsGetScope, forEachEvent);\n  } catch (e) {\n    monitor.emit(Changes.ERROR, e);\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Changes = require('./Changes');\n\nmodule.exports = async function _updateStreams (monitor) {\n  try {\n    const result = await monitor.connection.get('streams');\n    if (!result.streams) { throw new Error('Invalid response ' + JSON.stringify(result)); }\n    monitor.emit(Changes.STREAMS, result.streams);\n  } catch (e) {\n    monitor.emit(Changes.ERROR, e);\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst io = require('socket.io-client');\nconst { EventEmitter } = require('events');\n\nconst EVENTS = ['eventsChanged', 'streamsChanged', 'accessesChanged', 'disconnect', 'error'];\n\n/**\n * Socket.IO transport for a Connection.\n * Use connection.socket to access the instance associated with a Connection.\n * @memberof pryv\n * @extends EventEmitter\n */\nclass SocketIO extends EventEmitter {\n  /**\n   * @param {Connection} connection - The connection to bind to\n   */\n  constructor (connection) {\n    super();\n    /** @type {Connection} */\n    this.connection = connection;\n    /** @type {boolean} */\n    this.connecting = false;\n    this._io = null;\n  }\n\n  /**\n   * Open the Socket.IO stream\n   * @throws {Error} On connection failures\n   * @returns {Promise<SocketIO>} Promise resolving to this SocketIO instance\n   */\n  async open () {\n    return new Promise((resolve, reject) => {\n      if (this._io) return resolve(this);\n      if (this.connecting) return reject(new Error('open() process in course'));\n      this.connecting = true;\n\n      this.connection.username()\n        .then(username => {\n          const socketEndpoint = this.connection.endpoint + username + '?auth=' + this.connection.token;\n          // @ts-ignore - io is callable in socket.io-client\n          this._io = io(socketEndpoint, { forceNew: true });\n\n          // handle failure\n          for (const errcode of ['connect_error', 'connection_failed', 'error', 'connection_timeout']) {\n            const myCode = errcode;\n            this._io.on(errcode, (e) => {\n              if (!this.connecting) return; // do not care about errors if connected\n\n              this._io = null;\n              this.connecting = false;\n              if (e === null) { e = myCode; }\n              if (!(e instanceof Error)) { e = new Error(e); }\n\n              try { this._io.close(); } catch (ex) { }\n              return reject(e);\n            });\n          }\n\n          // handle success\n          this._io.on('connect', () => {\n            this.connecting = false;\n            registerListeners(this);\n            resolve(this);\n          });\n        })\n        .catch(e => {\n          this._io = null;\n          this.connecting = false;\n          return reject(e);\n        });\n    });\n  }\n\n  /**\n   * Close the socket\n   */\n  close () {\n    checkOpen(this);\n    this._io.close();\n  }\n\n  /**\n   * Add listener for Socket.IO events\n   * @param {('eventsChanged'|'streamsChanged'|'accessesChanged'|'disconnect'|'error')} eventName - The event to listen for\n   * @param {Function} listener - The callback function\n   * @returns {SocketIO} this\n   */\n  // @ts-ignore - overriding EventEmitter.on with restricted signature\n  on (eventName, listener) {\n    checkOpen(this);\n    if (EVENTS.indexOf(eventName) < 0) {\n      throw new Error('Unkown event [' + eventName + ']. Allowed events are: ' + EVENTS);\n    }\n    // @ts-ignore\n    return super.on(eventName, listener);\n  }\n\n  /**\n   * Identical to Connection.api() but using Socket.IO transport\n   * @param {Array<MethodCall>} arrayOfAPICalls - Array of Method Calls\n   * @param {Function} [progress] - Return percentage of progress (0 - 100)\n   * @returns {Promise<Array>} Promise to Array of results matching each method call in order\n   */\n  async api (arrayOfAPICalls, progress) {\n    checkOpen(this);\n    function httpHandler (batchCall) {\n      return new Promise((resolve, reject) => {\n        this._io.emit('callBatch', batchCall, function (err, res) {\n          if (err) return reject(err);\n          resolve(res);\n        });\n      });\n    }\n    return await this.connection._chunkedBatchCall(arrayOfAPICalls, progress, httpHandler.bind(this));\n  }\n}\n\n// private method to fence the usage of socket before being open\nfunction checkOpen (socket) {\n  if (!socket._io) throw new Error('Initialize socket.io with connection.socket.open() before');\n}\n\n// private method to register to all events for an open socket\n// and relay it.\nfunction registerListeners (socket) {\n  for (const event of EVENTS) {\n    socket._io.on(event, (...args) => {\n      socket.emit(event, ...args);\n    });\n  }\n}\n\nmodule.exports = function (Connection) {\n  Object.defineProperty(Connection.prototype, 'socket', {\n    get: function () {\n      if (this._socket) return this._socket;\n      this._socket = new SocketIO(this);\n      return this._socket;\n    }\n  });\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst SocketIO = require('./SocketIO');\n\n/**\n * Load Socket.IO capabilities onto `pryv`\n * @param {pryv} pryv `pryv` library @see https://github.com/pryv/lib-js\n */\nmodule.exports = function (pryv) {\n  console.log('\"pryv\" lib version', pryv.version);\n  // check version here\n  if (pryv.Connection.SocketIO) {\n    throw new Error('Socket.IO add-on already loaded');\n  }\n  // sharing cross references\n  pryv.Connection.SocketIO = SocketIO;\n  SocketIO(pryv.Connection);\n};\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\tlet m;\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\t// eslint-disable-next-line no-return-assign\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && (m = navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)) && parseInt(m[1], 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug') || exports.storage.getItem('DEBUG') ;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '')\n\t\t\t.trim()\n\t\t\t.replace(/\\s+/g, ',')\n\t\t\t.split(',')\n\t\t\t.filter(Boolean);\n\n\t\tfor (const ns of split) {\n\t\t\tif (ns[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(ns.slice(1));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(ns);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the given string matches a namespace template, honoring\n\t * asterisks as wildcards.\n\t *\n\t * @param {String} search\n\t * @param {String} template\n\t * @return {Boolean}\n\t */\n\tfunction matchesTemplate(search, template) {\n\t\tlet searchIndex = 0;\n\t\tlet templateIndex = 0;\n\t\tlet starIndex = -1;\n\t\tlet matchIndex = 0;\n\n\t\twhile (searchIndex < search.length) {\n\t\t\tif (templateIndex < template.length && (template[templateIndex] === search[searchIndex] || template[templateIndex] === '*')) {\n\t\t\t\t// Match character or proceed with wildcard\n\t\t\t\tif (template[templateIndex] === '*') {\n\t\t\t\t\tstarIndex = templateIndex;\n\t\t\t\t\tmatchIndex = searchIndex;\n\t\t\t\t\ttemplateIndex++; // Skip the '*'\n\t\t\t\t} else {\n\t\t\t\t\tsearchIndex++;\n\t\t\t\t\ttemplateIndex++;\n\t\t\t\t}\n\t\t\t} else if (starIndex !== -1) { // eslint-disable-line no-negated-condition\n\t\t\t\t// Backtrack to the last '*' and try to match more characters\n\t\t\t\ttemplateIndex = starIndex + 1;\n\t\t\t\tmatchIndex++;\n\t\t\t\tsearchIndex = matchIndex;\n\t\t\t} else {\n\t\t\t\treturn false; // No match\n\t\t\t}\n\t\t}\n\n\t\t// Handle trailing '*' in template\n\t\twhile (templateIndex < template.length && template[templateIndex] === '*') {\n\t\t\ttemplateIndex++;\n\t\t}\n\n\t\treturn templateIndex === template.length;\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names,\n\t\t\t...createDebug.skips.map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tfor (const skip of createDebug.skips) {\n\t\t\tif (matchesTemplate(name, skip)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (const ns of createDebug.names) {\n\t\t\tif (matchesTemplate(name, ns)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function (val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('../utils');\nconst AuthStates = require('./AuthStates');\nconst Messages = require('./LoginMessages');\n\n/**\n * Controller for authentication flow\n * @memberof pryv.Auth\n */\nclass AuthController {\n  /**\n   * Create an AuthController\n   * @param {AuthSettings} settings - Authentication settings\n   * @param {Service} service - Pryv service instance\n   * @param {CustomLoginButton} loginButton - Login button implementation\n   */\n  constructor (settings, service, loginButton) {\n    this.settings = settings;\n    validateSettings.call(this, settings);\n\n    this.stateChangeListeners = [];\n    if (this.settings.onStateChange) {\n      this.stateChangeListeners.push(this.settings.onStateChange);\n    }\n    this.service = service;\n\n    // probably remove\n    this.languageCode = this.settings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n\n    this.loginButton = loginButton;\n\n    function validateSettings (settings) {\n      if (!settings) { throw new Error('settings cannot be null'); }\n      // -- settings\n      if (!settings.authRequest) { throw new Error('Missing settings.authRequest'); }\n\n      // -- Extract returnURL\n      settings.authRequest.returnURL =\n        this.getReturnURL(settings.authRequest.returnURL);\n\n      if (!settings.authRequest.requestingAppId) {\n        throw new Error('Missing settings.authRequest.requestingAppId');\n      }\n      if (!settings.authRequest.requestedPermissions) {\n        throw new Error('Missing settings.authRequest.requestedPermissions');\n      }\n    }\n  }\n\n  /**\n   * Initialize the auth controller. Call this right after instantiation.\n   * @returns {Promise<Service>} Promise resolving to the Service instance\n   */\n  async init () {\n    this.serviceInfo = this.service.infoSync();\n    this.state = { status: AuthStates.LOADING };\n    this.assets = await loadAssets(this);\n\n    const loginButton = this.loginButton;\n    // initialize human interaction interface\n    if (loginButton != null) {\n      this.stateChangeListeners.push(loginButton.onStateChange.bind(loginButton));\n      // autologin needs cookies/storage implemented in human interaction interface\n      await checkAutoLogin(this);\n    }\n\n    // if auto login is not prompted\n    if (this.state.status !== AuthStates.AUTHORIZED) {\n      this.state = { status: AuthStates.INITIALIZED, serviceInfo: this.serviceInfo };\n    }\n\n    if (loginButton != null && loginButton.finishAuthProcessAfterRedirection != null) {\n      // @ts-ignore - this is a valid AuthController\n      await loginButton.finishAuthProcessAfterRedirection(this);\n    }\n\n    return this.service;\n  }\n\n  /**\n   * Stops poll for auth request\n   */\n  stopAuthRequest (msg) {\n    this.state = { status: AuthStates.ERROR, message: msg };\n  }\n\n  /**\n   * Handle button click - triggers appropriate action based on current state\n   * @returns {Promise<void>}\n   */\n  async handleClick () {\n    if (isAuthorized.call(this)) {\n      this.state = { status: AuthStates.SIGNOUT };\n    } else if (isInitialized.call(this)) {\n      this.startAuthRequest();\n    } else if (isNeedSignIn.call(this)) {\n      // reopen popup (HACK for now: set to private property to avoid self-assignment)\n      this.state = this._state;\n    } else {\n      console.log('Unhandled action in \"handleClick()\" for status:', this.state.status);\n    }\n\n    function isAuthorized () {\n      return this.state.status === AuthStates.AUTHORIZED;\n    }\n    function isInitialized () {\n      return this.state.status === AuthStates.INITIALIZED;\n    }\n    function isNeedSignIn () {\n      return this.state.status === AuthStates.NEED_SIGNIN;\n    }\n  }\n\n  /**\n   * Compute the return URL for authentication redirect.\n   * Used only in browser environments.\n   * @param {string} [returnURL] - The return URL setting ('auto#', 'self#', or custom URL)\n   * @param {string} [windowLocationForTest] - Mock window.location.href for testing\n   * @param {string|Navigator} [navigatorForTests] - Mock navigator for testing\n   * @returns {string|boolean} The computed return URL, or false if using popup mode\n   */\n  getReturnURL (\n    returnURL,\n    windowLocationForTest,\n    navigatorForTests\n  ) {\n    const RETURN_URL_AUTO = 'auto';\n\n    returnURL = returnURL || RETURN_URL_AUTO + '#';\n\n    // check the trailer\n    const trailer = returnURL.slice(-1);\n    if ('#&?'.indexOf(trailer) < 0) {\n      throw new Error('Pryv access: Last character of --returnURL setting-- is not ' +\n        '\"?\", \"&\" or \"#\": ' + returnURL);\n    }\n    // auto mode for desktop\n    if (returnUrlIsAuto(returnURL) &&\n        !utils.browserIsMobileOrTablet(navigatorForTests)) {\n      return false;\n    // auto mode for mobile or self\n    } else if ((returnUrlIsAuto(returnURL) &&\n                utils.browserIsMobileOrTablet(navigatorForTests)) ||\n               returnURL.indexOf('self') === 0) {\n      // set self as return url?\n      // eventually clean-up current url from previous pryv returnURL\n      const locationHref = windowLocationForTest || window.location.href;\n      returnURL = locationHref + returnURL.substring(4);\n    }\n    return utils.cleanURLFromPrYvParams(returnURL);\n\n    function returnUrlIsAuto (returnURL) {\n      return returnURL.indexOf(RETURN_URL_AUTO) === 0;\n    }\n  }\n\n  /**\n   * Start the authentication request and polling process\n   * @returns {Promise<void>}\n   * @see https://pryv.github.io/reference/#auth-request\n   */\n  async startAuthRequest () {\n    // @ts-ignore - postAccess uses .call(this) for context\n    this.state = await postAccess.call(this);\n\n    await doPolling.call(this);\n\n    /** @this {AuthController} */\n    async function postAccess () {\n      try {\n        const { response, body } = await utils.fetchPost(\n          // @ts-ignore - this is bound via .call()\n          this.serviceInfo.access,\n          // @ts-ignore - this is bound via .call()\n          this.settings.authRequest\n        );\n        if (!response.ok) {\n          throw new Error('Access request failed: ' + JSON.stringify(body));\n        }\n        return body;\n      } catch (e) {\n        this.state = {\n          status: AuthStates.ERROR,\n          message: 'Requesting access',\n          error: e\n        };\n        throw e; // forward error\n      }\n    }\n\n    /** @this {AuthController} */\n    async function doPolling () {\n      // @ts-ignore - this is bound via .call()\n      if (this.state?.status !== AuthStates.NEED_SIGNIN) {\n        return;\n      }\n      // @ts-ignore - this is bound via .call()\n      const pollResponse = await pollAccess(this.state?.poll);\n\n      if (pollResponse.status === AuthStates.NEED_SIGNIN) {\n        // @ts-ignore - this is bound via .call()\n        setTimeout(await doPolling.bind(this), this.state?.poll_rate_ms);\n      } else {\n        this.state = pollResponse;\n      }\n\n      async function pollAccess (pollUrl) {\n        try {\n          const { response, body } = await utils.fetchGet(pollUrl);\n          if (response.status === 403 && body?.status === 'REFUSED') {\n            return { status: AuthStates.INITIALIZED };\n          }\n          return body;\n        } catch (e) {\n          return { status: AuthStates.ERROR, message: 'Error while polling for auth request', error: e };\n        }\n      }\n    }\n  }\n\n  // -------------- state listeners ---------------------\n  set state (newState) {\n    // retro-compatibility for lib-js < 2.0.9\n    newState.id = newState.status;\n\n    this._state = newState;\n\n    this.stateChangeListeners.forEach((listener) => {\n      try {\n        listener(this.state);\n      } catch (e) {\n        console.log('Error during set state ()', e);\n      }\n    });\n  }\n\n  get state () {\n    return this._state;\n  }\n}\n\n// ----------- private methods -------------\n\nasync function checkAutoLogin (authController) {\n  const loginButton = authController.loginButton;\n  if (loginButton == null) {\n    return;\n  }\n\n  const storedCredentials = await loginButton.getAuthorizationData();\n  if (storedCredentials != null) {\n    authController.state = Object.assign({}, { status: AuthStates.AUTHORIZED }, storedCredentials);\n  }\n}\n\n// ------------------ ACTIONS  ----------- //\n\nasync function loadAssets (authController) {\n  let loadedAssets = {};\n  try {\n    loadedAssets = await authController.service.assets();\n    if (typeof location !== 'undefined') {\n      await loadedAssets.loginButtonLoadCSS();\n      const thisMessages = await loadedAssets.loginButtonGetMessages();\n      if (thisMessages.LOADING) {\n        authController.messages = Messages(authController.languageCode, thisMessages);\n      } else {\n        console.log('WARNING Messages cannot be loaded using defaults: ', thisMessages);\n      }\n    }\n  } catch (e) {\n    authController.state = {\n      status: AuthStates.ERROR,\n      message: 'Cannot fetch button visuals',\n      error: e\n    };\n    throw e; // forward error\n  }\n  return loadedAssets;\n}\n\nmodule.exports = AuthController;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * The possible auth states:\n * ERROR, LOADING, INITIALIZED, NEED_SIGNIN, AUTHORIZED, SIGNOUT, REFUSED\n * @readonly\n * @enum {string}\n * @memberof pryv.Browser\n */\nmodule.exports = {\n  ERROR: 'ERROR',\n  LOADING: 'LOADING',\n  INITIALIZED: 'INITIALIZED',\n  NEED_SIGNIN: 'NEED_SIGNIN',\n  AUTHORIZED: 'ACCEPTED',\n  SIGNOUT: 'SIGNOUT',\n  REFUSED: 'REFUSED'\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nmodule.exports = get;\n\nconst Messages = {\n  LOADING: {\n    en: '...'\n  },\n  ERROR: {\n    en: 'Error',\n    fr: 'Erreur'\n  },\n  LOGIN: {\n    en: 'Signin',\n    fr: 'Login'\n  },\n  SIGNOUT_CONFIRM: {\n    en: 'Logout?',\n    fr: 'Se dconnecter ?'\n  }\n};\n\nfunction get (languageCode, definitions) {\n  const myMessages = definitions || Messages;\n  const res = {};\n  Object.keys(myMessages).forEach((key) => {\n    res[key] = myMessages[key][languageCode] || myMessages[key].en;\n  });\n  return res;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst AuthController = require('./AuthController');\nconst AuthStates = require('./AuthStates');\nconst LoginButton = require('../Browser/LoginButton');\nconst Service = require('../Service');\n\n/**\n * @memberof pryv\n * @namespace pryv.Auth\n */\nmodule.exports = {\n  setupAuth,\n  AuthStates,\n  AuthController\n};\n\n/**\n * Start an authentication process\n *\n * @memberof pryv.Auth\n * @param {Object} settings\n * @param {Object} settings.authRequest See https://api.pryv.com/reference/#data-structure-access\n * @param {string} [settings.authRequest.languageCode] Language code, as per LoginButton Messages: 'en', 'fr\n * @param {string} settings.authRequest.requestingAppId Application id, ex: 'my-app'\n * @param {Object} settings.authRequest.requestedPermissions\n * @param {string | boolean} settings.authRequest.returnURL : false, // set this if you don't want a popup\n * @param {string} [settings.authRequest.referer] To track registration source\n * @param {string} settings.spanButtonID set and <span> id in DOM to insert default login button or null for custom\n * @param {Function} settings.onStateChange\n * @param {string} [settings.returnURL] Set to \"self#\" to disable popup and force using the same page\n * @param {string} serviceInfoUrl\n * @param {Object} [serviceCustomizations] override properties of serviceInfoUrl\n * @returns {Promise<Service>}\n */\nasync function setupAuth (settings, serviceInfoUrl, serviceCustomizations, HumanInteraction = LoginButton) {\n  const service = new Service(serviceInfoUrl, serviceCustomizations);\n  await service.info();\n\n  const humanInteraction = new HumanInteraction(settings, service);\n  await humanInteraction.init();\n\n  return service;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nconst utils = require('../utils');\n\n/**\n * @memberof pryv.Browser\n * @namespace pryv.Browser.CookieUtils\n */\nmodule.exports = {\n  get,\n  set,\n  del\n};\n\n/**\n  * Set a local cookie\n  * @memberof pryv.Browser.CookieUtils\n  * @template T\n  * @param {string} cookieKey - The key for the cookie\n  * @param {T} value - The value (will be JSON stringified)\n  * @param {number} [expireInDays=365] - Expiration date in days from now\n  */\nfunction set (cookieKey, value, expireInDays) {\n  if (!utils.isBrowser()) return;\n  expireInDays = expireInDays || 365;\n  const myDate = new Date();\n  const hostName = window.location.hostname;\n  const path = window.location.pathname;\n  myDate.setDate(myDate.getDate() + expireInDays);\n  let cookieStr = encodeURIComponent(cookieKey) + '=' +\n    encodeURIComponent(JSON.stringify(value)) +\n    ';expires=' + myDate.toUTCString() +\n    ';domain=.' + hostName + ';path=' + path;\n  // do not add SameSite when removing a cookie\n  if (expireInDays >= 0) cookieStr += ';SameSite=Strict';\n  document.cookie = cookieStr;\n}\n\n/**\n * Return the value of a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @template T\n * @param {string} cookieKey - The key\n * @returns {T|undefined} The parsed cookie value or undefined if not found\n */\nfunction get (cookieKey) {\n  const name = encodeURIComponent(cookieKey);\n  if (!utils.isBrowser()) return;\n  const value = '; ' + document.cookie;\n  const parts = value.split('; ' + name + '=');\n  if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));\n}\n\n/**\n * Delete a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @param {string} cookieKey - The key\n */\nfunction del (cookieKey) {\n  set(cookieKey, { deleted: true }, -1);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Cookies = require('./CookieUtils');\nconst AuthStates = require('../Auth/AuthStates');\nconst AuthController = require('../Auth/AuthController');\nconst Messages = require('../Auth/LoginMessages');\nconst utils = require('../utils');\n\n/* global location, confirm */\n\n/**\n * @memberof pryv.Browser\n */\nclass LoginButton {\n  constructor (authSettings, service) {\n    this.authSettings = authSettings;\n    this.service = service;\n    this.serviceInfo = service.infoSync();\n  }\n\n  /**\n   * setup button and load assets\n   */\n  async init () {\n    // initialize button visuals\n    setupButton(this);\n    this.languageCode = this.authSettings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      await loadAssets(this);\n    }\n    // set cookie key for authorization data\n    this._cookieKey = 'pryv-libjs-' + this.authSettings.authRequest.requestingAppId;\n\n    // initialize controller\n    this.auth = new AuthController(this.authSettings, this.service, this);\n    await this.auth.init();\n\n    return this.service;\n  }\n\n  onClick () {\n    this.auth.handleClick();\n  }\n\n  async onStateChange (state) {\n    switch (state.status) {\n      case AuthStates.LOADING:\n        this.text = getLoadingMessage(this);\n        break;\n      case AuthStates.INITIALIZED:\n        this.text = getInitializedMessage(this, this.serviceInfo.name);\n        break;\n      case AuthStates.NEED_SIGNIN: {\n        const loginUrl = state.authUrl || state.url; // url is deprecated\n        if (this.authSettings.authRequest.returnURL) { // open on same page (no Popup)\n          location.href = loginUrl;\n          return;\n        } else {\n          startLoginScreen(this, loginUrl);\n        }\n        break;\n      }\n      case AuthStates.AUTHORIZED:\n        this.text = state.username;\n        this.saveAuthorizationData({\n          apiEndpoint: state.apiEndpoint,\n          username: state.username\n        });\n        break;\n      case AuthStates.SIGNOUT: {\n        const message = this.messages.SIGNOUT_CONFIRM ? this.messages.SIGNOUT_CONFIRM : 'Logout ?';\n        if (confirm(message)) {\n          this.deleteAuthorizationData();\n          this.auth.init();\n        }\n        break;\n      }\n      case AuthStates.ERROR:\n        this.text = getErrorMessage(this, state.message);\n        break;\n      default:\n        console.log('WARNING Unhandled state for Login: ' + state.status);\n    }\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      // @ts-ignore\n      this.loginButtonText.innerHTML = this.text;\n    }\n  }\n\n  getAuthorizationData () {\n    return Cookies.get(this._cookieKey);\n  }\n\n  saveAuthorizationData (authData) {\n    Cookies.set(this._cookieKey, authData);\n  }\n\n  async deleteAuthorizationData () {\n    Cookies.del(this._cookieKey);\n  }\n\n  /**\n   * not mandatory to implement as non-browsers don't have this behaviour\n   * @param {*} authController\n   */\n  async finishAuthProcessAfterRedirection (authController) {\n    // this step should be applied only for the browser\n    if (!utils.isBrowser()) return;\n\n    // 3. Check if there is a prYvkey as result of \"out of page login\"\n    const url = window.location.href;\n    const pollUrl = retrievePollUrl(url);\n    if (pollUrl !== null) {\n      try {\n        const { body } = await utils.fetchGet(pollUrl);\n        authController.state = body;\n      } catch (e) {\n        authController.state = {\n          status: AuthStates.ERROR,\n          message: 'Cannot fetch result',\n          error: e\n        };\n      }\n    }\n\n    function retrievePollUrl (url) {\n      const params = utils.getQueryParamsFromURL(url);\n      let pollUrl = null;\n      if (params.prYvkey) { // deprecated method - To be removed\n        pollUrl = authController.serviceInfo.access + params.prYvkey;\n      }\n      if (params.prYvpoll) {\n        pollUrl = params.prYvpoll;\n      }\n      return pollUrl;\n    }\n  }\n}\n\nmodule.exports = LoginButton;\n\nasync function startLoginScreen (loginButton, authUrl) {\n  const screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : (document.body.clientHeight - 22);\n  const width = 400;\n  const height = 620;\n  const left = Math.floor(screenX + ((outerWidth - width) / 2));\n  const top = Math.floor(screenY + ((outerHeight - height) / 2.5));\n  const features = (\n    'width=' + width +\n    ',height=' + height +\n    ',left=' + left +\n    ',top=' + top +\n    ',scrollbars=yes'\n  );\n  loginButton.popup = window.open(authUrl, 'prYv Sign-in', features);\n\n  if (!loginButton.popup) {\n    // loginButton.auth.stopAuthRequest('FAILED_TO_OPEN_WINDOW');\n    console.log('Pop-up blocked. A second click should allow it.');\n  } else if (window.focus) {\n    loginButton.popup.focus();\n  }\n}\n\nfunction setupButton (loginBtn) {\n  loginBtn.loginButtonSpan = document.getElementById(loginBtn.authSettings.spanButtonID);\n\n  if (!loginBtn.loginButtonSpan) {\n    console.log('WARNING: pryv.Browser initialized with no spanButtonID');\n  } else {\n    // up to the time the button is loaded use the Span to display eventual\n    // error messages\n    loginBtn.loginButtonText = loginBtn.loginButtonSpan;\n\n    // bind actions dynamically to the button click\n    loginBtn.loginButtonSpan.addEventListener('click', loginBtn.onClick.bind(loginBtn));\n  }\n}\n\n/**\n * Loads the style from the service info\n */\nasync function loadAssets (loginBtn) {\n  const assets = await loginBtn.service.assets();\n  loginBtn.loginButtonSpan.innerHTML = await assets.loginButtonGetHTML();\n  loginBtn.loginButtonText = document.getElementById('pryv-access-btn-text');\n}\n\nfunction getErrorMessage (loginButton, message) {\n  return loginButton.messages.ERROR + ': ' + message;\n}\n\nfunction getLoadingMessage (loginButton) {\n  return loginButton.messages.LOADING;\n}\n\nfunction getInitializedMessage (loginButton, serviceName) {\n  return loginButton.messages.LOGIN + ': ' + serviceName;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst LoginButton = require('./LoginButton');\nconst CookieUtils = require('./CookieUtils');\nconst utils = require('../utils');\n\n/**\n * @memberof pryv\n * @namespace pryv.Browser\n */\nmodule.exports = {\n  LoginButton,\n  CookieUtils,\n  // retro-compatibility for lib-js < 2.0.9\n  AuthStates: require('../Auth/AuthStates'),\n  setupAuth: require('../Auth').setupAuth,\n  serviceInfoFromUrl: getServiceInfoFromURL\n};\n\n/**\n * Util to grab parameters from url query string\n * @param {*} url\n */\nfunction getServiceInfoFromURL (url) {\n  const queryParams = utils.getQueryParamsFromURL(url || window.location.href);\n  return queryParams.pryvServiceInfoUrl;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\nconst jsonParser = require('./lib/json-parser');\nconst libGetEventStreamed = require('./lib/getEventStreamed');\nconst PryvError = require('./lib/PryvError');\nconst buildSearchParams = require('./lib/buildSearchParams');\n\n/**\n * @class Connection\n * A connection is an authenticated link to a Pryv.io account.\n *\n * @type {TokenAndEndpoint}\n *\n * @example\n * create a connection for the user 'tom' on 'pryv.me' backend with the token 'TTZycvBTiq'\n * const conn = new pryv.Connection('https://TTZycvBTiq@tom.pryv.me');\n *\n * @property {string} [token]\n * @property {string} endpoint\n * @memberof pryv\n *\n * @constructor\n * @this {Connection}\n * @param {APIEndpoint} apiEndpoint\n * @param {pryv.Service} [service] - eventually initialize Connection with a Service\n */\nclass Connection {\n  constructor (apiEndpoint, service) {\n    const { token, endpoint } = utils.extractTokenAndAPIEndpoint(apiEndpoint);\n    this.token = token;\n    this.endpoint = endpoint;\n    this.options = {};\n    this.options.chunkSize = 1000;\n    this._deltaTime = { value: 0, weight: 0 };\n    if (service && !(service instanceof Service)) {\n      throw new Error('Invalid service param');\n    }\n    this._service = service;\n  }\n\n  /**\n   * get pryv.Service object relative to this connection\n   * @readonly\n   * @property {pryv.Service} service\n   */\n  get service () {\n    if (this._service) return this._service;\n    this._service = new Service(this.endpoint + 'service/info');\n    return this._service;\n  }\n\n  /**\n   * Get username for this connection.\n   * It's async as it's constructed from access info.\n   * @returns {Promise<string>} Promise resolving to the username\n   */\n  async username () {\n    const accessInfo = await this.accessInfo();\n    if (accessInfo.error) {\n      throw new PryvError(\n        'Failed fetching accessinfo: ' + accessInfo.error.message,\n        accessInfo.error\n      );\n    }\n    // @ts-ignore - username is always a string\n    return accessInfo.user.username;\n  }\n\n  /**\n   * Get access info for this connection.\n   * It's async as it is fetched from the API.\n   * @returns {Promise<AccessInfo>} Promise resolving to the access info\n   */\n  async accessInfo () {\n    return this.get('access-info', null);\n  }\n\n  /**\n   * Issue a Batch call https://api.pryv.com/reference/#call-batch .\n   * arrayOfAPICalls will be splited in multiple calls if the size is > `conn.options.chunkSize` .\n   * Default chunksize is 1000.\n   * @param {Array.<MethodCall>} arrayOfAPICalls Array of Method Calls\n   * @param {Function} [progress] Return percentage of progress (0 - 100);\n   * @returns {Promise<Array>} Promise to Array of results matching each method call in order\n   */\n  async api (arrayOfAPICalls, progress) {\n    function httpHandler (batchCall) {\n      return this.post('', batchCall);\n    }\n    return await this._chunkedBatchCall(\n      arrayOfAPICalls,\n      progress,\n      httpHandler.bind(this)\n    );\n  }\n\n  /**\n   * Make one API call\n   * @param {string} method - Method ID (e.g., 'events.get', 'streams.create')\n   * @param {Object|Array} [params={}] - The params associated with this method\n   * @param {string} [expectedKey] - If given, returns the value of this key or throws an error if not present\n   * @returns {Promise<Object>} Promise resolving to the API result or the value of expectedKey\n   * @throws {Error} If .error is present in the response or expectedKey is missing\n   */\n  async apiOne (method, params = {}, expectedKey) {\n    const result = await this.api([{ method, params }]);\n    if (\n      result[0] == null ||\n      result[0].error ||\n      (expectedKey != null && result[0][expectedKey] == null)\n    ) {\n      const innerObject = result[0]?.error || result;\n      throw new PryvError(\n        `Error for api method: \"${method}\" with params: ${JSON.stringify(\n          params\n        )} >> Result: ${JSON.stringify(innerObject)}\"`,\n        innerObject\n      );\n    }\n    if (expectedKey != null) return result[0][expectedKey];\n    return result[0];\n  }\n\n  /**\n   * Revoke : Delete the accessId\n   * - Do not throw error if access is already revoked, just return null;\n   * @param {boolean} [throwOnFail=true] - if set to false do not throw Error on failure\n   * @param {Connection} [usingConnection] - specify which connection issues the revoke, might be necessary when selfRevoke\n   * @returns {Promise<Object|null>} Promise resolving to deletion result or null if already revoked/failed\n   */\n  async revoke (throwOnFail = true, usingConnection) {\n    usingConnection = usingConnection || this;\n    let accessInfo = null;\n    // get accessId\n    try {\n      accessInfo = await this.accessInfo();\n    } catch (e) {\n      if (e.response?.body?.error?.id === 'invalid-access-token') {\n        return null; // Already revoked OK..\n      }\n      if (throwOnFail) throw e;\n      return null;\n    }\n    // delete access\n    try {\n      const result = usingConnection.apiOne('accesses.delete', {\n        id: accessInfo.id\n      });\n      return result;\n    } catch (e) {\n      if (throwOnFail) throw e;\n      return null;\n    }\n  }\n\n  /**\n   * @private\n   */\n  async _chunkedBatchCall (arrayOfAPICalls, progress, callHandler) {\n    if (!Array.isArray(arrayOfAPICalls)) {\n      throw new Error('Connection.api() takes an array as input');\n    }\n\n    const res = [];\n    let percent = 0;\n    for (\n      let cursor = 0;\n      arrayOfAPICalls.length >= cursor;\n      cursor += this.options.chunkSize\n    ) {\n      const thisBatch = [];\n      const cursorMax = Math.min(\n        cursor + this.options.chunkSize,\n        arrayOfAPICalls.length\n      );\n      // copy only method and params into a back call to be exuted\n      for (let i = cursor; i < cursorMax; i++) {\n        thisBatch.push({\n          method: arrayOfAPICalls[i].method,\n          params: arrayOfAPICalls[i].params\n        });\n      }\n      const resRequest = await callHandler(thisBatch);\n      // result checks\n      if (!resRequest || !Array.isArray(resRequest.results)) {\n        throw new Error(\n          'API call result is not an Array: ' + JSON.stringify(resRequest)\n        );\n      }\n      if (resRequest.results.length !== thisBatch.length) {\n        throw new Error(\n          'API call result Array does not match request: ' +\n            JSON.stringify(resRequest)\n        );\n      }\n\n      // eventually call handleResult\n      for (let i = 0; i < resRequest.results.length; i++) {\n        if (arrayOfAPICalls[i + cursor].handleResult) {\n          await arrayOfAPICalls[i + cursor].handleResult.call(\n            null,\n            resRequest.results[i],\n            thisBatch[i] // request\n          );\n        }\n      }\n      Array.prototype.push.apply(res, resRequest.results);\n      percent = Math.round((100 * res.length) / arrayOfAPICalls.length);\n      if (progress) {\n        progress(percent, res);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Post to API and return results\n   * @param {string} path - API path\n   * @param {(Array | Object)} data - Data to post\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async post (path, data) {\n    const now = getTimestamp();\n    const res = await this._postFetch(path, data);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Post object as JSON to API\n   * @param {string} path - API path\n   * @param {Array | Object} data - Data to post as JSON\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetch (path, data) {\n    return this._postFetchRaw(path, JSON.stringify(data), 'application/json');\n  }\n\n  /**\n   * @private\n   * Raw Post to API\n   * @param {string} path - API path\n   * @param {any} data - Raw data to post\n   * @param {string} [contentType] - Content-Type header (optional, allows fetch to set it for FormData)\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetchRaw (path, data, contentType) {\n    const headers = {\n      Authorization: this.token,\n      Accept: 'application/json'\n    };\n    // optional for form-data llowing fetch to\n    // automatically set multipart/form-data with the correct boundary\n    if (contentType) {\n      headers['Content-Type'] = contentType;\n    }\n    const response = await fetch(this.endpoint + path, {\n      method: 'POST',\n      headers,\n      body: data\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * GET from API and return results\n   * @param {string} path - API path\n   * @param {Object} [queryParams] - Query parameters\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async get (path, queryParams) {\n    const now = getTimestamp();\n    const res = await this._getFetchRaw(path, queryParams);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Raw GET from API\n   * @param {string} path - API path\n   * @param {Object} [queryParams={}] - Query parameters\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _getFetchRaw (path, queryParams = {}) {\n    path = path || '';\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + buildSearchParams(queryParams);\n    }\n    const response = await fetch(this.endpoint + path + queryStr, {\n      headers: {\n        Authorization: this.token,\n        Accept: 'application/json'\n      }\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * Add data points to an HF (High Frequency) series event (flatJSON format)\n   * @param {string} eventId - The HF event ID\n   * @param {string[]} fields - Array of field names for the series\n   * @param {Array<Array<number|string>>} points - Array of data points, each point is an array of values\n   * @returns {Promise<HFSeriesAddResult>} Promise resolving to status response\n   * @see https://api.pryv.com/reference/#add-hf-series-data-points\n   */\n  async addPointsToHFEvent (eventId, fields, points) {\n    const res = await this.post('events/' + eventId + '/series', {\n      format: 'flatJSON',\n      fields,\n      points\n    });\n    if (res.status !== 'ok') {\n      throw new Error('Failed loading serie: ' + JSON.stringify(res.status));\n    }\n    return res;\n  }\n\n  /**\n   * Streamed get Event.\n   * @see https://api.pryv.com/reference/#get-events\n   * @param {Object} queryParams See `events.get` parameters\n   * @param {Function} forEachEvent Function taking one event as parameter. Will be called for each event\n   * @returns {Promise<Object>} Promise to result.body transformed with `eventsCount: {count}` replacing `events: [...]`\n   */\n  async getEventsStreamed (queryParams, forEachEvent) {\n    const myParser = jsonParser(forEachEvent, queryParams.includeDeletions);\n    const res = await libGetEventStreamed(this, queryParams, myParser);\n    const now = getTimestamp();\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * Create an event with attached file\n   * NODE.jS ONLY\n   * @param {Event} event\n   * @param {string} filePath\n   */\n  async createEventWithFile (event, filePath) {\n    const fs = require('fs');\n    const path = require('path');\n\n    if (!fs || !path) {\n      throw new Error('createEventWithFile is only available in Node.js. Use createEventWithFormData in browser.');\n    }\n\n    const fileName = path.basename(filePath);\n    const mimeType = getMimeType(path.extname(filePath));\n    const fileBlob = await fs.openAsBlob(filePath, { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('event', JSON.stringify(event));\n    formData.append('file', fileBlob, fileName);\n\n    const now = getTimestamp();\n    const { body } = await this._postFetchRaw('events', formData);\n    this._handleMeta(body, now);\n    return body;\n  }\n\n  /**\n   * Create an event from a Buffer\n   * @param {Object} event\n   * @param {Buffer|Blob} bufferData - Buffer for node, Blob for browser\n   * @param {string} filename\n   */\n  async createEventWithFileFromBuffer (event, bufferData, filename) {\n    const mimeType = getMimeType(getExtname(filename));\n    const fileBlob = bufferData instanceof Blob\n      ? bufferData\n      // @ts-ignore - Buffer is valid for Blob in Node.js\n      : new Blob([bufferData], { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('file', fileBlob, filename);\n    const body = await this.createEventWithFormData(event, formData);\n    return body;\n  }\n\n  /**\n   * Create an event with attached formData\n   * !! BROWSER ONLY\n   * @param {Event} event\n   * @param {FormData} formData https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData\n   */\n  async createEventWithFormData (event, formData) {\n    formData.append('event', JSON.stringify(event));\n    const { body } = await this._postFetchRaw('events', formData);\n    return body;\n  }\n\n  /**\n   * Difference in seconds between the Pryv.io API and local time\n   * deltaTime is refined at each (non-raw) API call\n   * @readonly\n   * @property {number} deltaTime\n   */\n  get deltaTime () {\n    return this._deltaTime.value;\n  }\n\n  /**\n   * API endpoint of this connection (includes token if present)\n   * @readonly\n   * @property {APIEndpoint} apiEndpoint\n   */\n  get apiEndpoint () {\n    return utils.buildAPIEndpoint(this);\n  }\n\n  // private method that handle meta data parsing\n  _handleMeta (res, requestLocalTimestamp) {\n    if (!res.meta) throw new Error('Cannot find .meta in response.');\n    if (!res.meta.serverTime) { throw new Error('Cannot find .meta.serverTime in response.'); }\n\n    // update deltaTime and weight it\n    this._deltaTime.value =\n      (this._deltaTime.value * this._deltaTime.weight +\n        res.meta.serverTime -\n        requestLocalTimestamp) /\n      ++this._deltaTime.weight;\n  }\n}\n\nmodule.exports = Connection;\n\nfunction getTimestamp () {\n  return Date.now() / 1000;\n}\n\nconst MIME_TYPES = {\n  '.png': 'image/png',\n  '.jpg': 'image/jpeg',\n  '.jpeg': 'image/jpeg',\n  '.gif': 'image/gif',\n  '.webp': 'image/webp',\n  '.svg': 'image/svg+xml',\n  '.bmp': 'image/bmp',\n  '.ico': 'image/x-icon',\n  '.pdf': 'application/pdf',\n  '.json': 'application/json',\n  '.xml': 'application/xml',\n  '.zip': 'application/zip',\n  '.gz': 'application/gzip',\n  '.tar': 'application/x-tar',\n  '.txt': 'text/plain',\n  '.html': 'text/html',\n  '.htm': 'text/html',\n  '.css': 'text/css',\n  '.js': 'application/javascript',\n  '.mjs': 'application/javascript',\n  '.mp3': 'audio/mpeg',\n  '.wav': 'audio/wav',\n  '.ogg': 'audio/ogg',\n  '.mp4': 'video/mp4',\n  '.webm': 'video/webm',\n  '.avi': 'video/x-msvideo',\n  '.mov': 'video/quicktime'\n};\n\nfunction getMimeType (ext) {\n  return MIME_TYPES[ext.toLowerCase()] || 'application/octet-stream';\n}\n\nfunction getExtname (filename) {\n  const lastDot = filename.lastIndexOf('.');\n  return lastDot >= 0 ? filename.slice(lastDot) : '';\n}\n\n// service is require \"after\" to allow circular require\nconst Service = require('./Service');\n\n/**\n * API Method call, for batch call https://api.pryv.com/reference/#call-batch\n * @typedef {Object} MethodCall\n * @property {string} method - The method id\n * @property {(Object|Array)}  params - The call parameters as required by the method.\n * @property {(Function|Promise)} [handleResult] - Will be called with the result corresponding to this specific call.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n// Connection is required at the end of this file to allow circular requires.\nconst Assets = require('./ServiceAssets.js');\n\n/**\n * @class pryv.Service\n * A Pryv.io deployment is a unique \"Service\", as an example **Pryv Lab** is a service, deployed with the domain name **pryv.me**.\n *\n * `pryv.Service` exposes tools to interact with Pryv.io at a \"Platform\" level.\n *\n *  ##### Initizalization with a service info URL\n```js\nconst service = new pryv.Service('https://reg.pryv.me/service/info');\n```\n\n- With the content of a serviceInfo configuration\n\nService information properties can be overriden with specific values. This might be usefull to test new designs on production platforms.\n\n```js\nconst serviceInfoUrl = 'https://reg.pryv.me/service/info';\nconst serviceCustomizations = {\n  name: 'Pryv Lab 2',\n  assets: {\n    definitions: 'https://pryv.github.io/assets-pryv.me/index.json'\n  }\n}\nconst service = new pryv.Service(serviceInfoUrl, serviceCustomizations);\n```\n\n * @memberof pryv\n *\n * @constructor\n * @param {string} serviceInfoUrl Url point to /service/info of a Pryv platform see: {@link https://api.pryv.com/reference/#service-info}\n */\nclass Service {\n  constructor (serviceInfoUrl, serviceCustomizations) {\n    this._serviceInfo = null;\n    this._assets = null;\n    this._polling = false;\n    this._serviceInfoUrl = serviceInfoUrl;\n    this._pryvServiceCustomizations = serviceCustomizations;\n  }\n\n  /**\n   * Return service info parameters info known of fetch it if needed.\n   * Example\n   *  - name of a platform\n   *    `const serviceName = await service.info().name`\n   * @see ServiceInfo For details on available properties.\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceInfo>} Promise to Service info Object\n   */\n  async info (forceFetch) {\n    if (forceFetch || !this._serviceInfo) {\n      let baseServiceInfo = {};\n      if (this._serviceInfoUrl) {\n        const { body } = await utils.fetchGet(this._serviceInfoUrl);\n        baseServiceInfo = body;\n      }\n      Object.assign(baseServiceInfo, this._pryvServiceCustomizations);\n      // @ts-ignore - baseServiceInfo is populated from body or customizations\n      this.setServiceInfo(baseServiceInfo);\n    }\n    return this._serviceInfo;\n  }\n\n  /**\n   * Check if a service supports High Frequency Data Sets\n   * @returns {Promise<boolean>} Promise resolving to true if HF is supported\n   */\n  async supportsHF () {\n    const infos = await this.info();\n    return (infos.features == null || infos.features.noHF !== true);\n  }\n\n  /**\n   * Check if a service has username in the hostname or in the path of the API.\n   * @returns {Promise<boolean>} Promise resolving to true if the service does not rely on DNS to find a host related to a username\n   */\n  async isDnsLess () {\n    const infos = await this.info();\n    const hostname = infos.api.split('/')[2];\n    return !hostname.includes('{username}');\n  }\n\n  /**\n   * @private\n   * @param {ServiceInfo} serviceInfo\n   */\n  setServiceInfo (serviceInfo) {\n    if (!serviceInfo.name) {\n      throw new Error('Invalid data from service/info');\n    }\n    // cleanup serviceInfo for eventual url not finishing by \"/\"\n    // code will be obsolete with next version of register\n    ['access', 'api', 'register'].forEach((key) => {\n      if (serviceInfo[key].slice(-1) !== '/') {\n        serviceInfo[key] += '/';\n      }\n    });\n    this._serviceInfo = serviceInfo;\n  }\n\n  /**\n   * Return assets property content\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceAssets|null>} Promise to ServiceAssets\n   */\n  async assets (forceFetch) {\n    if (!forceFetch && this._assets) {\n      return this._assets;\n    } else {\n      const serviceInfo = await this.info();\n      if (!serviceInfo.assets || !serviceInfo.assets.definitions) {\n        console.log('Warning: no assets for this service');\n        return null;\n      }\n      this._assets = await Assets.setup(serviceInfo.assets.definitions);\n      return this._assets;\n    }\n  }\n\n  /**\n   * Return service info parameters info known or null if not yet loaded\n   * @returns {ServiceInfo} Service Info definition\n   */\n  infoSync () {\n    return this._serviceInfo;\n  }\n\n  /**\n   * Return an API endpoint from a username and token\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {Promise<APIEndpoint>} Promise resolving to the API endpoint URL\n   */\n  async apiEndpointFor (username, token) {\n    const serviceInfo = await this.info();\n    return Service.buildAPIEndpoint(serviceInfo, username, token);\n  }\n\n  /**\n   * Return an API endpoint from a username, token and ServiceInfo.\n   * This method is rarely used. See **apiEndpointFor** as an alternative.\n   * @param {ServiceInfo} serviceInfo - The service info object containing API URL template\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {APIEndpoint} The constructed API endpoint URL\n   */\n  static buildAPIEndpoint (serviceInfo, username, token) {\n    const endpoint = serviceInfo.api.replace('{username}', username);\n    return utils.buildAPIEndpoint({ endpoint, token });\n  }\n\n  /**\n   * Issue a \"login call on the Service\" return a Connection on success\n   * **! Warning**: the token of the connection will be a \"Personal\" token that expires\n   * @see https://api.pryv.com/reference-full/#login-user\n   * @param {string} username\n   * @param {string} password\n   * @param {string} appId\n   * @param {string} [originHeader=service-info.register] Only for Node.js. If not set will use the register value of service info. In browsers this will overridden by current page location.\n   * @throws {Error} on invalid login\n   */\n  async login (username, password, appId, originHeader) {\n    const apiEndpoint = await this.apiEndpointFor(username);\n\n    const headers = {};\n    originHeader = originHeader || (await this.info()).register;\n    if (!utils.isBrowser()) {\n      headers.Origin = originHeader;\n    }\n    const { response, body } = await utils.fetchPost(\n      apiEndpoint + 'auth/login',\n      { username, password, appId },\n      headers\n    );\n\n    if (!response.ok) {\n      if (body?.error?.message) {\n        throw new Error(body.error.message);\n      }\n      throw new Error('Login failed: ' + JSON.stringify(body));\n    }\n\n    if (!body.token) {\n      throw new Error('Invalid login response: ' + JSON.stringify(body));\n    }\n    return new Connection(\n      Service.buildAPIEndpoint(await this.info(), username, body.token),\n      this // Pre load Connection with service\n    );\n  }\n}\n\nmodule.exports = Service;\n\n// Require is done after exports to allow circular references\nconst Connection = require('./Connection');\n\n/**\n * Object to handle Pryv Service Informations https://api.pryv.com/reference/#service-info\n * @typedef {Object} ServiceInfo\n * @property {string} register The URL of the register service.\n * @property {string} access The URL of the access page.\n * @property {string} api The API endpoint format.\n * @property {string} name The platform name.\n * @property {string} home The URL of the platform's home page.\n * @property {string} support The email or URL of the support page.\n * @property {string} terms The terms and conditions, in plain text or the URL displaying them.\n * @property {string} eventTypes The URL of the list of validated event types.\n * @property {Object} [assets] Holder for service specific Assets (icons, css, ...)\n * @property {string} [assets.definitions] URL to json object with assets definitions\n * @property {Object} [features] Platform feature flags\n * @property {boolean} [features.noHF] True if HF data is not supported\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n\n/* global location */\n\n/**\n * Holds Pryv Service informations.\n *\n * It's returned by `service.assets()`\n *\n * @memberof pryv\n **/\nclass ServiceAssets {\n  /**\n   * Private => use ServiceAssets.setup()\n   * @param {Object} assets The content of service/info.assets properties.\n   * @param {string} assetsURL Url point to assets of the service of a Pryv platform\n   */\n  constructor (assets, assetsURL) {\n    this._assets = assets;\n    this._assetsURL = assetsURL;\n  }\n\n  /**\n   * Load Assets definition from URL\n   * @param {string} pryvServiceAssetsSourceUrl - URL to the assets definition JSON\n   * @returns {Promise<ServiceAssets>} Promise resolving to ServiceAssets instance\n   */\n  static async setup (pryvServiceAssetsSourceUrl) {\n    const { body } = await utils.fetchGet(pryvServiceAssetsSourceUrl);\n    return new ServiceAssets(body, pryvServiceAssetsSourceUrl);\n  }\n\n  /**\n   * get a value from path separated by `:`\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  get (keyPath) {\n    let result = Object.assign({}, this._assets);\n    if (keyPath) {\n      keyPath.split(':').forEach((key) => {\n        result = result[key];\n        if (typeof result === 'undefined') return result;\n      });\n    }\n    return result;\n  }\n\n  /**\n   * get an Url from path separated by `:`\n   * identical to doing assets.relativeURL(assets.get(keyPath))\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  getUrl (keyPath) {\n    const url = this.get(keyPath);\n    if (typeof url !== 'string') {\n      throw new Error(`Unexpected value for ${keyPath}: ${url}`);\n    }\n    return this.relativeURL(url);\n  }\n\n  /**\n   * get relativeUrl\n   */\n  relativeURL (url) {\n    return relPathToAbs(this._assets.baseUrl || this._assetsURL, url);\n  }\n\n  // ---------------- Default service resources\n\n  /**\n   * Set all defaults Favicon, CSS\n   */\n  async setAllDefaults () {\n    this.setFavicon();\n    await this.loadCSS();\n  }\n\n  /**\n   * Set service Favicon to Web Page\n   */\n  setFavicon () {\n    /** @type {HTMLLinkElement} */\n    // @ts-ignore - querySelector returns Element but we know it's HTMLLinkElement\n    const link = document.querySelector(\"link[rel*='icon']\") || document.createElement('link');\n    link.type = 'image/x-icon';\n    link.rel = 'shortcut icon';\n    link.href = this.relativeURL(this._assets.favicon.default.url);\n    document.getElementsByTagName('head')[0].appendChild(link);\n  }\n\n  /**\n   * Set default service CSS\n   */\n  async loadCSS () {\n    loadCSS(this.relativeURL(this._assets.css.default.url));\n  }\n\n  // ---- Login\n\n  /**\n   * Load CSS for Login button\n   */\n  async loginButtonLoadCSS () {\n    loadCSS(this.relativeURL(this._assets['lib-js'].buttonSignIn.css));\n  }\n\n  /**\n   * Get HTML for Login Button\n   * @returns {Promise<string>} Promise resolving to HTML string\n   */\n  async loginButtonGetHTML () {\n    const { text } = await utils.fetchGetText(this.relativeURL(this._assets['lib-js'].buttonSignIn.html));\n    return text;\n  }\n\n  /**\n   * Get Messages strings for Login Button\n   * @returns {Promise<Object.<string, string>>} Promise resolving to messages object\n   */\n  async loginButtonGetMessages () {\n    const { body } = await utils.fetchGet(this.relativeURL(this._assets['lib-js'].buttonSignIn.messages));\n    return body;\n  }\n}\n\nmodule.exports = ServiceAssets;\n\nfunction loadCSS (url) {\n  const head = document.getElementsByTagName('head')[0];\n  const link = document.createElement('link');\n  link.id = url;\n  link.rel = 'stylesheet';\n  link.type = 'text/css';\n  link.href = url;\n  link.media = 'all';\n  head.appendChild(link);\n}\n\n/* HACK: disabling linting until code is cleaned up */\n/* eslint-disable */\n\n  /*\\\n  |*| Modified version of\n  |*| :: translate relative paths to absolute paths ::\n  |*|\n  |*| https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\n  |*|\n  |*| The following code is released under the GNU Public License, version 3 or later.\n  |*| http://www.gnu.org/licenses/gpl-3.0-standalone.html\n  |*|\n  \\*/\n\nfunction relPathToAbs (baseUrlString, sRelPath) {\n  /** @type {Location|HTMLAnchorElement} */\n  var baseLocation = location;\n  if (baseUrlString) {\n    // @ts-ignore - HTMLAnchorElement has compatible URL properties\n    baseLocation = document.createElement('a');\n    baseLocation.href = baseUrlString;\n  }\n\n  var nUpLn, sDir = \"\", sPath = baseLocation.pathname.replace(/[^\\/]*$/, sRelPath.replace(/(\\/|^)(?:\\.?\\/+)+/g, \"$1\"));\n  for (var nEnd, nStart = 0; nEnd = sPath.indexOf(\"/../\", nStart), nEnd > -1; nStart = nEnd + nUpLn) {\n    nUpLn = /^\\/(?:\\.\\.\\/)*/.exec(sPath.slice(nEnd))[0].length;\n    sDir = (sDir + sPath.substring(nStart, nEnd)).replace(new RegExp(\"(?:\\\\\\/+[^\\\\\\/]*){0,\" + ((nUpLn - 1) / 3) + \"}$\"),\n      \"/\");\n  }\n  const portStr = baseLocation.port ? ':' + baseLocation.port : '';\n  return baseLocation.protocol + '//' + baseLocation.hostname + portStr + sDir + sPath.substr(nStart);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * `pryv` library\n * @exports pryv\n * @property {pryv.Service} Service - To interact with Pryv.io at a \"Platform level\"\n * @property {pryv.Connection} Connection - To interact with an individual's (user) data set\n * @property {pryv.Browser} Browser - Browser Tools - Access request helpers and visuals (button)\n * @property {pryv.utils} utils - Exposes some utils for HTTP calls and tools to manipulate Pryv's API endpoints\n * @property {pryv.PryvError} PryvError - Custom error class with innerObject support\n */\nmodule.exports = {\n  Service: require('./Service'),\n  Connection: require('./Connection'),\n  Auth: require('./Auth'),\n  Browser: require('./Browser'),\n  utils: require('./utils'),\n  PryvError: require('./lib/PryvError'),\n  version: require('../package.json').version\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Custom error class for Pryv library errors.\n * Includes an innerObject property for wrapping underlying errors.\n * @extends Error\n */\nclass PryvError extends Error {\n  /**\n   * Create a PryvError\n   * @param {string} message - Error message\n   * @param {Error|Object} [innerObject] - The underlying error or object that caused this error\n   */\n  constructor (message, innerObject) {\n    super(message);\n    this.name = 'PryvError';\n    /** @type {Error|Object|undefined} */\n    this.innerObject = innerObject;\n\n    // Maintains proper stack trace for where error was thrown (only in V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, PryvError);\n    }\n  }\n}\n\nmodule.exports = PryvError;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Build URL search params string from an object, properly handling arrays.\n * Arrays are expanded as repeated keys: { a: ['x', 'y'] } => 'a=x&a=y'\n * @param {Object} params - Query parameters object\n * @returns {string} - URL encoded query string\n */\nfunction buildSearchParams (params) {\n  const searchParams = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (Array.isArray(value)) {\n      for (const item of value) {\n        searchParams.append(key, item);\n      }\n    } else if (value !== undefined && value !== null) {\n      searchParams.append(key, value);\n    }\n  }\n  return searchParams.toString();\n}\n\nmodule.exports = buildSearchParams;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/* global fetch */\n\nconst buildSearchParams = require('./buildSearchParams');\n\nmodule.exports = getEventStreamed;\n\nasync function getEventStreamed (conn, queryParam, parser) {\n  /**\n   * Holds Parser's settings\n   */\n  const parserSettings = {\n    ondata: null,\n    onend: null,\n    encoding: 'utf8'\n  };\n\n  /**\n   * Mock Response\n   */\n  const fakeRes = {\n    setEncoding: function (encoding) {\n      parserSettings.encoding = encoding;\n    }, // will receive 'data' and 'end' callbacks\n    on: function (key, f) {\n      parserSettings['on' + key] = f;\n    }\n  };\n\n  /**\n   * Holds results from the parser\n   */\n  let errResult;\n  let bodyObjectResult;\n  /**\n   *\n   */\n  parser(fakeRes, function (err, bodyObject) {\n    errResult = err;\n    bodyObjectResult = bodyObject;\n  });\n\n  // ------------   fetch ------------------- //\n  const url = new URL(conn.endpoint + 'events');\n  url.search = buildSearchParams(queryParam);\n  const fetchParams = { method: 'GET', headers: { Accept: 'application/json' } };\n  if (conn.token) fetchParams.headers.Authorization = conn.token;\n\n  const response = await fetch(url, fetchParams);\n  const reader = response.body.getReader();\n\n  while (true) {\n    const { done, value } = await reader.read();\n    parserSettings.ondata(new TextDecoder(parserSettings.encoding).decode(value));\n    if (done) { parserSettings.onend(); break; }\n  }\n\n  if (errResult) {\n    throw new Error(errResult);\n  }\n\n  // We're done!\n  const result = {\n    text: fakeRes.text, // from the parser\n    body: bodyObjectResult, // from the parser\n    statusCode: response.status,\n    headers: {}\n  };\n  // add headers to result\n  // @ts-ignore - Headers.entries() exists in modern environments\n  for (const pair of response.headers.entries()) {\n    result.headers[pair[0]] = pair[1];\n  }\n\n  return result;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// there two steps 1 find events, then eventDeletions\nconst EVENTMARKERS = ['\"events\":[', '\"eventDeletions\":['];\n\n/**\n * Stremed JSON parser for events\n */\nmodule.exports = function (foreachEvent, includeDeletions) {\n  let eventOrEventDeletions = 0; // start with event\n  let buffer = ''; // temp data\n  let body = null; // to be returned\n\n  // IN EVENTS VARS\n  let depth = 0; // level of depth in brackets\n  let inString = false; // cursor is in a String\n  let skipNextOne = false; // when a backslash is found\n  let cursorPos = 0; // position of Character Cursor\n\n  // counters\n  let eventsCount = 0;\n  let eventDeletionsCount = 0;\n\n  const states = {\n    A_BEFORE_EVENTS: 0,\n    B_IN_EVENTS: 1,\n    D_AFTER_EVENTS: 2\n  };\n\n  let state = states.A_BEFORE_EVENTS;\n\n  function processBuffer () {\n    switch (state) {\n      case states.A_BEFORE_EVENTS:\n        searchStartEvents();\n        break;\n      case states.B_IN_EVENTS:\n        processEvents();\n        break;\n      default:\n        afterEvents();\n        break;\n    }\n  }\n\n  function searchStartEvents () {\n    // search for \"events\": and happend any info before to the body\n    const n = buffer.indexOf(EVENTMARKERS[eventOrEventDeletions]);\n    if (n > 0) {\n      if (eventOrEventDeletions === 0) { // do only once\n        body = buffer.substring(0, n);\n      }\n      buffer = buffer.substr(n + EVENTMARKERS[eventOrEventDeletions].length);\n      state = states.B_IN_EVENTS;\n      processEvents();\n    }\n  }\n\n  function processEvents () {\n    /// ---- in Event\n    while (cursorPos < buffer.length && (state === states.B_IN_EVENTS)) {\n      if (skipNextOne) { // ignore next character\n        skipNextOne = false;\n        cursorPos++;\n        continue;\n      }\n      switch (buffer.charCodeAt(cursorPos)) {\n        case 93: // ]\n          if (depth === 0) { // end of events\n            if (cursorPos !== 0) {\n              throw new Error('Found trailling ] in mid-course');\n            }\n            if (eventOrEventDeletions === 0 && includeDeletions) {\n              state = states.A_BEFORE_EVENTS;\n              eventOrEventDeletions = 1; // now look for eventDeletions\n              return;\n            } else { // done\n              state = states.D_AFTER_EVENTS;\n              let eventsOrDeletionMsg = '';\n              if (eventOrEventDeletions === 1) {\n                eventsOrDeletionMsg = '\"eventDeletionsCount\":' + eventDeletionsCount + ',';\n              }\n              buffer = eventsOrDeletionMsg + '\"eventsCount\":' + eventsCount + '' + buffer.substr(1);\n            }\n          }\n          break;\n        case 92: // \\\n          skipNextOne = true;\n          break;\n        case 123: // {\n          if (!inString) depth++;\n          break;\n        case 34: // \"\n          inString = !inString;\n          break;\n        case 125: // }\n          if (!inString) depth--;\n          if (depth === 0) {\n            // ignore possible coma ',' if first char\n            const ignoreComa = (buffer.charCodeAt(0) === 44) ? 1 : 0;\n            const eventStr = buffer.substring(ignoreComa, cursorPos + 1);\n\n            if (eventOrEventDeletions === 0) {\n              eventsCount++;\n            } else {\n              eventDeletionsCount++;\n            }\n            buffer = buffer.substr(cursorPos + 1);\n            addEvent(eventStr);\n            cursorPos = -1;\n          }\n          break;\n      }\n      cursorPos++;\n    }\n  }\n\n  function afterEvents () {\n    // just happend the end of message;\n    body += buffer;\n    buffer = '';\n  }\n\n  return function (res, fn) {\n    res.setEncoding('utf8'); // Already UTF8 in browsers\n    res.on('data', chunk => {\n      buffer += chunk;\n      processBuffer();\n    });\n    res.on('end', () => {\n      let err;\n      let bodyObject;\n      try {\n        res.text = body + buffer;\n        bodyObject = res.text && JSON.parse(res.text);\n      } catch (err_) {\n        err = err_;\n        // issue #675: return the raw response if the response parsing fails\n        err.rawResponse = res.text || null;\n        // issue #876: return the http status code if the response parsing fails\n        err.statusCode = res.statusCode;\n      } finally {\n        fn(err, bodyObject);\n      }\n    });\n  };\n\n  /// --- Direct Push\n  function addEvent (strEvent) {\n    foreachEvent(JSON.parse(strEvent));\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst regexAPIandToken = /(.+):\\/\\/(.+)@(.+)/gm;\nconst regexSchemaAndPath = /(.+):\\/\\/(.+)/gm;\nconst buildSearchParams = require('./lib/buildSearchParams');\n\n/**\n * Utilities to access Pryv API.\n * @memberof pryv\n * @namespace pryv.utils\n */\nconst utils = module.exports = {\n  /**\n   * Perform a GET request and parse JSON response\n   * @param {string} url - URL to fetch\n   * @param {Object} [queryParams={}] - Query parameters to append\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchGet (url, queryParams = {}, headers = {}) {\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + buildSearchParams(queryParams);\n    }\n    const myHeaders = Object.assign({ Accept: 'application/json' }, headers);\n    const response = await fetch(url + queryStr, { headers: myHeaders });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Perform a GET request and return text response\n   * @param {string} url - URL to fetch\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, text: string}>} Promise resolving to response and text body\n   */\n  async fetchGetText (url, headers = {}) {\n    const myHeaders = Object.assign({ Accept: 'text/html' }, headers);\n    const response = await fetch(url, { headers: myHeaders });\n    const text = await response.text();\n    return { response, text };\n  },\n\n  /**\n   * Perform a POST request with JSON data\n   * @param {string} url - URL to post to\n   * @param {Object} [data] - Data to send as JSON\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchPost (url, data, headers = {}) {\n    const myHeaders = Object.assign({\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    }, headers);\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: myHeaders,\n      body: JSON.stringify(data)\n    });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Returns true is run in a browser\n   * @memberof pryv.utils\n   * @returns {boolean}\n   */\n  isBrowser: function () {\n    return typeof window !== 'undefined' && typeof document !== 'undefined';\n  },\n\n  /**\n   * From a APIEndpoint URL, return an object (TokenAndAPI) with two properties\n   * @memberof pryv.utils\n   * @param {APIEndpoint} apiEndpoint\n   * @returns {TokenAndEndpoint}\n   */\n  extractTokenAndAPIEndpoint: function (apiEndpoint) {\n    regexAPIandToken.lastIndex = 0;\n    const res = regexAPIandToken.exec(apiEndpoint);\n\n    if (res !== null) { // has token\n      // add a trailing '/' to end point if missing\n      if (!res[3].endsWith('/')) {\n        res[3] += '/';\n      }\n      return { endpoint: res[1] + '://' + res[3], token: res[2] };\n    }\n    // else check if valid url\n    regexSchemaAndPath.lastIndex = 0;\n    const res2 = regexSchemaAndPath.exec(apiEndpoint);\n    if (res2 === null) {\n      throw new Error('Cannot find endpoint, invalid URL format');\n    }\n    // add a trailing '/' to end point if missing\n    if (!res2[2].endsWith('/')) {\n      res2[2] += '/';\n    }\n\n    return { endpoint: res2[1] + '://' + res2[2], token: null };\n  },\n\n  /**\n   * Get a APIEndpoint URL from a TokenAndAPI object\n   * @memberof pryv.utils\n   * @param {TokenAndEndpoint} tokenAndAPI\n   * @returns {APIEndpoint}\n   */\n  buildAPIEndpoint: function (tokenAndAPI) {\n    if (!tokenAndAPI.token) {\n      let res = tokenAndAPI.endpoint + '';\n      if (!tokenAndAPI.endpoint.endsWith('/')) {\n        res += '/';\n      }\n      return res;\n    }\n    regexSchemaAndPath.lastIndex = 0;\n    const res = regexSchemaAndPath.exec(tokenAndAPI.endpoint);\n    // add a trailing '/' to end point if missing\n    if (!res[2].endsWith('/')) {\n      res[2] += '/';\n    }\n    return res[1] + '://' + tokenAndAPI.token + '@' + res[2];\n  },\n\n  /**\n   * Check if the browser is running on a mobile device or tablet\n   * @memberof pryv.utils\n   * @param {string|Navigator} [navigator] - Navigator object or user agent string (for testing)\n   * @returns {boolean} True if mobile or tablet\n   */\n  browserIsMobileOrTablet: function (navigator) {\n    if (navigator == null) {\n      return false;\n    }\n    let check = false;\n    // @ts-ignore - navigator is Navigator when not null\n    // eslint-disable-next-line no-useless-escape\n    (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || navigator.opera);\n    return check;\n  },\n\n  /**\n   * Remove Pryv-specific query parameters from URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to clean\n   * @returns {string} URL without prYv* parameters\n   */\n  cleanURLFromPrYvParams: function (url) {\n    const PRYV_REGEXP = /[?#&]+prYv([^=&]+)=([^&]*)/g;\n    return url.replace(PRYV_REGEXP, '');\n  },\n\n  /**\n   * Extract query parameters from a URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to parse\n   * @returns {Object.<string, string>} Object with key-value pairs of query parameters\n   */\n  getQueryParamsFromURL: function (url) {\n    /** @type {Object.<string, string>} */\n    const vars = {};\n    const QUERY_REGEXP = /[?#&]+([^=&]+)=([^&]*)/g;\n    url.replace(QUERY_REGEXP,\n      // @ts-ignore - replace callback is used for side effects\n      function (m, key, value) {\n        vars[key] = decodeURIComponent(value);\n      });\n    return vars;\n  }\n};\n\n// TODO: remove following deprecated aliases with next major version\n\n/**\n * @deprecated Renamed to `extractTokenAndAPIEndpoint()`\n */\nutils.extractTokenAndApiEndpoint = utils.extractTokenAndAPIEndpoint;\n\n/**\n * @deprecated Renamed to `buildAPIEndpoint()`\n */\n// TODO: remove deprecated alias with next major version\nutils.buildPryvApiEndpoint = utils.buildAPIEndpoint;\n\n// --------------- typedfs ------------------------------- //\n\n/**\n * An object with two properties: token & apiEndpoint\n * @typedef {Object} TokenAndEndpoint\n * @property {string} [token] Authorization token\n * @property {string} endpoint url of API endpoint\n */\n\n/**\n * A String url of the form http(s)://{token}@{apiEndpoint}\n * @typedef {string} APIEndpoint\n */\n\n/**\n * Common Meta are returned by each standard call on the API https://api.pryv.com/reference/#in-method-results\n * @typedef {Object} CommonMeta\n * @property {string} apiVersion The version of the API in the form {major}.{minor}.{revision}. Mirrored in HTTP header API-Version.\n * @property {number} serverTime The current server time as a timestamp in second. Keeping track of server time is necessary to properly handle time in API calls.\n * @property {string} serial The serial will change every time the core or register is updated. If you compare it with the serial of a previous response and notice a difference, you should reload the service information.\n */\n","\"use strict\";\nvar ShortUniqueId = (() => {\n  var __defProp = Object.defineProperty;\n  var __getOwnPropDesc = Object.getOwnPropertyDescriptor;\n  var __getOwnPropNames = Object.getOwnPropertyNames;\n  var __getOwnPropSymbols = Object.getOwnPropertySymbols;\n  var __hasOwnProp = Object.prototype.hasOwnProperty;\n  var __propIsEnum = Object.prototype.propertyIsEnumerable;\n  var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\n  var __spreadValues = (a, b) => {\n    for (var prop in b || (b = {}))\n      if (__hasOwnProp.call(b, prop))\n        __defNormalProp(a, prop, b[prop]);\n    if (__getOwnPropSymbols)\n      for (var prop of __getOwnPropSymbols(b)) {\n        if (__propIsEnum.call(b, prop))\n          __defNormalProp(a, prop, b[prop]);\n      }\n    return a;\n  };\n  var __export = (target, all) => {\n    for (var name in all)\n      __defProp(target, name, { get: all[name], enumerable: true });\n  };\n  var __copyProps = (to, from, except, desc) => {\n    if (from && typeof from === \"object\" || typeof from === \"function\") {\n      for (let key of __getOwnPropNames(from))\n        if (!__hasOwnProp.call(to, key) && key !== except)\n          __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n    }\n    return to;\n  };\n  var __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\n  var __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n\n  // src/index.ts\n  var index_exports = {};\n  __export(index_exports, {\n    DEFAULT_OPTIONS: () => DEFAULT_OPTIONS,\n    DEFAULT_UUID_LENGTH: () => DEFAULT_UUID_LENGTH,\n    default: () => ShortUniqueId\n  });\n\n  // package.json\n  var version = \"5.3.2\";\n\n  // src/index.ts\n  var DEFAULT_UUID_LENGTH = 6;\n  var DEFAULT_OPTIONS = {\n    dictionary: \"alphanum\",\n    shuffle: true,\n    debug: false,\n    length: DEFAULT_UUID_LENGTH,\n    counter: 0\n  };\n  var _ShortUniqueId = class _ShortUniqueId {\n    constructor(argOptions = {}) {\n      __publicField(this, \"counter\");\n      __publicField(this, \"debug\");\n      __publicField(this, \"dict\");\n      __publicField(this, \"version\");\n      __publicField(this, \"dictIndex\", 0);\n      __publicField(this, \"dictRange\", []);\n      __publicField(this, \"lowerBound\", 0);\n      __publicField(this, \"upperBound\", 0);\n      __publicField(this, \"dictLength\", 0);\n      __publicField(this, \"uuidLength\");\n      __publicField(this, \"_digit_first_ascii\", 48);\n      __publicField(this, \"_digit_last_ascii\", 58);\n      __publicField(this, \"_alpha_lower_first_ascii\", 97);\n      __publicField(this, \"_alpha_lower_last_ascii\", 123);\n      __publicField(this, \"_hex_last_ascii\", 103);\n      __publicField(this, \"_alpha_upper_first_ascii\", 65);\n      __publicField(this, \"_alpha_upper_last_ascii\", 91);\n      __publicField(this, \"_number_dict_ranges\", {\n        digits: [this._digit_first_ascii, this._digit_last_ascii]\n      });\n      __publicField(this, \"_alpha_dict_ranges\", {\n        lowerCase: [this._alpha_lower_first_ascii, this._alpha_lower_last_ascii],\n        upperCase: [this._alpha_upper_first_ascii, this._alpha_upper_last_ascii]\n      });\n      __publicField(this, \"_alpha_lower_dict_ranges\", {\n        lowerCase: [this._alpha_lower_first_ascii, this._alpha_lower_last_ascii]\n      });\n      __publicField(this, \"_alpha_upper_dict_ranges\", {\n        upperCase: [this._alpha_upper_first_ascii, this._alpha_upper_last_ascii]\n      });\n      __publicField(this, \"_alphanum_dict_ranges\", {\n        digits: [this._digit_first_ascii, this._digit_last_ascii],\n        lowerCase: [this._alpha_lower_first_ascii, this._alpha_lower_last_ascii],\n        upperCase: [this._alpha_upper_first_ascii, this._alpha_upper_last_ascii]\n      });\n      __publicField(this, \"_alphanum_lower_dict_ranges\", {\n        digits: [this._digit_first_ascii, this._digit_last_ascii],\n        lowerCase: [this._alpha_lower_first_ascii, this._alpha_lower_last_ascii]\n      });\n      __publicField(this, \"_alphanum_upper_dict_ranges\", {\n        digits: [this._digit_first_ascii, this._digit_last_ascii],\n        upperCase: [this._alpha_upper_first_ascii, this._alpha_upper_last_ascii]\n      });\n      __publicField(this, \"_hex_dict_ranges\", {\n        decDigits: [this._digit_first_ascii, this._digit_last_ascii],\n        alphaDigits: [this._alpha_lower_first_ascii, this._hex_last_ascii]\n      });\n      __publicField(this, \"_dict_ranges\", {\n        _number_dict_ranges: this._number_dict_ranges,\n        _alpha_dict_ranges: this._alpha_dict_ranges,\n        _alpha_lower_dict_ranges: this._alpha_lower_dict_ranges,\n        _alpha_upper_dict_ranges: this._alpha_upper_dict_ranges,\n        _alphanum_dict_ranges: this._alphanum_dict_ranges,\n        _alphanum_lower_dict_ranges: this._alphanum_lower_dict_ranges,\n        _alphanum_upper_dict_ranges: this._alphanum_upper_dict_ranges,\n        _hex_dict_ranges: this._hex_dict_ranges\n      });\n      /* tslint:disable consistent-return */\n      __publicField(this, \"log\", (...args) => {\n        const finalArgs = [...args];\n        finalArgs[0] = \"[short-unique-id] \".concat(args[0]);\n        if (this.debug === true) {\n          if (typeof console !== \"undefined\" && console !== null) {\n            console.log(...finalArgs);\n            return;\n          }\n        }\n      });\n      /* tslint:enable consistent-return */\n      __publicField(this, \"_normalizeDictionary\", (dictionary, shuffle) => {\n        let finalDict;\n        if (dictionary && Array.isArray(dictionary) && dictionary.length > 1) {\n          finalDict = dictionary;\n        } else {\n          finalDict = [];\n          this.dictIndex = 0;\n          const rangesName = \"_\".concat(dictionary, \"_dict_ranges\");\n          const ranges = this._dict_ranges[rangesName];\n          let capacity = 0;\n          for (const [, rangeValue] of Object.entries(ranges)) {\n            const [lower, upper] = rangeValue;\n            capacity += Math.abs(upper - lower);\n          }\n          finalDict = new Array(capacity);\n          let dictIdx = 0;\n          for (const [, rangeTypeValue] of Object.entries(ranges)) {\n            this.dictRange = rangeTypeValue;\n            this.lowerBound = this.dictRange[0];\n            this.upperBound = this.dictRange[1];\n            const isAscending = this.lowerBound <= this.upperBound;\n            const start = this.lowerBound;\n            const end = this.upperBound;\n            if (isAscending) {\n              for (let i = start; i < end; i++) {\n                finalDict[dictIdx++] = String.fromCharCode(i);\n                this.dictIndex = i;\n              }\n            } else {\n              for (let i = start; i > end; i--) {\n                finalDict[dictIdx++] = String.fromCharCode(i);\n                this.dictIndex = i;\n              }\n            }\n          }\n          finalDict.length = dictIdx;\n        }\n        if (shuffle) {\n          const len = finalDict.length;\n          for (let i = len - 1; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [finalDict[i], finalDict[j]] = [finalDict[j], finalDict[i]];\n          }\n        }\n        return finalDict;\n      });\n      /** Change the dictionary after initialization. */\n      __publicField(this, \"setDictionary\", (dictionary, shuffle) => {\n        this.dict = this._normalizeDictionary(dictionary, shuffle);\n        this.dictLength = this.dict.length;\n        this.setCounter(0);\n      });\n      __publicField(this, \"seq\", () => {\n        return this.sequentialUUID();\n      });\n      /**\n       * Generates UUID based on internal counter that's incremented after each ID generation.\n       * @alias `const uid = new ShortUniqueId(); uid.seq();`\n       */\n      __publicField(this, \"sequentialUUID\", () => {\n        const dictLen = this.dictLength;\n        const dict = this.dict;\n        let counterDiv = this.counter;\n        const idParts = [];\n        do {\n          const counterRem = counterDiv % dictLen;\n          counterDiv = Math.trunc(counterDiv / dictLen);\n          idParts.push(dict[counterRem]);\n        } while (counterDiv !== 0);\n        const id = idParts.join(\"\");\n        this.counter += 1;\n        return id;\n      });\n      __publicField(this, \"rnd\", (uuidLength = this.uuidLength || DEFAULT_UUID_LENGTH) => {\n        return this.randomUUID(uuidLength);\n      });\n      /**\n       * Generates UUID by creating each part randomly.\n       * @alias `const uid = new ShortUniqueId(); uid.rnd(uuidLength: number);`\n       */\n      __publicField(this, \"randomUUID\", (uuidLength = this.uuidLength || DEFAULT_UUID_LENGTH) => {\n        if (uuidLength === null || typeof uuidLength === \"undefined\" || uuidLength < 1) {\n          throw new Error(\"Invalid UUID Length Provided\");\n        }\n        const result = new Array(uuidLength);\n        const dictLen = this.dictLength;\n        const dict = this.dict;\n        for (let j = 0; j < uuidLength; j++) {\n          const randomPartIdx = Math.floor(Math.random() * dictLen);\n          result[j] = dict[randomPartIdx];\n        }\n        return result.join(\"\");\n      });\n      __publicField(this, \"fmt\", (format, date) => {\n        return this.formattedUUID(format, date);\n      });\n      /**\n       * Generates custom UUID with the provided format string.\n       * @alias `const uid = new ShortUniqueId(); uid.fmt(format: string);`\n       */\n      __publicField(this, \"formattedUUID\", (format, date) => {\n        const fnMap = {\n          $r: this.randomUUID,\n          $s: this.sequentialUUID,\n          $t: this.stamp\n        };\n        const result = format.replace(/\\$[rs]\\d{0,}|\\$t0|\\$t[1-9]\\d{1,}/g, (m) => {\n          const fn = m.slice(0, 2);\n          const len = Number.parseInt(m.slice(2), 10);\n          if (fn === \"$s\") {\n            return fnMap[fn]().padStart(len, \"0\");\n          }\n          if (fn === \"$t\" && date) {\n            return fnMap[fn](len, date);\n          }\n          return fnMap[fn](len);\n        });\n        return result;\n      });\n      /**\n       * Calculates total number of possible UUIDs.\n       *\n       * Given that:\n       *\n       * - `H` is the total number of possible UUIDs\n       * - `n` is the number of unique characters in the dictionary\n       * - `l` is the UUID length\n       *\n       * Then `H` is defined as `n` to the power of `l`:\n       *\n       * <div style=\"background: white; padding: 5px; border-radius: 5px; overflow: hidden;\">\n       *  <img src=\"data:image/png;base64,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\" />\n       * </div>\n       *\n       * This function returns `H`.\n       */\n      __publicField(this, \"availableUUIDs\", (uuidLength = this.uuidLength) => {\n        return Number.parseFloat(([...new Set(this.dict)].length ** uuidLength).toFixed(0));\n      });\n      /**\n       * Calculates approximate number of hashes before first collision.\n       *\n       * Given that:\n       *\n       * - `H` is the total number of possible UUIDs, or in terms of this library,\n       * the result of running `availableUUIDs()`\n       * - the expected number of values we have to choose before finding the\n       * first collision can be expressed as the quantity `Q(H)`\n       *\n       * Then `Q(H)` can be approximated as the square root of the product of half\n       * of pi times `H`:\n       *\n       * <div style=\"background: white; padding: 5px; border-radius: 5px; overflow: hidden;\">\n       *  <img src=\"data:image/png;base64,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\" />\n       * </div>\n       *\n       * This function returns `Q(H)`.\n       *\n       * (see [Poisson distribution](https://en.wikipedia.org/wiki/Poisson_distribution))\n       */\n      // Cache for memoization\n      __publicField(this, \"_collisionCache\", /* @__PURE__ */ new Map());\n      __publicField(this, \"approxMaxBeforeCollision\", (rounds = this.availableUUIDs(this.uuidLength)) => {\n        const cacheKey = rounds;\n        const cached = this._collisionCache.get(cacheKey);\n        if (cached !== void 0) {\n          return cached;\n        }\n        const result = Number.parseFloat(Math.sqrt(Math.PI / 2 * rounds).toFixed(20));\n        this._collisionCache.set(cacheKey, result);\n        return result;\n      });\n      /**\n       * Calculates probability of generating duplicate UUIDs (a collision) in a\n       * given number of UUID generation rounds.\n       *\n       * Given that:\n       *\n       * - `r` is the maximum number of times that `randomUUID()` will be called,\n       * or better said the number of _rounds_\n       * - `H` is the total number of possible UUIDs, or in terms of this library,\n       * the result of running `availableUUIDs()`\n       *\n       * Then the probability of collision `p(r; H)` can be approximated as the result\n       * of dividing the square root of the product of half of pi times `r` by `H`:\n       *\n       * <div style=\"background: white; padding: 5px; border-radius: 5px; overflow: hidden;\">\n       *  <img src=\"data:image/png;base64,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\" />\n       * </div>\n       *\n       * This function returns `p(r; H)`.\n       *\n       * (see [Poisson distribution](https://en.wikipedia.org/wiki/Poisson_distribution))\n       *\n       * (Useful if you are wondering _\"If I use this lib and expect to perform at most\n       * `r` rounds of UUID generations, what is the probability that I will hit a duplicate UUID?\"_.)\n       */\n      __publicField(this, \"collisionProbability\", (rounds = this.availableUUIDs(this.uuidLength), uuidLength = this.uuidLength) => {\n        return Number.parseFloat(\n          (this.approxMaxBeforeCollision(rounds) / this.availableUUIDs(uuidLength)).toFixed(20)\n        );\n      });\n      /**\n       * Calculate a \"uniqueness\" score (from 0 to 1) of UUIDs based on size of\n       * dictionary and chosen UUID length.\n       *\n       * Given that:\n       *\n       * - `H` is the total number of possible UUIDs, or in terms of this library,\n       * the result of running `availableUUIDs()`\n       * - `Q(H)` is the approximate number of hashes before first collision,\n       * or in terms of this library, the result of running `approxMaxBeforeCollision()`\n       *\n       * Then `uniqueness` can be expressed as the additive inverse of the probability of\n       * generating a \"word\" I had previously generated (a duplicate) at any given iteration\n       * up to the the total number of possible UUIDs expressed as the quotiend of `Q(H)` and `H`:\n       *\n       * <div style=\"background: white; padding: 5px; border-radius: 5px; overflow: hidden;\">\n       *  <img src=\"data:image/png;base64,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\" />\n       * </div>\n       *\n       * (Useful if you need a value to rate the \"quality\" of the combination of given dictionary\n       * and UUID length. The closer to 1, higher the uniqueness and thus better the quality.)\n       */\n      __publicField(this, \"uniqueness\", (rounds = this.availableUUIDs(this.uuidLength)) => {\n        const score = Number.parseFloat(\n          (1 - this.approxMaxBeforeCollision(rounds) / rounds).toFixed(20)\n        );\n        return score > 1 ? 1 : score < 0 ? 0 : score;\n      });\n      /**\n       * Return the version of this module.\n       */\n      __publicField(this, \"getVersion\", () => {\n        return this.version;\n      });\n      /**\n       * Generates a UUID with a timestamp that can be extracted using `uid.parseStamp(stampString);`.\n       *\n       * ```js\n       *  const uidWithTimestamp = uid.stamp(32);\n       *  console.log(uidWithTimestamp);\n       *  // GDa608f973aRCHLXQYPTbKDbjDeVsSb3\n       *\n       *  console.log(uid.parseStamp(uidWithTimestamp));\n       *  // 2021-05-03T06:24:58.000Z\n       *  ```\n       */\n      __publicField(this, \"stamp\", (finalLength, date) => {\n        const hexStamp = Math.floor(+(date || /* @__PURE__ */ new Date()) / 1e3).toString(16);\n        if (typeof finalLength === \"number\" && finalLength === 0) {\n          return hexStamp;\n        }\n        if (typeof finalLength !== \"number\" || finalLength < 10) {\n          throw new Error(\n            [\n              \"Param finalLength must be a number greater than or equal to 10,\",\n              \"or 0 if you want the raw hexadecimal timestamp\"\n            ].join(\"\\n\")\n          );\n        }\n        const idLength = finalLength - 9;\n        const rndIdx = Math.round(Math.random() * (idLength > 15 ? 15 : idLength));\n        const id = this.randomUUID(idLength);\n        return \"\".concat(id.substring(0, rndIdx)).concat(hexStamp).concat(id.substring(rndIdx)).concat(rndIdx.toString(16));\n      });\n      /**\n       * Extracts the date embeded in a UUID generated using the `uid.stamp(finalLength);` method.\n       *\n       * ```js\n       *  const uidWithTimestamp = uid.stamp(32);\n       *  console.log(uidWithTimestamp);\n       *  // GDa608f973aRCHLXQYPTbKDbjDeVsSb3\n       *\n       *  console.log(uid.parseStamp(uidWithTimestamp));\n       *  // 2021-05-03T06:24:58.000Z\n       *  ```\n       */\n      __publicField(this, \"parseStamp\", (suid, format) => {\n        if (format && !/t0|t[1-9]\\d{1,}/.test(format)) {\n          throw new Error(\"Cannot extract date from a formated UUID with no timestamp in the format\");\n        }\n        const stamp = format ? format.replace(/\\$[rs]\\d{0,}|\\$t0|\\$t[1-9]\\d{1,}/g, (m) => {\n          const fnMap = {\n            $r: (len2) => [...Array(len2)].map(() => \"r\").join(\"\"),\n            $s: (len2) => [...Array(len2)].map(() => \"s\").join(\"\"),\n            $t: (len2) => [...Array(len2)].map(() => \"t\").join(\"\")\n          };\n          const fn = m.slice(0, 2);\n          const len = Number.parseInt(m.slice(2), 10);\n          return fnMap[fn](len);\n        }).replace(/^(.*?)(t{8,})(.*)$/g, (_m, p1, p2) => {\n          return suid.substring(p1.length, p1.length + p2.length);\n        }) : suid;\n        if (stamp.length === 8) {\n          return new Date(Number.parseInt(stamp, 16) * 1e3);\n        }\n        if (stamp.length < 10) {\n          throw new Error(\"Stamp length invalid\");\n        }\n        const rndIdx = Number.parseInt(stamp.substring(stamp.length - 1), 16);\n        return new Date(Number.parseInt(stamp.substring(rndIdx, rndIdx + 8), 16) * 1e3);\n      });\n      /**\n       * Set the counter to a specific value.\n       */\n      __publicField(this, \"setCounter\", (counter) => {\n        this.counter = counter;\n      });\n      /**\n       * Validate given UID contains only characters from the instanced dictionary or optionally provided dictionary.\n       */\n      __publicField(this, \"validate\", (uid, dictionary) => {\n        const finalDictionary = dictionary ? this._normalizeDictionary(dictionary) : this.dict;\n        return uid.split(\"\").every((c) => finalDictionary.includes(c));\n      });\n      const options = __spreadValues(__spreadValues({}, DEFAULT_OPTIONS), argOptions);\n      this.counter = 0;\n      this.debug = false;\n      this.dict = [];\n      this.version = version;\n      const { dictionary, shuffle, length, counter } = options;\n      this.uuidLength = length;\n      this.setDictionary(dictionary, shuffle);\n      this.setCounter(counter);\n      this.debug = options.debug;\n      this.log(this.dict);\n      this.log(\n        \"Generator instantiated with Dictionary Size \".concat(this.dictLength, \" and counter set to \").concat(this.counter)\n      );\n      this.log = this.log.bind(this);\n      this.setDictionary = this.setDictionary.bind(this);\n      this.setCounter = this.setCounter.bind(this);\n      this.seq = this.seq.bind(this);\n      this.sequentialUUID = this.sequentialUUID.bind(this);\n      this.rnd = this.rnd.bind(this);\n      this.randomUUID = this.randomUUID.bind(this);\n      this.fmt = this.fmt.bind(this);\n      this.formattedUUID = this.formattedUUID.bind(this);\n      this.availableUUIDs = this.availableUUIDs.bind(this);\n      this.approxMaxBeforeCollision = this.approxMaxBeforeCollision.bind(this);\n      this.collisionProbability = this.collisionProbability.bind(this);\n      this.uniqueness = this.uniqueness.bind(this);\n      this.getVersion = this.getVersion.bind(this);\n      this.stamp = this.stamp.bind(this);\n      this.parseStamp = this.parseStamp.bind(this);\n    }\n  };\n  /** @hidden */\n  __publicField(_ShortUniqueId, \"default\", _ShortUniqueId);\n  var ShortUniqueId = _ShortUniqueId;\n  return __toCommonJS(index_exports);\n})();\n//# sourceMappingURL=short-unique-id.js.map\n'undefined'!=typeof module&&(module.exports=ShortUniqueId.default),'undefined'!=typeof window&&(ShortUniqueId=ShortUniqueId.default);","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hasCORS = void 0;\n// imported from https://github.com/component/has-cors\nlet value = false;\ntry {\n    value = typeof XMLHttpRequest !== 'undefined' &&\n        'withCredentials' in new XMLHttpRequest();\n}\ncatch (err) {\n    // if XMLHttp support is disabled in IE then it will throw\n    // when trying to create\n}\nexports.hasCORS = value;\n","\"use strict\";\n// imported from https://github.com/galkn/querystring\n/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.encode = encode;\nexports.decode = decode;\nfunction encode(obj) {\n    let str = '';\n    for (let i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (str.length)\n                str += '&';\n            str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n        }\n    }\n    return str;\n}\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\nfunction decode(qs) {\n    let qry = {};\n    let pairs = qs.split('&');\n    for (let i = 0, l = pairs.length; i < l; i++) {\n        let pair = pairs[i].split('=');\n        qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n    return qry;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parse = parse;\n// imported from https://github.com/galkn/parseuri\n/**\n * Parses a URI\n *\n * Note: we could also have used the built-in URL object, but it isn't supported on all platforms.\n *\n * See:\n * - https://developer.mozilla.org/en-US/docs/Web/API/URL\n * - https://caniuse.com/url\n * - https://www.rfc-editor.org/rfc/rfc3986#appendix-B\n *\n * History of the parse() method:\n * - first commit: https://github.com/socketio/socket.io-client/commit/4ee1d5d94b3906a9c052b459f1a818b15f38f91c\n * - export into its own module: https://github.com/socketio/engine.io-client/commit/de2c561e4564efeb78f1bdb1ba39ef81b2822cb3\n * - reimport: https://github.com/socketio/engine.io-client/commit/df32277c3f6d622eec5ed09f493cae3f3391d242\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\nconst re = /^(?:(?![^:@\\/?#]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@\\/?#]*)(?::([^:@\\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nconst parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\nfunction parse(str) {\n    if (str.length > 8000) {\n        throw \"URI too long\";\n    }\n    const src = str, b = str.indexOf('['), e = str.indexOf(']');\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n    let m = re.exec(str || ''), uri = {}, i = 14;\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n    uri.pathNames = pathNames(uri, uri['path']);\n    uri.queryKey = queryKey(uri, uri['query']);\n    return uri;\n}\nfunction pathNames(obj, path) {\n    const regx = /\\/{2,9}/g, names = path.replace(regx, \"/\").split(\"/\");\n    if (path.slice(0, 1) == '/' || path.length === 0) {\n        names.splice(0, 1);\n    }\n    if (path.slice(-1) == '/') {\n        names.splice(names.length - 1, 1);\n    }\n    return names;\n}\nfunction queryKey(uri, query) {\n    const data = {};\n    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {\n        if ($1) {\n            data[$1] = $2;\n        }\n    });\n    return data;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.defaultBinaryType = exports.globalThisShim = exports.nextTick = void 0;\nexports.createCookieJar = createCookieJar;\nexports.nextTick = (() => {\n    const isPromiseAvailable = typeof Promise === \"function\" && typeof Promise.resolve === \"function\";\n    if (isPromiseAvailable) {\n        return (cb) => Promise.resolve().then(cb);\n    }\n    else {\n        return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);\n    }\n})();\nexports.globalThisShim = (() => {\n    if (typeof self !== \"undefined\") {\n        return self;\n    }\n    else if (typeof window !== \"undefined\") {\n        return window;\n    }\n    else {\n        return Function(\"return this\")();\n    }\n})();\nexports.defaultBinaryType = \"arraybuffer\";\nfunction createCookieJar() { }\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebTransport = exports.WebSocket = exports.NodeWebSocket = exports.XHR = exports.NodeXHR = exports.Fetch = exports.nextTick = exports.parse = exports.installTimerFunctions = exports.transports = exports.TransportError = exports.Transport = exports.protocol = exports.SocketWithUpgrade = exports.SocketWithoutUpgrade = exports.Socket = void 0;\nconst socket_js_1 = require(\"./socket.js\");\nObject.defineProperty(exports, \"Socket\", { enumerable: true, get: function () { return socket_js_1.Socket; } });\nvar socket_js_2 = require(\"./socket.js\");\nObject.defineProperty(exports, \"SocketWithoutUpgrade\", { enumerable: true, get: function () { return socket_js_2.SocketWithoutUpgrade; } });\nObject.defineProperty(exports, \"SocketWithUpgrade\", { enumerable: true, get: function () { return socket_js_2.SocketWithUpgrade; } });\nexports.protocol = socket_js_1.Socket.protocol;\nvar transport_js_1 = require(\"./transport.js\");\nObject.defineProperty(exports, \"Transport\", { enumerable: true, get: function () { return transport_js_1.Transport; } });\nObject.defineProperty(exports, \"TransportError\", { enumerable: true, get: function () { return transport_js_1.TransportError; } });\nvar index_js_1 = require(\"./transports/index.js\");\nObject.defineProperty(exports, \"transports\", { enumerable: true, get: function () { return index_js_1.transports; } });\nvar util_js_1 = require(\"./util.js\");\nObject.defineProperty(exports, \"installTimerFunctions\", { enumerable: true, get: function () { return util_js_1.installTimerFunctions; } });\nvar parseuri_js_1 = require(\"./contrib/parseuri.js\");\nObject.defineProperty(exports, \"parse\", { enumerable: true, get: function () { return parseuri_js_1.parse; } });\nvar globals_node_js_1 = require(\"./globals.node.js\");\nObject.defineProperty(exports, \"nextTick\", { enumerable: true, get: function () { return globals_node_js_1.nextTick; } });\nvar polling_fetch_js_1 = require(\"./transports/polling-fetch.js\");\nObject.defineProperty(exports, \"Fetch\", { enumerable: true, get: function () { return polling_fetch_js_1.Fetch; } });\nvar polling_xhr_node_js_1 = require(\"./transports/polling-xhr.node.js\");\nObject.defineProperty(exports, \"NodeXHR\", { enumerable: true, get: function () { return polling_xhr_node_js_1.XHR; } });\nvar polling_xhr_js_1 = require(\"./transports/polling-xhr.js\");\nObject.defineProperty(exports, \"XHR\", { enumerable: true, get: function () { return polling_xhr_js_1.XHR; } });\nvar websocket_node_js_1 = require(\"./transports/websocket.node.js\");\nObject.defineProperty(exports, \"NodeWebSocket\", { enumerable: true, get: function () { return websocket_node_js_1.WS; } });\nvar websocket_js_1 = require(\"./transports/websocket.js\");\nObject.defineProperty(exports, \"WebSocket\", { enumerable: true, get: function () { return websocket_js_1.WS; } });\nvar webtransport_js_1 = require(\"./transports/webtransport.js\");\nObject.defineProperty(exports, \"WebTransport\", { enumerable: true, get: function () { return webtransport_js_1.WT; } });\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Socket = exports.SocketWithUpgrade = exports.SocketWithoutUpgrade = void 0;\nconst index_js_1 = require(\"./transports/index.js\");\nconst util_js_1 = require(\"./util.js\");\nconst parseqs_js_1 = require(\"./contrib/parseqs.js\");\nconst parseuri_js_1 = require(\"./contrib/parseuri.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst globals_node_js_1 = require(\"./globals.node.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:socket\"); // debug()\nconst withEventListeners = typeof addEventListener === \"function\" &&\n    typeof removeEventListener === \"function\";\nconst OFFLINE_EVENT_LISTENERS = [];\nif (withEventListeners) {\n    // within a ServiceWorker, any event handler for the 'offline' event must be added on the initial evaluation of the\n    // script, so we create one single event listener here which will forward the event to the socket instances\n    addEventListener(\"offline\", () => {\n        debug(\"closing %d connection(s) because the network was lost\", OFFLINE_EVENT_LISTENERS.length);\n        OFFLINE_EVENT_LISTENERS.forEach((listener) => listener());\n    }, false);\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes without upgrade mechanism, which means that it will keep the first low-level transport that\n * successfully establishes the connection.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithoutUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithoutUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithUpgrade\n * @see Socket\n */\nclass SocketWithoutUpgrade extends component_emitter_1.Emitter {\n    /**\n     * Socket constructor.\n     *\n     * @param {String|Object} uri - uri or options\n     * @param {Object} opts - options\n     */\n    constructor(uri, opts) {\n        super();\n        this.binaryType = globals_node_js_1.defaultBinaryType;\n        this.writeBuffer = [];\n        this._prevBufferLen = 0;\n        this._pingInterval = -1;\n        this._pingTimeout = -1;\n        this._maxPayload = -1;\n        /**\n         * The expiration timestamp of the {@link _pingTimeoutTimer} object is tracked, in case the timer is throttled and the\n         * callback is not fired on time. This can happen for example when a laptop is suspended or when a phone is locked.\n         */\n        this._pingTimeoutTime = Infinity;\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = null;\n        }\n        if (uri) {\n            const parsedUri = (0, parseuri_js_1.parse)(uri);\n            opts.hostname = parsedUri.host;\n            opts.secure =\n                parsedUri.protocol === \"https\" || parsedUri.protocol === \"wss\";\n            opts.port = parsedUri.port;\n            if (parsedUri.query)\n                opts.query = parsedUri.query;\n        }\n        else if (opts.host) {\n            opts.hostname = (0, parseuri_js_1.parse)(opts.host).host;\n        }\n        (0, util_js_1.installTimerFunctions)(this, opts);\n        this.secure =\n            null != opts.secure\n                ? opts.secure\n                : typeof location !== \"undefined\" && \"https:\" === location.protocol;\n        if (opts.hostname && !opts.port) {\n            // if no port is specified manually, use the protocol default\n            opts.port = this.secure ? \"443\" : \"80\";\n        }\n        this.hostname =\n            opts.hostname ||\n                (typeof location !== \"undefined\" ? location.hostname : \"localhost\");\n        this.port =\n            opts.port ||\n                (typeof location !== \"undefined\" && location.port\n                    ? location.port\n                    : this.secure\n                        ? \"443\"\n                        : \"80\");\n        this.transports = [];\n        this._transportsByName = {};\n        opts.transports.forEach((t) => {\n            const transportName = t.prototype.name;\n            this.transports.push(transportName);\n            this._transportsByName[transportName] = t;\n        });\n        this.opts = Object.assign({\n            path: \"/engine.io\",\n            agent: false,\n            withCredentials: false,\n            upgrade: true,\n            timestampParam: \"t\",\n            rememberUpgrade: false,\n            addTrailingSlash: true,\n            rejectUnauthorized: true,\n            perMessageDeflate: {\n                threshold: 1024,\n            },\n            transportOptions: {},\n            closeOnBeforeunload: false,\n        }, opts);\n        this.opts.path =\n            this.opts.path.replace(/\\/$/, \"\") +\n                (this.opts.addTrailingSlash ? \"/\" : \"\");\n        if (typeof this.opts.query === \"string\") {\n            this.opts.query = (0, parseqs_js_1.decode)(this.opts.query);\n        }\n        if (withEventListeners) {\n            if (this.opts.closeOnBeforeunload) {\n                // Firefox closes the connection when the \"beforeunload\" event is emitted but not Chrome. This event listener\n                // ensures every browser behaves the same (no \"disconnect\" event at the Socket.IO level when the page is\n                // closed/reloaded)\n                this._beforeunloadEventListener = () => {\n                    if (this.transport) {\n                        // silently close the transport\n                        this.transport.removeAllListeners();\n                        this.transport.close();\n                    }\n                };\n                addEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n            }\n            if (this.hostname !== \"localhost\") {\n                debug(\"adding listener for the 'offline' event\");\n                this._offlineEventListener = () => {\n                    this._onClose(\"transport close\", {\n                        description: \"network connection lost\",\n                    });\n                };\n                OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener);\n            }\n        }\n        if (this.opts.withCredentials) {\n            this._cookieJar = (0, globals_node_js_1.createCookieJar)();\n        }\n        this._open();\n    }\n    /**\n     * Creates transport of the given type.\n     *\n     * @param {String} name - transport name\n     * @return {Transport}\n     * @private\n     */\n    createTransport(name) {\n        debug('creating transport \"%s\"', name);\n        const query = Object.assign({}, this.opts.query);\n        // append engine.io protocol identifier\n        query.EIO = engine_io_parser_1.protocol;\n        // transport name\n        query.transport = name;\n        // session id if we already have one\n        if (this.id)\n            query.sid = this.id;\n        const opts = Object.assign({}, this.opts, {\n            query,\n            socket: this,\n            hostname: this.hostname,\n            secure: this.secure,\n            port: this.port,\n        }, this.opts.transportOptions[name]);\n        debug(\"options: %j\", opts);\n        return new this._transportsByName[name](opts);\n    }\n    /**\n     * Initializes transport to use and starts probe.\n     *\n     * @private\n     */\n    _open() {\n        if (this.transports.length === 0) {\n            // Emit error on next tick so it can be listened to\n            this.setTimeoutFn(() => {\n                this.emitReserved(\"error\", \"No transports available\");\n            }, 0);\n            return;\n        }\n        const transportName = this.opts.rememberUpgrade &&\n            SocketWithoutUpgrade.priorWebsocketSuccess &&\n            this.transports.indexOf(\"websocket\") !== -1\n            ? \"websocket\"\n            : this.transports[0];\n        this.readyState = \"opening\";\n        const transport = this.createTransport(transportName);\n        transport.open();\n        this.setTransport(transport);\n    }\n    /**\n     * Sets the current transport. Disables the existing one (if any).\n     *\n     * @private\n     */\n    setTransport(transport) {\n        debug(\"setting transport %s\", transport.name);\n        if (this.transport) {\n            debug(\"clearing existing transport %s\", this.transport.name);\n            this.transport.removeAllListeners();\n        }\n        // set up transport\n        this.transport = transport;\n        // set up transport listeners\n        transport\n            .on(\"drain\", this._onDrain.bind(this))\n            .on(\"packet\", this._onPacket.bind(this))\n            .on(\"error\", this._onError.bind(this))\n            .on(\"close\", (reason) => this._onClose(\"transport close\", reason));\n    }\n    /**\n     * Called when connection is deemed open.\n     *\n     * @private\n     */\n    onOpen() {\n        debug(\"socket open\");\n        this.readyState = \"open\";\n        SocketWithoutUpgrade.priorWebsocketSuccess =\n            \"websocket\" === this.transport.name;\n        this.emitReserved(\"open\");\n        this.flush();\n    }\n    /**\n     * Handles a packet.\n     *\n     * @private\n     */\n    _onPacket(packet) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            debug('socket receive: type \"%s\", data \"%s\"', packet.type, packet.data);\n            this.emitReserved(\"packet\", packet);\n            // Socket is live - any packet counts\n            this.emitReserved(\"heartbeat\");\n            switch (packet.type) {\n                case \"open\":\n                    this.onHandshake(JSON.parse(packet.data));\n                    break;\n                case \"ping\":\n                    this._sendPacket(\"pong\");\n                    this.emitReserved(\"ping\");\n                    this.emitReserved(\"pong\");\n                    this._resetPingTimeout();\n                    break;\n                case \"error\":\n                    const err = new Error(\"server error\");\n                    // @ts-ignore\n                    err.code = packet.data;\n                    this._onError(err);\n                    break;\n                case \"message\":\n                    this.emitReserved(\"data\", packet.data);\n                    this.emitReserved(\"message\", packet.data);\n                    break;\n            }\n        }\n        else {\n            debug('packet received with socket readyState \"%s\"', this.readyState);\n        }\n    }\n    /**\n     * Called upon handshake completion.\n     *\n     * @param {Object} data - handshake obj\n     * @private\n     */\n    onHandshake(data) {\n        this.emitReserved(\"handshake\", data);\n        this.id = data.sid;\n        this.transport.query.sid = data.sid;\n        this._pingInterval = data.pingInterval;\n        this._pingTimeout = data.pingTimeout;\n        this._maxPayload = data.maxPayload;\n        this.onOpen();\n        // In case open handler closes socket\n        if (\"closed\" === this.readyState)\n            return;\n        this._resetPingTimeout();\n    }\n    /**\n     * Sets and resets ping timeout timer based on server pings.\n     *\n     * @private\n     */\n    _resetPingTimeout() {\n        this.clearTimeoutFn(this._pingTimeoutTimer);\n        const delay = this._pingInterval + this._pingTimeout;\n        this._pingTimeoutTime = Date.now() + delay;\n        this._pingTimeoutTimer = this.setTimeoutFn(() => {\n            this._onClose(\"ping timeout\");\n        }, delay);\n        if (this.opts.autoUnref) {\n            this._pingTimeoutTimer.unref();\n        }\n    }\n    /**\n     * Called on `drain` event\n     *\n     * @private\n     */\n    _onDrain() {\n        this.writeBuffer.splice(0, this._prevBufferLen);\n        // setting prevBufferLen = 0 is very important\n        // for example, when upgrading, upgrade packet is sent over,\n        // and a nonzero prevBufferLen could cause problems on `drain`\n        this._prevBufferLen = 0;\n        if (0 === this.writeBuffer.length) {\n            this.emitReserved(\"drain\");\n        }\n        else {\n            this.flush();\n        }\n    }\n    /**\n     * Flush write buffers.\n     *\n     * @private\n     */\n    flush() {\n        if (\"closed\" !== this.readyState &&\n            this.transport.writable &&\n            !this.upgrading &&\n            this.writeBuffer.length) {\n            const packets = this._getWritablePackets();\n            debug(\"flushing %d packets in socket\", packets.length);\n            this.transport.send(packets);\n            // keep track of current length of writeBuffer\n            // splice writeBuffer and callbackBuffer on `drain`\n            this._prevBufferLen = packets.length;\n            this.emitReserved(\"flush\");\n        }\n    }\n    /**\n     * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP\n     * long-polling)\n     *\n     * @private\n     */\n    _getWritablePackets() {\n        const shouldCheckPayloadSize = this._maxPayload &&\n            this.transport.name === \"polling\" &&\n            this.writeBuffer.length > 1;\n        if (!shouldCheckPayloadSize) {\n            return this.writeBuffer;\n        }\n        let payloadSize = 1; // first packet type\n        for (let i = 0; i < this.writeBuffer.length; i++) {\n            const data = this.writeBuffer[i].data;\n            if (data) {\n                payloadSize += (0, util_js_1.byteLength)(data);\n            }\n            if (i > 0 && payloadSize > this._maxPayload) {\n                debug(\"only send %d out of %d packets\", i, this.writeBuffer.length);\n                return this.writeBuffer.slice(0, i);\n            }\n            payloadSize += 2; // separator + packet type\n        }\n        debug(\"payload size is %d (max: %d)\", payloadSize, this._maxPayload);\n        return this.writeBuffer;\n    }\n    /**\n     * Checks whether the heartbeat timer has expired but the socket has not yet been notified.\n     *\n     * Note: this method is private for now because it does not really fit the WebSocket API, but if we put it in the\n     * `write()` method then the message would not be buffered by the Socket.IO client.\n     *\n     * @return {boolean}\n     * @private\n     */\n    /* private */ _hasPingExpired() {\n        if (!this._pingTimeoutTime)\n            return true;\n        const hasExpired = Date.now() > this._pingTimeoutTime;\n        if (hasExpired) {\n            debug(\"throttled timer detected, scheduling connection close\");\n            this._pingTimeoutTime = 0;\n            (0, globals_node_js_1.nextTick)(() => {\n                this._onClose(\"ping timeout\");\n            }, this.setTimeoutFn);\n        }\n        return hasExpired;\n    }\n    /**\n     * Sends a message.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    write(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a message. Alias of {@link Socket#write}.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    send(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param {String} type: packet type.\n     * @param {String} data.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @private\n     */\n    _sendPacket(type, data, options, fn) {\n        if (\"function\" === typeof data) {\n            fn = data;\n            data = undefined;\n        }\n        if (\"function\" === typeof options) {\n            fn = options;\n            options = null;\n        }\n        if (\"closing\" === this.readyState || \"closed\" === this.readyState) {\n            return;\n        }\n        options = options || {};\n        options.compress = false !== options.compress;\n        const packet = {\n            type: type,\n            data: data,\n            options: options,\n        };\n        this.emitReserved(\"packetCreate\", packet);\n        this.writeBuffer.push(packet);\n        if (fn)\n            this.once(\"flush\", fn);\n        this.flush();\n    }\n    /**\n     * Closes the connection.\n     */\n    close() {\n        const close = () => {\n            this._onClose(\"forced close\");\n            debug(\"socket closing - telling transport to close\");\n            this.transport.close();\n        };\n        const cleanupAndClose = () => {\n            this.off(\"upgrade\", cleanupAndClose);\n            this.off(\"upgradeError\", cleanupAndClose);\n            close();\n        };\n        const waitForUpgrade = () => {\n            // wait for upgrade to finish since we can't send packets while pausing a transport\n            this.once(\"upgrade\", cleanupAndClose);\n            this.once(\"upgradeError\", cleanupAndClose);\n        };\n        if (\"opening\" === this.readyState || \"open\" === this.readyState) {\n            this.readyState = \"closing\";\n            if (this.writeBuffer.length) {\n                this.once(\"drain\", () => {\n                    if (this.upgrading) {\n                        waitForUpgrade();\n                    }\n                    else {\n                        close();\n                    }\n                });\n            }\n            else if (this.upgrading) {\n                waitForUpgrade();\n            }\n            else {\n                close();\n            }\n        }\n        return this;\n    }\n    /**\n     * Called upon transport error\n     *\n     * @private\n     */\n    _onError(err) {\n        debug(\"socket error %j\", err);\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        if (this.opts.tryAllTransports &&\n            this.transports.length > 1 &&\n            this.readyState === \"opening\") {\n            debug(\"trying next transport\");\n            this.transports.shift();\n            return this._open();\n        }\n        this.emitReserved(\"error\", err);\n        this._onClose(\"transport error\", err);\n    }\n    /**\n     * Called upon transport close.\n     *\n     * @private\n     */\n    _onClose(reason, description) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            debug('socket close with reason: \"%s\"', reason);\n            // clear timers\n            this.clearTimeoutFn(this._pingTimeoutTimer);\n            // stop event from firing again for transport\n            this.transport.removeAllListeners(\"close\");\n            // ensure transport won't stay open\n            this.transport.close();\n            // ignore further transport communication\n            this.transport.removeAllListeners();\n            if (withEventListeners) {\n                if (this._beforeunloadEventListener) {\n                    removeEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n                }\n                if (this._offlineEventListener) {\n                    const i = OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);\n                    if (i !== -1) {\n                        debug(\"removing listener for the 'offline' event\");\n                        OFFLINE_EVENT_LISTENERS.splice(i, 1);\n                    }\n                }\n            }\n            // set ready state\n            this.readyState = \"closed\";\n            // clear session id\n            this.id = null;\n            // emit close event\n            this.emitReserved(\"close\", reason, description);\n            // clean buffers after, so users can still\n            // grab the buffers on `close` event\n            this.writeBuffer = [];\n            this._prevBufferLen = 0;\n        }\n    }\n}\nexports.SocketWithoutUpgrade = SocketWithoutUpgrade;\nSocketWithoutUpgrade.protocol = engine_io_parser_1.protocol;\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see Socket\n */\nclass SocketWithUpgrade extends SocketWithoutUpgrade {\n    constructor() {\n        super(...arguments);\n        this._upgrades = [];\n    }\n    onOpen() {\n        super.onOpen();\n        if (\"open\" === this.readyState && this.opts.upgrade) {\n            debug(\"starting upgrade probes\");\n            for (let i = 0; i < this._upgrades.length; i++) {\n                this._probe(this._upgrades[i]);\n            }\n        }\n    }\n    /**\n     * Probes a transport.\n     *\n     * @param {String} name - transport name\n     * @private\n     */\n    _probe(name) {\n        debug('probing transport \"%s\"', name);\n        let transport = this.createTransport(name);\n        let failed = false;\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        const onTransportOpen = () => {\n            if (failed)\n                return;\n            debug('probe transport \"%s\" opened', name);\n            transport.send([{ type: \"ping\", data: \"probe\" }]);\n            transport.once(\"packet\", (msg) => {\n                if (failed)\n                    return;\n                if (\"pong\" === msg.type && \"probe\" === msg.data) {\n                    debug('probe transport \"%s\" pong', name);\n                    this.upgrading = true;\n                    this.emitReserved(\"upgrading\", transport);\n                    if (!transport)\n                        return;\n                    SocketWithoutUpgrade.priorWebsocketSuccess =\n                        \"websocket\" === transport.name;\n                    debug('pausing current transport \"%s\"', this.transport.name);\n                    this.transport.pause(() => {\n                        if (failed)\n                            return;\n                        if (\"closed\" === this.readyState)\n                            return;\n                        debug(\"changing transport and sending upgrade packet\");\n                        cleanup();\n                        this.setTransport(transport);\n                        transport.send([{ type: \"upgrade\" }]);\n                        this.emitReserved(\"upgrade\", transport);\n                        transport = null;\n                        this.upgrading = false;\n                        this.flush();\n                    });\n                }\n                else {\n                    debug('probe transport \"%s\" failed', name);\n                    const err = new Error(\"probe error\");\n                    // @ts-ignore\n                    err.transport = transport.name;\n                    this.emitReserved(\"upgradeError\", err);\n                }\n            });\n        };\n        function freezeTransport() {\n            if (failed)\n                return;\n            // Any callback called by transport should be ignored since now\n            failed = true;\n            cleanup();\n            transport.close();\n            transport = null;\n        }\n        // Handle any error that happens while probing\n        const onerror = (err) => {\n            const error = new Error(\"probe error: \" + err);\n            // @ts-ignore\n            error.transport = transport.name;\n            freezeTransport();\n            debug('probe transport \"%s\" failed because of error: %s', name, err);\n            this.emitReserved(\"upgradeError\", error);\n        };\n        function onTransportClose() {\n            onerror(\"transport closed\");\n        }\n        // When the socket is closed while we're probing\n        function onclose() {\n            onerror(\"socket closed\");\n        }\n        // When the socket is upgraded while we're probing\n        function onupgrade(to) {\n            if (transport && to.name !== transport.name) {\n                debug('\"%s\" works - aborting \"%s\"', to.name, transport.name);\n                freezeTransport();\n            }\n        }\n        // Remove all listeners on the transport and on self\n        const cleanup = () => {\n            transport.removeListener(\"open\", onTransportOpen);\n            transport.removeListener(\"error\", onerror);\n            transport.removeListener(\"close\", onTransportClose);\n            this.off(\"close\", onclose);\n            this.off(\"upgrading\", onupgrade);\n        };\n        transport.once(\"open\", onTransportOpen);\n        transport.once(\"error\", onerror);\n        transport.once(\"close\", onTransportClose);\n        this.once(\"close\", onclose);\n        this.once(\"upgrading\", onupgrade);\n        if (this._upgrades.indexOf(\"webtransport\") !== -1 &&\n            name !== \"webtransport\") {\n            // favor WebTransport\n            this.setTimeoutFn(() => {\n                if (!failed) {\n                    transport.open();\n                }\n            }, 200);\n        }\n        else {\n            transport.open();\n        }\n    }\n    onHandshake(data) {\n        this._upgrades = this._filterUpgrades(data.upgrades);\n        super.onHandshake(data);\n    }\n    /**\n     * Filters upgrades, returning only those matching client transports.\n     *\n     * @param {Array} upgrades - server upgrades\n     * @private\n     */\n    _filterUpgrades(upgrades) {\n        const filteredUpgrades = [];\n        for (let i = 0; i < upgrades.length; i++) {\n            if (~this.transports.indexOf(upgrades[i]))\n                filteredUpgrades.push(upgrades[i]);\n        }\n        return filteredUpgrades;\n    }\n}\nexports.SocketWithUpgrade = SocketWithUpgrade;\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * @example\n * import { Socket } from \"engine.io-client\";\n *\n * const socket = new Socket();\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see SocketWithUpgrade\n */\nclass Socket extends SocketWithUpgrade {\n    constructor(uri, opts = {}) {\n        const o = typeof uri === \"object\" ? uri : opts;\n        if (!o.transports ||\n            (o.transports && typeof o.transports[0] === \"string\")) {\n            o.transports = (o.transports || [\"polling\", \"websocket\", \"webtransport\"])\n                .map((transportName) => index_js_1.transports[transportName])\n                .filter((t) => !!t);\n        }\n        super(uri, o);\n    }\n}\nexports.Socket = Socket;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Transport = exports.TransportError = void 0;\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst util_js_1 = require(\"./util.js\");\nconst parseqs_js_1 = require(\"./contrib/parseqs.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:transport\"); // debug()\nclass TransportError extends Error {\n    constructor(reason, description, context) {\n        super(reason);\n        this.description = description;\n        this.context = context;\n        this.type = \"TransportError\";\n    }\n}\nexports.TransportError = TransportError;\nclass Transport extends component_emitter_1.Emitter {\n    /**\n     * Transport abstract constructor.\n     *\n     * @param {Object} opts - options\n     * @protected\n     */\n    constructor(opts) {\n        super();\n        this.writable = false;\n        (0, util_js_1.installTimerFunctions)(this, opts);\n        this.opts = opts;\n        this.query = opts.query;\n        this.socket = opts.socket;\n        this.supportsBinary = !opts.forceBase64;\n    }\n    /**\n     * Emits an error.\n     *\n     * @param {String} reason\n     * @param description\n     * @param context - the error context\n     * @return {Transport} for chaining\n     * @protected\n     */\n    onError(reason, description, context) {\n        super.emitReserved(\"error\", new TransportError(reason, description, context));\n        return this;\n    }\n    /**\n     * Opens the transport.\n     */\n    open() {\n        this.readyState = \"opening\";\n        this.doOpen();\n        return this;\n    }\n    /**\n     * Closes the transport.\n     */\n    close() {\n        if (this.readyState === \"opening\" || this.readyState === \"open\") {\n            this.doClose();\n            this.onClose();\n        }\n        return this;\n    }\n    /**\n     * Sends multiple packets.\n     *\n     * @param {Array} packets\n     */\n    send(packets) {\n        if (this.readyState === \"open\") {\n            this.write(packets);\n        }\n        else {\n            // this might happen if the transport was silently closed in the beforeunload event handler\n            debug(\"transport is not open, discarding packets\");\n        }\n    }\n    /**\n     * Called upon open\n     *\n     * @protected\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        this.writable = true;\n        super.emitReserved(\"open\");\n    }\n    /**\n     * Called with data.\n     *\n     * @param {String} data\n     * @protected\n     */\n    onData(data) {\n        const packet = (0, engine_io_parser_1.decodePacket)(data, this.socket.binaryType);\n        this.onPacket(packet);\n    }\n    /**\n     * Called with a decoded packet.\n     *\n     * @protected\n     */\n    onPacket(packet) {\n        super.emitReserved(\"packet\", packet);\n    }\n    /**\n     * Called upon close.\n     *\n     * @protected\n     */\n    onClose(details) {\n        this.readyState = \"closed\";\n        super.emitReserved(\"close\", details);\n    }\n    /**\n     * Pauses the transport, in order not to lose packets during an upgrade.\n     *\n     * @param onPause\n     */\n    pause(onPause) { }\n    createUri(schema, query = {}) {\n        return (schema +\n            \"://\" +\n            this._hostname() +\n            this._port() +\n            this.opts.path +\n            this._query(query));\n    }\n    _hostname() {\n        const hostname = this.opts.hostname;\n        return hostname.indexOf(\":\") === -1 ? hostname : \"[\" + hostname + \"]\";\n    }\n    _port() {\n        if (this.opts.port &&\n            ((this.opts.secure && Number(this.opts.port) !== 443) ||\n                (!this.opts.secure && Number(this.opts.port) !== 80))) {\n            return \":\" + this.opts.port;\n        }\n        else {\n            return \"\";\n        }\n    }\n    _query(query) {\n        const encodedQuery = (0, parseqs_js_1.encode)(query);\n        return encodedQuery.length ? \"?\" + encodedQuery : \"\";\n    }\n}\nexports.Transport = Transport;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.transports = void 0;\nconst polling_xhr_node_js_1 = require(\"./polling-xhr.node.js\");\nconst websocket_node_js_1 = require(\"./websocket.node.js\");\nconst webtransport_js_1 = require(\"./webtransport.js\");\nexports.transports = {\n    websocket: websocket_node_js_1.WS,\n    webtransport: webtransport_js_1.WT,\n    polling: polling_xhr_node_js_1.XHR,\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Fetch = void 0;\nconst polling_js_1 = require(\"./polling.js\");\n/**\n * HTTP long-polling based on the built-in `fetch()` method.\n *\n * Usage: browser, Node.js (since v18), Deno, Bun\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n * @see https://caniuse.com/fetch\n * @see https://nodejs.org/api/globals.html#fetch\n */\nclass Fetch extends polling_js_1.Polling {\n    doPoll() {\n        this._fetch()\n            .then((res) => {\n            if (!res.ok) {\n                return this.onError(\"fetch read error\", res.status, res);\n            }\n            res.text().then((data) => this.onData(data));\n        })\n            .catch((err) => {\n            this.onError(\"fetch read error\", err);\n        });\n    }\n    doWrite(data, callback) {\n        this._fetch(data)\n            .then((res) => {\n            if (!res.ok) {\n                return this.onError(\"fetch write error\", res.status, res);\n            }\n            callback();\n        })\n            .catch((err) => {\n            this.onError(\"fetch write error\", err);\n        });\n    }\n    _fetch(data) {\n        var _a;\n        const isPost = data !== undefined;\n        const headers = new Headers(this.opts.extraHeaders);\n        if (isPost) {\n            headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n        }\n        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);\n        return fetch(this.uri(), {\n            method: isPost ? \"POST\" : \"GET\",\n            body: isPost ? data : null,\n            headers,\n            credentials: this.opts.withCredentials ? \"include\" : \"omit\",\n        }).then((res) => {\n            var _a;\n            // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n            (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());\n            return res;\n        });\n    }\n}\nexports.Fetch = Fetch;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.XHR = exports.Request = exports.BaseXHR = void 0;\nconst polling_js_1 = require(\"./polling.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst util_js_1 = require(\"../util.js\");\nconst globals_node_js_1 = require(\"../globals.node.js\");\nconst has_cors_js_1 = require(\"../contrib/has-cors.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:polling\"); // debug()\nfunction empty() { }\nclass BaseXHR extends polling_js_1.Polling {\n    /**\n     * XHR Polling constructor.\n     *\n     * @param {Object} opts\n     * @package\n     */\n    constructor(opts) {\n        super(opts);\n        if (typeof location !== \"undefined\") {\n            const isSSL = \"https:\" === location.protocol;\n            let port = location.port;\n            // some user agents have empty `location.port`\n            if (!port) {\n                port = isSSL ? \"443\" : \"80\";\n            }\n            this.xd =\n                (typeof location !== \"undefined\" &&\n                    opts.hostname !== location.hostname) ||\n                    port !== opts.port;\n        }\n    }\n    /**\n     * Sends data.\n     *\n     * @param {String} data to send.\n     * @param {Function} called upon flush.\n     * @private\n     */\n    doWrite(data, fn) {\n        const req = this.request({\n            method: \"POST\",\n            data: data,\n        });\n        req.on(\"success\", fn);\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr post error\", xhrStatus, context);\n        });\n    }\n    /**\n     * Starts a poll cycle.\n     *\n     * @private\n     */\n    doPoll() {\n        debug(\"xhr poll\");\n        const req = this.request();\n        req.on(\"data\", this.onData.bind(this));\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr poll error\", xhrStatus, context);\n        });\n        this.pollXhr = req;\n    }\n}\nexports.BaseXHR = BaseXHR;\nclass Request extends component_emitter_1.Emitter {\n    /**\n     * Request constructor\n     *\n     * @param {Object} options\n     * @package\n     */\n    constructor(createRequest, uri, opts) {\n        super();\n        this.createRequest = createRequest;\n        (0, util_js_1.installTimerFunctions)(this, opts);\n        this._opts = opts;\n        this._method = opts.method || \"GET\";\n        this._uri = uri;\n        this._data = undefined !== opts.data ? opts.data : null;\n        this._create();\n    }\n    /**\n     * Creates the XHR object and sends the request.\n     *\n     * @private\n     */\n    _create() {\n        var _a;\n        const opts = (0, util_js_1.pick)(this._opts, \"agent\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"autoUnref\");\n        opts.xdomain = !!this._opts.xd;\n        const xhr = (this._xhr = this.createRequest(opts));\n        try {\n            debug(\"xhr open %s: %s\", this._method, this._uri);\n            xhr.open(this._method, this._uri, true);\n            try {\n                if (this._opts.extraHeaders) {\n                    // @ts-ignore\n                    xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);\n                    for (let i in this._opts.extraHeaders) {\n                        if (this._opts.extraHeaders.hasOwnProperty(i)) {\n                            xhr.setRequestHeader(i, this._opts.extraHeaders[i]);\n                        }\n                    }\n                }\n            }\n            catch (e) { }\n            if (\"POST\" === this._method) {\n                try {\n                    xhr.setRequestHeader(\"Content-type\", \"text/plain;charset=UTF-8\");\n                }\n                catch (e) { }\n            }\n            try {\n                xhr.setRequestHeader(\"Accept\", \"*/*\");\n            }\n            catch (e) { }\n            (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);\n            // ie6 check\n            if (\"withCredentials\" in xhr) {\n                xhr.withCredentials = this._opts.withCredentials;\n            }\n            if (this._opts.requestTimeout) {\n                xhr.timeout = this._opts.requestTimeout;\n            }\n            xhr.onreadystatechange = () => {\n                var _a;\n                if (xhr.readyState === 3) {\n                    (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(\n                    // @ts-ignore\n                    xhr.getResponseHeader(\"set-cookie\"));\n                }\n                if (4 !== xhr.readyState)\n                    return;\n                if (200 === xhr.status || 1223 === xhr.status) {\n                    this._onLoad();\n                }\n                else {\n                    // make sure the `error` event handler that's user-set\n                    // does not throw in the same tick and gets caught here\n                    this.setTimeoutFn(() => {\n                        this._onError(typeof xhr.status === \"number\" ? xhr.status : 0);\n                    }, 0);\n                }\n            };\n            debug(\"xhr data %s\", this._data);\n            xhr.send(this._data);\n        }\n        catch (e) {\n            // Need to defer since .create() is called directly from the constructor\n            // and thus the 'error' event can only be only bound *after* this exception\n            // occurs.  Therefore, also, we cannot throw here at all.\n            this.setTimeoutFn(() => {\n                this._onError(e);\n            }, 0);\n            return;\n        }\n        if (typeof document !== \"undefined\") {\n            this._index = Request.requestsCount++;\n            Request.requests[this._index] = this;\n        }\n    }\n    /**\n     * Called upon error.\n     *\n     * @private\n     */\n    _onError(err) {\n        this.emitReserved(\"error\", err, this._xhr);\n        this._cleanup(true);\n    }\n    /**\n     * Cleans up house.\n     *\n     * @private\n     */\n    _cleanup(fromError) {\n        if (\"undefined\" === typeof this._xhr || null === this._xhr) {\n            return;\n        }\n        this._xhr.onreadystatechange = empty;\n        if (fromError) {\n            try {\n                this._xhr.abort();\n            }\n            catch (e) { }\n        }\n        if (typeof document !== \"undefined\") {\n            delete Request.requests[this._index];\n        }\n        this._xhr = null;\n    }\n    /**\n     * Called upon load.\n     *\n     * @private\n     */\n    _onLoad() {\n        const data = this._xhr.responseText;\n        if (data !== null) {\n            this.emitReserved(\"data\", data);\n            this.emitReserved(\"success\");\n            this._cleanup();\n        }\n    }\n    /**\n     * Aborts the request.\n     *\n     * @package\n     */\n    abort() {\n        this._cleanup();\n    }\n}\nexports.Request = Request;\nRequest.requestsCount = 0;\nRequest.requests = {};\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\nif (typeof document !== \"undefined\") {\n    // @ts-ignore\n    if (typeof attachEvent === \"function\") {\n        // @ts-ignore\n        attachEvent(\"onunload\", unloadHandler);\n    }\n    else if (typeof addEventListener === \"function\") {\n        const terminationEvent = \"onpagehide\" in globals_node_js_1.globalThisShim ? \"pagehide\" : \"unload\";\n        addEventListener(terminationEvent, unloadHandler, false);\n    }\n}\nfunction unloadHandler() {\n    for (let i in Request.requests) {\n        if (Request.requests.hasOwnProperty(i)) {\n            Request.requests[i].abort();\n        }\n    }\n}\nconst hasXHR2 = (function () {\n    const xhr = newRequest({\n        xdomain: false,\n    });\n    return xhr && xhr.responseType !== null;\n})();\n/**\n * HTTP long-polling based on the built-in `XMLHttpRequest` object.\n *\n * Usage: browser\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n */\nclass XHR extends BaseXHR {\n    constructor(opts) {\n        super(opts);\n        const forceBase64 = opts && opts.forceBase64;\n        this.supportsBinary = hasXHR2 && !forceBase64;\n    }\n    request(opts = {}) {\n        Object.assign(opts, { xd: this.xd }, this.opts);\n        return new Request(newRequest, this.uri(), opts);\n    }\n}\nexports.XHR = XHR;\nfunction newRequest(opts) {\n    const xdomain = opts.xdomain;\n    // XMLHttpRequest can be disabled on IE\n    try {\n        if (\"undefined\" !== typeof XMLHttpRequest && (!xdomain || has_cors_js_1.hasCORS)) {\n            return new XMLHttpRequest();\n        }\n    }\n    catch (e) { }\n    if (!xdomain) {\n        try {\n            return new globals_node_js_1.globalThisShim[[\"Active\"].concat(\"Object\").join(\"X\")](\"Microsoft.XMLHTTP\");\n        }\n        catch (e) { }\n    }\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Polling = void 0;\nconst transport_js_1 = require(\"../transport.js\");\nconst util_js_1 = require(\"../util.js\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:polling\"); // debug()\nclass Polling extends transport_js_1.Transport {\n    constructor() {\n        super(...arguments);\n        this._polling = false;\n    }\n    get name() {\n        return \"polling\";\n    }\n    /**\n     * Opens the socket (triggers polling). We write a PING message to determine\n     * when the transport is open.\n     *\n     * @protected\n     */\n    doOpen() {\n        this._poll();\n    }\n    /**\n     * Pauses polling.\n     *\n     * @param {Function} onPause - callback upon buffers are flushed and transport is paused\n     * @package\n     */\n    pause(onPause) {\n        this.readyState = \"pausing\";\n        const pause = () => {\n            debug(\"paused\");\n            this.readyState = \"paused\";\n            onPause();\n        };\n        if (this._polling || !this.writable) {\n            let total = 0;\n            if (this._polling) {\n                debug(\"we are currently polling - waiting to pause\");\n                total++;\n                this.once(\"pollComplete\", function () {\n                    debug(\"pre-pause polling complete\");\n                    --total || pause();\n                });\n            }\n            if (!this.writable) {\n                debug(\"we are currently writing - waiting to pause\");\n                total++;\n                this.once(\"drain\", function () {\n                    debug(\"pre-pause writing complete\");\n                    --total || pause();\n                });\n            }\n        }\n        else {\n            pause();\n        }\n    }\n    /**\n     * Starts polling cycle.\n     *\n     * @private\n     */\n    _poll() {\n        debug(\"polling\");\n        this._polling = true;\n        this.doPoll();\n        this.emitReserved(\"poll\");\n    }\n    /**\n     * Overloads onData to detect payloads.\n     *\n     * @protected\n     */\n    onData(data) {\n        debug(\"polling got data %s\", data);\n        const callback = (packet) => {\n            // if its the first message we consider the transport open\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\n                this.onOpen();\n            }\n            // if its a close packet, we close the ongoing requests\n            if (\"close\" === packet.type) {\n                this.onClose({ description: \"transport closed by the server\" });\n                return false;\n            }\n            // otherwise bypass onData and handle the message\n            this.onPacket(packet);\n        };\n        // decode payload\n        (0, engine_io_parser_1.decodePayload)(data, this.socket.binaryType).forEach(callback);\n        // if an event did not trigger closing\n        if (\"closed\" !== this.readyState) {\n            // if we got data we're not polling\n            this._polling = false;\n            this.emitReserved(\"pollComplete\");\n            if (\"open\" === this.readyState) {\n                this._poll();\n            }\n            else {\n                debug('ignoring poll - transport state \"%s\"', this.readyState);\n            }\n        }\n    }\n    /**\n     * For polling, send a close packet.\n     *\n     * @protected\n     */\n    doClose() {\n        const close = () => {\n            debug(\"writing close packet\");\n            this.write([{ type: \"close\" }]);\n        };\n        if (\"open\" === this.readyState) {\n            debug(\"transport open - closing\");\n            close();\n        }\n        else {\n            // in case we're trying to close while\n            // handshaking is in progress (GH-164)\n            debug(\"transport not open - deferring close\");\n            this.once(\"open\", close);\n        }\n    }\n    /**\n     * Writes a packets payload.\n     *\n     * @param {Array} packets - data packets\n     * @protected\n     */\n    write(packets) {\n        this.writable = false;\n        (0, engine_io_parser_1.encodePayload)(packets, (data) => {\n            this.doWrite(data, () => {\n                this.writable = true;\n                this.emitReserved(\"drain\");\n            });\n        });\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"https\" : \"http\";\n        const query = this.query || {};\n        // cache busting is forced\n        if (false !== this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = (0, util_js_1.randomString)();\n        }\n        if (!this.supportsBinary && !query.sid) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\nexports.Polling = Polling;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WS = exports.BaseWS = void 0;\nconst transport_js_1 = require(\"../transport.js\");\nconst util_js_1 = require(\"../util.js\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst globals_node_js_1 = require(\"../globals.node.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:websocket\"); // debug()\n// detect ReactNative environment\nconst isReactNative = typeof navigator !== \"undefined\" &&\n    typeof navigator.product === \"string\" &&\n    navigator.product.toLowerCase() === \"reactnative\";\nclass BaseWS extends transport_js_1.Transport {\n    get name() {\n        return \"websocket\";\n    }\n    doOpen() {\n        const uri = this.uri();\n        const protocols = this.opts.protocols;\n        // React Native only supports the 'headers' option, and will print a warning if anything else is passed\n        const opts = isReactNative\n            ? {}\n            : (0, util_js_1.pick)(this.opts, \"agent\", \"perMessageDeflate\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"localAddress\", \"protocolVersion\", \"origin\", \"maxPayload\", \"family\", \"checkServerIdentity\");\n        if (this.opts.extraHeaders) {\n            opts.headers = this.opts.extraHeaders;\n        }\n        try {\n            this.ws = this.createSocket(uri, protocols, opts);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this.ws.binaryType = this.socket.binaryType;\n        this.addEventListeners();\n    }\n    /**\n     * Adds event listeners to the socket\n     *\n     * @private\n     */\n    addEventListeners() {\n        this.ws.onopen = () => {\n            if (this.opts.autoUnref) {\n                this.ws._socket.unref();\n            }\n            this.onOpen();\n        };\n        this.ws.onclose = (closeEvent) => this.onClose({\n            description: \"websocket connection closed\",\n            context: closeEvent,\n        });\n        this.ws.onmessage = (ev) => this.onData(ev.data);\n        this.ws.onerror = (e) => this.onError(\"websocket error\", e);\n    }\n    write(packets) {\n        this.writable = false;\n        // encodePacket efficient as it uses WS framing\n        // no need for encodePayload\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            (0, engine_io_parser_1.encodePacket)(packet, this.supportsBinary, (data) => {\n                // Sometimes the websocket has already been closed but the browser didn't\n                // have a chance of informing us about it yet, in that case send will\n                // throw an error\n                try {\n                    this.doWrite(packet, data);\n                }\n                catch (e) {\n                    debug(\"websocket closed before onclose event\");\n                }\n                if (lastPacket) {\n                    // fake drain\n                    // defer to next tick to allow Socket to clear writeBuffer\n                    (0, globals_node_js_1.nextTick)(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        if (typeof this.ws !== \"undefined\") {\n            this.ws.onerror = () => { };\n            this.ws.close();\n            this.ws = null;\n        }\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"wss\" : \"ws\";\n        const query = this.query || {};\n        // append timestamp to URI\n        if (this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = (0, util_js_1.randomString)();\n        }\n        // communicate binary support capabilities\n        if (!this.supportsBinary) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\nexports.BaseWS = BaseWS;\nconst WebSocketCtor = globals_node_js_1.globalThisShim.WebSocket || globals_node_js_1.globalThisShim.MozWebSocket;\n/**\n * WebSocket transport based on the built-in `WebSocket` object.\n *\n * Usage: browser, Node.js (since v21), Deno, Bun\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n * @see https://caniuse.com/mdn-api_websocket\n * @see https://nodejs.org/api/globals.html#websocket\n */\nclass WS extends BaseWS {\n    createSocket(uri, protocols, opts) {\n        return !isReactNative\n            ? protocols\n                ? new WebSocketCtor(uri, protocols)\n                : new WebSocketCtor(uri)\n            : new WebSocketCtor(uri, protocols, opts);\n    }\n    doWrite(_packet, data) {\n        this.ws.send(data);\n    }\n}\nexports.WS = WS;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WT = void 0;\nconst transport_js_1 = require(\"../transport.js\");\nconst globals_node_js_1 = require(\"../globals.node.js\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:webtransport\"); // debug()\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nclass WT extends transport_js_1.Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        try {\n            // @ts-ignore\n            this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed\n            .then(() => {\n            debug(\"transport closed gracefully\");\n            this.onClose();\n        })\n            .catch((err) => {\n            debug(\"transport closed due to %s\", err);\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n            this._transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = (0, engine_io_parser_1.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = (0, engine_io_parser_1.createPacketEncoderStream)();\n                encoderStream.readable.pipeTo(stream.writable);\n                this._writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            debug(\"session is closed\");\n                            return;\n                        }\n                        debug(\"received chunk: %o\", value);\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                        debug(\"an error occurred while reading: %s\", err);\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this._writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this._writer.write(packet).then(() => {\n                if (lastPacket) {\n                    (0, globals_node_js_1.nextTick)(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\nexports.WT = WT;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.pick = pick;\nexports.installTimerFunctions = installTimerFunctions;\nexports.byteLength = byteLength;\nexports.randomString = randomString;\nconst globals_node_js_1 = require(\"./globals.node.js\");\nfunction pick(obj, ...attr) {\n    return attr.reduce((acc, k) => {\n        if (obj.hasOwnProperty(k)) {\n            acc[k] = obj[k];\n        }\n        return acc;\n    }, {});\n}\n// Keep a reference to the real timeout functions so they can be used when overridden\nconst NATIVE_SET_TIMEOUT = globals_node_js_1.globalThisShim.setTimeout;\nconst NATIVE_CLEAR_TIMEOUT = globals_node_js_1.globalThisShim.clearTimeout;\nfunction installTimerFunctions(obj, opts) {\n    if (opts.useNativeTimers) {\n        obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globals_node_js_1.globalThisShim);\n        obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globals_node_js_1.globalThisShim);\n    }\n    else {\n        obj.setTimeoutFn = globals_node_js_1.globalThisShim.setTimeout.bind(globals_node_js_1.globalThisShim);\n        obj.clearTimeoutFn = globals_node_js_1.globalThisShim.clearTimeout.bind(globals_node_js_1.globalThisShim);\n    }\n}\n// base64 encoded buffers are about 33% bigger (https://en.wikipedia.org/wiki/Base64)\nconst BASE64_OVERHEAD = 1.33;\n// we could also have used `new Blob([obj]).size`, but it isn't supported in IE9\nfunction byteLength(obj) {\n    if (typeof obj === \"string\") {\n        return utf8Length(obj);\n    }\n    // arraybuffer or blob\n    return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);\n}\nfunction utf8Length(str) {\n    let c = 0, length = 0;\n    for (let i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length;\n}\n/**\n * Generates a random 8-characters string.\n */\nfunction randomString() {\n    return (Date.now().toString(36).substring(3) +\n        Math.random().toString(36).substring(2, 5));\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ERROR_PACKET = exports.PACKET_TYPES_REVERSE = exports.PACKET_TYPES = void 0;\nconst PACKET_TYPES = Object.create(null); // no Map = no polyfill\nexports.PACKET_TYPES = PACKET_TYPES;\nPACKET_TYPES[\"open\"] = \"0\";\nPACKET_TYPES[\"close\"] = \"1\";\nPACKET_TYPES[\"ping\"] = \"2\";\nPACKET_TYPES[\"pong\"] = \"3\";\nPACKET_TYPES[\"message\"] = \"4\";\nPACKET_TYPES[\"upgrade\"] = \"5\";\nPACKET_TYPES[\"noop\"] = \"6\";\nconst PACKET_TYPES_REVERSE = Object.create(null);\nexports.PACKET_TYPES_REVERSE = PACKET_TYPES_REVERSE;\nObject.keys(PACKET_TYPES).forEach((key) => {\n    PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;\n});\nconst ERROR_PACKET = { type: \"error\", data: \"parser error\" };\nexports.ERROR_PACKET = ERROR_PACKET;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decode = exports.encode = void 0;\n// imported from https://github.com/socketio/base64-arraybuffer\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nconst lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (let i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nconst encode = (arraybuffer) => {\n    let bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nexports.encode = encode;\nconst decode = (base64) => {\n    let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\nexports.decode = decode;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decodePacket = void 0;\nconst commons_js_1 = require(\"./commons.js\");\nconst base64_arraybuffer_js_1 = require(\"./contrib/base64-arraybuffer.js\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst decodePacket = (encodedPacket, binaryType) => {\n    if (typeof encodedPacket !== \"string\") {\n        return {\n            type: \"message\",\n            data: mapBinary(encodedPacket, binaryType),\n        };\n    }\n    const type = encodedPacket.charAt(0);\n    if (type === \"b\") {\n        return {\n            type: \"message\",\n            data: decodeBase64Packet(encodedPacket.substring(1), binaryType),\n        };\n    }\n    const packetType = commons_js_1.PACKET_TYPES_REVERSE[type];\n    if (!packetType) {\n        return commons_js_1.ERROR_PACKET;\n    }\n    return encodedPacket.length > 1\n        ? {\n            type: commons_js_1.PACKET_TYPES_REVERSE[type],\n            data: encodedPacket.substring(1),\n        }\n        : {\n            type: commons_js_1.PACKET_TYPES_REVERSE[type],\n        };\n};\nexports.decodePacket = decodePacket;\nconst decodeBase64Packet = (data, binaryType) => {\n    if (withNativeArrayBuffer) {\n        const decoded = (0, base64_arraybuffer_js_1.decode)(data);\n        return mapBinary(decoded, binaryType);\n    }\n    else {\n        return { base64: true, data }; // fallback for old browsers\n    }\n};\nconst mapBinary = (data, binaryType) => {\n    switch (binaryType) {\n        case \"blob\":\n            if (data instanceof Blob) {\n                // from WebSocket + binaryType \"blob\"\n                return data;\n            }\n            else {\n                // from HTTP long-polling or WebTransport\n                return new Blob([data]);\n            }\n        case \"arraybuffer\":\n        default:\n            if (data instanceof ArrayBuffer) {\n                // from HTTP long-polling (base64) or WebSocket + binaryType \"arraybuffer\"\n                return data;\n            }\n            else {\n                // from WebTransport (Uint8Array)\n                return data.buffer;\n            }\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.encodePacket = void 0;\nexports.encodePacketToBinary = encodePacketToBinary;\nconst commons_js_1 = require(\"./commons.js\");\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        Object.prototype.toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\n// ArrayBuffer.isView method is not defined in IE10\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj && obj.buffer instanceof ArrayBuffer;\n};\nconst encodePacket = ({ type, data }, supportsBinary, callback) => {\n    if (withNativeBlob && data instanceof Blob) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(data, callback);\n        }\n    }\n    else if (withNativeArrayBuffer &&\n        (data instanceof ArrayBuffer || isView(data))) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(new Blob([data]), callback);\n        }\n    }\n    // plain string\n    return callback(commons_js_1.PACKET_TYPES[type] + (data || \"\"));\n};\nexports.encodePacket = encodePacket;\nconst encodeBlobAsBase64 = (data, callback) => {\n    const fileReader = new FileReader();\n    fileReader.onload = function () {\n        const content = fileReader.result.split(\",\")[1];\n        callback(\"b\" + (content || \"\"));\n    };\n    return fileReader.readAsDataURL(data);\n};\nfunction toArray(data) {\n    if (data instanceof Uint8Array) {\n        return data;\n    }\n    else if (data instanceof ArrayBuffer) {\n        return new Uint8Array(data);\n    }\n    else {\n        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n}\nlet TEXT_ENCODER;\nfunction encodePacketToBinary(packet, callback) {\n    if (withNativeBlob && packet.data instanceof Blob) {\n        return packet.data.arrayBuffer().then(toArray).then(callback);\n    }\n    else if (withNativeArrayBuffer &&\n        (packet.data instanceof ArrayBuffer || isView(packet.data))) {\n        return callback(toArray(packet.data));\n    }\n    encodePacket(packet, false, (encoded) => {\n        if (!TEXT_ENCODER) {\n            TEXT_ENCODER = new TextEncoder();\n        }\n        callback(TEXT_ENCODER.encode(encoded));\n    });\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decodePayload = exports.decodePacket = exports.encodePayload = exports.encodePacket = exports.protocol = void 0;\nexports.createPacketEncoderStream = createPacketEncoderStream;\nexports.createPacketDecoderStream = createPacketDecoderStream;\nconst encodePacket_js_1 = require(\"./encodePacket.js\");\nObject.defineProperty(exports, \"encodePacket\", { enumerable: true, get: function () { return encodePacket_js_1.encodePacket; } });\nconst decodePacket_js_1 = require(\"./decodePacket.js\");\nObject.defineProperty(exports, \"decodePacket\", { enumerable: true, get: function () { return decodePacket_js_1.decodePacket; } });\nconst commons_js_1 = require(\"./commons.js\");\nconst SEPARATOR = String.fromCharCode(30); // see https://en.wikipedia.org/wiki/Delimiter#ASCII_delimited_text\nconst encodePayload = (packets, callback) => {\n    // some packets may be added to the array while encoding, so the initial length must be saved\n    const length = packets.length;\n    const encodedPackets = new Array(length);\n    let count = 0;\n    packets.forEach((packet, i) => {\n        // force base64 encoding for binary packets\n        (0, encodePacket_js_1.encodePacket)(packet, false, (encodedPacket) => {\n            encodedPackets[i] = encodedPacket;\n            if (++count === length) {\n                callback(encodedPackets.join(SEPARATOR));\n            }\n        });\n    });\n};\nexports.encodePayload = encodePayload;\nconst decodePayload = (encodedPayload, binaryType) => {\n    const encodedPackets = encodedPayload.split(SEPARATOR);\n    const packets = [];\n    for (let i = 0; i < encodedPackets.length; i++) {\n        const decodedPacket = (0, decodePacket_js_1.decodePacket)(encodedPackets[i], binaryType);\n        packets.push(decodedPacket);\n        if (decodedPacket.type === \"error\") {\n            break;\n        }\n    }\n    return packets;\n};\nexports.decodePayload = decodePayload;\nfunction createPacketEncoderStream() {\n    return new TransformStream({\n        transform(packet, controller) {\n            (0, encodePacket_js_1.encodePacketToBinary)(packet, (encodedPacket) => {\n                const payloadLength = encodedPacket.length;\n                let header;\n                // inspired by the WebSocket format: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#decoding_payload_length\n                if (payloadLength < 126) {\n                    header = new Uint8Array(1);\n                    new DataView(header.buffer).setUint8(0, payloadLength);\n                }\n                else if (payloadLength < 65536) {\n                    header = new Uint8Array(3);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 126);\n                    view.setUint16(1, payloadLength);\n                }\n                else {\n                    header = new Uint8Array(9);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 127);\n                    view.setBigUint64(1, BigInt(payloadLength));\n                }\n                // first bit indicates whether the payload is plain text (0) or binary (1)\n                if (packet.data && typeof packet.data !== \"string\") {\n                    header[0] |= 0x80;\n                }\n                controller.enqueue(header);\n                controller.enqueue(encodedPacket);\n            });\n        },\n    });\n}\nlet TEXT_DECODER;\nfunction totalLength(chunks) {\n    return chunks.reduce((acc, chunk) => acc + chunk.length, 0);\n}\nfunction concatChunks(chunks, size) {\n    if (chunks[0].length === size) {\n        return chunks.shift();\n    }\n    const buffer = new Uint8Array(size);\n    let j = 0;\n    for (let i = 0; i < size; i++) {\n        buffer[i] = chunks[0][j++];\n        if (j === chunks[0].length) {\n            chunks.shift();\n            j = 0;\n        }\n    }\n    if (chunks.length && j < chunks[0].length) {\n        chunks[0] = chunks[0].slice(j);\n    }\n    return buffer;\n}\nfunction createPacketDecoderStream(maxPayload, binaryType) {\n    if (!TEXT_DECODER) {\n        TEXT_DECODER = new TextDecoder();\n    }\n    const chunks = [];\n    let state = 0 /* State.READ_HEADER */;\n    let expectedLength = -1;\n    let isBinary = false;\n    return new TransformStream({\n        transform(chunk, controller) {\n            chunks.push(chunk);\n            while (true) {\n                if (state === 0 /* State.READ_HEADER */) {\n                    if (totalLength(chunks) < 1) {\n                        break;\n                    }\n                    const header = concatChunks(chunks, 1);\n                    isBinary = (header[0] & 0x80) === 0x80;\n                    expectedLength = header[0] & 0x7f;\n                    if (expectedLength < 126) {\n                        state = 3 /* State.READ_PAYLOAD */;\n                    }\n                    else if (expectedLength === 126) {\n                        state = 1 /* State.READ_EXTENDED_LENGTH_16 */;\n                    }\n                    else {\n                        state = 2 /* State.READ_EXTENDED_LENGTH_64 */;\n                    }\n                }\n                else if (state === 1 /* State.READ_EXTENDED_LENGTH_16 */) {\n                    if (totalLength(chunks) < 2) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 2);\n                    expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else if (state === 2 /* State.READ_EXTENDED_LENGTH_64 */) {\n                    if (totalLength(chunks) < 8) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 8);\n                    const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);\n                    const n = view.getUint32(0);\n                    if (n > Math.pow(2, 53 - 32) - 1) {\n                        // the maximum safe integer in JavaScript is 2^53 - 1\n                        controller.enqueue(commons_js_1.ERROR_PACKET);\n                        break;\n                    }\n                    expectedLength = n * Math.pow(2, 32) + view.getUint32(4);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else {\n                    if (totalLength(chunks) < expectedLength) {\n                        break;\n                    }\n                    const data = concatChunks(chunks, expectedLength);\n                    controller.enqueue((0, decodePacket_js_1.decodePacket)(isBinary ? data : TEXT_DECODER.decode(data), binaryType));\n                    state = 0 /* State.READ_HEADER */;\n                }\n                if (expectedLength === 0 || expectedLength > maxPayload) {\n                    controller.enqueue(commons_js_1.ERROR_PACKET);\n                    break;\n                }\n            }\n        },\n    });\n}\nexports.protocol = 4;\n","\"use strict\";\n/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Backoff = Backoff;\nfunction Backoff(opts) {\n    opts = opts || {};\n    this.ms = opts.min || 100;\n    this.max = opts.max || 10000;\n    this.factor = opts.factor || 2;\n    this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n    this.attempts = 0;\n}\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\nBackoff.prototype.duration = function () {\n    var ms = this.ms * Math.pow(this.factor, this.attempts++);\n    if (this.jitter) {\n        var rand = Math.random();\n        var deviation = Math.floor(rand * this.jitter * ms);\n        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;\n    }\n    return Math.min(ms, this.max) | 0;\n};\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\nBackoff.prototype.reset = function () {\n    this.attempts = 0;\n};\n/**\n * Set the minimum duration\n *\n * @api public\n */\nBackoff.prototype.setMin = function (min) {\n    this.ms = min;\n};\n/**\n * Set the maximum duration\n *\n * @api public\n */\nBackoff.prototype.setMax = function (max) {\n    this.max = max;\n};\n/**\n * Set the jitter\n *\n * @api public\n */\nBackoff.prototype.setJitter = function (jitter) {\n    this.jitter = jitter;\n};\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebTransport = exports.WebSocket = exports.NodeWebSocket = exports.XHR = exports.NodeXHR = exports.Fetch = exports.Socket = exports.Manager = exports.protocol = void 0;\nexports.io = lookup;\nexports.connect = lookup;\nexports.default = lookup;\nconst url_js_1 = require(\"./url.js\");\nconst manager_js_1 = require(\"./manager.js\");\nObject.defineProperty(exports, \"Manager\", { enumerable: true, get: function () { return manager_js_1.Manager; } });\nconst socket_js_1 = require(\"./socket.js\");\nObject.defineProperty(exports, \"Socket\", { enumerable: true, get: function () { return socket_js_1.Socket; } });\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client\"); // debug()\n/**\n * Managers cache.\n */\nconst cache = {};\nfunction lookup(uri, opts) {\n    if (typeof uri === \"object\") {\n        opts = uri;\n        uri = undefined;\n    }\n    opts = opts || {};\n    const parsed = (0, url_js_1.url)(uri, opts.path || \"/socket.io\");\n    const source = parsed.source;\n    const id = parsed.id;\n    const path = parsed.path;\n    const sameNamespace = cache[id] && path in cache[id][\"nsps\"];\n    const newConnection = opts.forceNew ||\n        opts[\"force new connection\"] ||\n        false === opts.multiplex ||\n        sameNamespace;\n    let io;\n    if (newConnection) {\n        debug(\"ignoring socket cache for %s\", source);\n        io = new manager_js_1.Manager(source, opts);\n    }\n    else {\n        if (!cache[id]) {\n            debug(\"new io instance for %s\", source);\n            cache[id] = new manager_js_1.Manager(source, opts);\n        }\n        io = cache[id];\n    }\n    if (parsed.query && !opts.query) {\n        opts.query = parsed.queryKey;\n    }\n    return io.socket(parsed.path, opts);\n}\n// so that \"lookup\" can be used both as a function (e.g. `io(...)`) and as a\n// namespace (e.g. `io.connect(...)`), for backward compatibility\nObject.assign(lookup, {\n    Manager: manager_js_1.Manager,\n    Socket: socket_js_1.Socket,\n    io: lookup,\n    connect: lookup,\n});\n/**\n * Protocol version.\n *\n * @public\n */\nvar socket_io_parser_1 = require(\"socket.io-parser\");\nObject.defineProperty(exports, \"protocol\", { enumerable: true, get: function () { return socket_io_parser_1.protocol; } });\nvar engine_io_client_1 = require(\"engine.io-client\");\nObject.defineProperty(exports, \"Fetch\", { enumerable: true, get: function () { return engine_io_client_1.Fetch; } });\nObject.defineProperty(exports, \"NodeXHR\", { enumerable: true, get: function () { return engine_io_client_1.NodeXHR; } });\nObject.defineProperty(exports, \"XHR\", { enumerable: true, get: function () { return engine_io_client_1.XHR; } });\nObject.defineProperty(exports, \"NodeWebSocket\", { enumerable: true, get: function () { return engine_io_client_1.NodeWebSocket; } });\nObject.defineProperty(exports, \"WebSocket\", { enumerable: true, get: function () { return engine_io_client_1.WebSocket; } });\nObject.defineProperty(exports, \"WebTransport\", { enumerable: true, get: function () { return engine_io_client_1.WebTransport; } });\n\nmodule.exports = lookup;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Manager = void 0;\nconst engine_io_client_1 = require(\"engine.io-client\");\nconst socket_js_1 = require(\"./socket.js\");\nconst parser = __importStar(require(\"socket.io-parser\"));\nconst on_js_1 = require(\"./on.js\");\nconst backo2_js_1 = require(\"./contrib/backo2.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client:manager\"); // debug()\nclass Manager extends component_emitter_1.Emitter {\n    constructor(uri, opts) {\n        var _a;\n        super();\n        this.nsps = {};\n        this.subs = [];\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = undefined;\n        }\n        opts = opts || {};\n        opts.path = opts.path || \"/socket.io\";\n        this.opts = opts;\n        (0, engine_io_client_1.installTimerFunctions)(this, opts);\n        this.reconnection(opts.reconnection !== false);\n        this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n        this.reconnectionDelay(opts.reconnectionDelay || 1000);\n        this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n        this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);\n        this.backoff = new backo2_js_1.Backoff({\n            min: this.reconnectionDelay(),\n            max: this.reconnectionDelayMax(),\n            jitter: this.randomizationFactor(),\n        });\n        this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n        this._readyState = \"closed\";\n        this.uri = uri;\n        const _parser = opts.parser || parser;\n        this.encoder = new _parser.Encoder();\n        this.decoder = new _parser.Decoder();\n        this._autoConnect = opts.autoConnect !== false;\n        if (this._autoConnect)\n            this.open();\n    }\n    reconnection(v) {\n        if (!arguments.length)\n            return this._reconnection;\n        this._reconnection = !!v;\n        if (!v) {\n            this.skipReconnect = true;\n        }\n        return this;\n    }\n    reconnectionAttempts(v) {\n        if (v === undefined)\n            return this._reconnectionAttempts;\n        this._reconnectionAttempts = v;\n        return this;\n    }\n    reconnectionDelay(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelay;\n        this._reconnectionDelay = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);\n        return this;\n    }\n    randomizationFactor(v) {\n        var _a;\n        if (v === undefined)\n            return this._randomizationFactor;\n        this._randomizationFactor = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);\n        return this;\n    }\n    reconnectionDelayMax(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelayMax;\n        this._reconnectionDelayMax = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);\n        return this;\n    }\n    timeout(v) {\n        if (!arguments.length)\n            return this._timeout;\n        this._timeout = v;\n        return this;\n    }\n    /**\n     * Starts trying to reconnect if reconnection is enabled and we have not\n     * started reconnecting yet\n     *\n     * @private\n     */\n    maybeReconnectOnOpen() {\n        // Only try to reconnect if it's the first time we're connecting\n        if (!this._reconnecting &&\n            this._reconnection &&\n            this.backoff.attempts === 0) {\n            // keeps reconnection from firing twice for the same reconnection loop\n            this.reconnect();\n        }\n    }\n    /**\n     * Sets the current transport `socket`.\n     *\n     * @param {Function} fn - optional, callback\n     * @return self\n     * @public\n     */\n    open(fn) {\n        debug(\"readyState %s\", this._readyState);\n        if (~this._readyState.indexOf(\"open\"))\n            return this;\n        debug(\"opening %s\", this.uri);\n        this.engine = new engine_io_client_1.Socket(this.uri, this.opts);\n        const socket = this.engine;\n        const self = this;\n        this._readyState = \"opening\";\n        this.skipReconnect = false;\n        // emit `open`\n        const openSubDestroy = (0, on_js_1.on)(socket, \"open\", function () {\n            self.onopen();\n            fn && fn();\n        });\n        const onError = (err) => {\n            debug(\"error\");\n            this.cleanup();\n            this._readyState = \"closed\";\n            this.emitReserved(\"error\", err);\n            if (fn) {\n                fn(err);\n            }\n            else {\n                // Only do this if there is no fn to handle the error\n                this.maybeReconnectOnOpen();\n            }\n        };\n        // emit `error`\n        const errorSub = (0, on_js_1.on)(socket, \"error\", onError);\n        if (false !== this._timeout) {\n            const timeout = this._timeout;\n            debug(\"connect attempt will timeout after %d\", timeout);\n            // set timer\n            const timer = this.setTimeoutFn(() => {\n                debug(\"connect attempt timed out after %d\", timeout);\n                openSubDestroy();\n                onError(new Error(\"timeout\"));\n                socket.close();\n            }, timeout);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n        this.subs.push(openSubDestroy);\n        this.subs.push(errorSub);\n        return this;\n    }\n    /**\n     * Alias for open()\n     *\n     * @return self\n     * @public\n     */\n    connect(fn) {\n        return this.open(fn);\n    }\n    /**\n     * Called upon transport open.\n     *\n     * @private\n     */\n    onopen() {\n        debug(\"open\");\n        // clear old subs\n        this.cleanup();\n        // mark as open\n        this._readyState = \"open\";\n        this.emitReserved(\"open\");\n        // add new subs\n        const socket = this.engine;\n        this.subs.push((0, on_js_1.on)(socket, \"ping\", this.onping.bind(this)), (0, on_js_1.on)(socket, \"data\", this.ondata.bind(this)), (0, on_js_1.on)(socket, \"error\", this.onerror.bind(this)), (0, on_js_1.on)(socket, \"close\", this.onclose.bind(this)), \n        // @ts-ignore\n        (0, on_js_1.on)(this.decoder, \"decoded\", this.ondecoded.bind(this)));\n    }\n    /**\n     * Called upon a ping.\n     *\n     * @private\n     */\n    onping() {\n        this.emitReserved(\"ping\");\n    }\n    /**\n     * Called with data.\n     *\n     * @private\n     */\n    ondata(data) {\n        try {\n            this.decoder.add(data);\n        }\n        catch (e) {\n            this.onclose(\"parse error\", e);\n        }\n    }\n    /**\n     * Called when parser fully decodes a packet.\n     *\n     * @private\n     */\n    ondecoded(packet) {\n        // the nextTick call prevents an exception in a user-provided event listener from triggering a disconnection due to a \"parse error\"\n        (0, engine_io_client_1.nextTick)(() => {\n            this.emitReserved(\"packet\", packet);\n        }, this.setTimeoutFn);\n    }\n    /**\n     * Called upon socket error.\n     *\n     * @private\n     */\n    onerror(err) {\n        debug(\"error\", err);\n        this.emitReserved(\"error\", err);\n    }\n    /**\n     * Creates a new socket for the given `nsp`.\n     *\n     * @return {Socket}\n     * @public\n     */\n    socket(nsp, opts) {\n        let socket = this.nsps[nsp];\n        if (!socket) {\n            socket = new socket_js_1.Socket(this, nsp, opts);\n            this.nsps[nsp] = socket;\n        }\n        else if (this._autoConnect && !socket.active) {\n            socket.connect();\n        }\n        return socket;\n    }\n    /**\n     * Called upon a socket close.\n     *\n     * @param socket\n     * @private\n     */\n    _destroy(socket) {\n        const nsps = Object.keys(this.nsps);\n        for (const nsp of nsps) {\n            const socket = this.nsps[nsp];\n            if (socket.active) {\n                debug(\"socket %s is still active, skipping close\", nsp);\n                return;\n            }\n        }\n        this._close();\n    }\n    /**\n     * Writes a packet.\n     *\n     * @param packet\n     * @private\n     */\n    _packet(packet) {\n        debug(\"writing packet %j\", packet);\n        const encodedPackets = this.encoder.encode(packet);\n        for (let i = 0; i < encodedPackets.length; i++) {\n            this.engine.write(encodedPackets[i], packet.options);\n        }\n    }\n    /**\n     * Clean up transport subscriptions and packet buffer.\n     *\n     * @private\n     */\n    cleanup() {\n        debug(\"cleanup\");\n        this.subs.forEach((subDestroy) => subDestroy());\n        this.subs.length = 0;\n        this.decoder.destroy();\n    }\n    /**\n     * Close the current socket.\n     *\n     * @private\n     */\n    _close() {\n        debug(\"disconnect\");\n        this.skipReconnect = true;\n        this._reconnecting = false;\n        this.onclose(\"forced close\");\n    }\n    /**\n     * Alias for close()\n     *\n     * @private\n     */\n    disconnect() {\n        return this._close();\n    }\n    /**\n     * Called when:\n     *\n     * - the low-level engine is closed\n     * - the parser encountered a badly formatted packet\n     * - all sockets are disconnected\n     *\n     * @private\n     */\n    onclose(reason, description) {\n        var _a;\n        debug(\"closed due to %s\", reason);\n        this.cleanup();\n        (_a = this.engine) === null || _a === void 0 ? void 0 : _a.close();\n        this.backoff.reset();\n        this._readyState = \"closed\";\n        this.emitReserved(\"close\", reason, description);\n        if (this._reconnection && !this.skipReconnect) {\n            this.reconnect();\n        }\n    }\n    /**\n     * Attempt a reconnection.\n     *\n     * @private\n     */\n    reconnect() {\n        if (this._reconnecting || this.skipReconnect)\n            return this;\n        const self = this;\n        if (this.backoff.attempts >= this._reconnectionAttempts) {\n            debug(\"reconnect failed\");\n            this.backoff.reset();\n            this.emitReserved(\"reconnect_failed\");\n            this._reconnecting = false;\n        }\n        else {\n            const delay = this.backoff.duration();\n            debug(\"will wait %dms before reconnect attempt\", delay);\n            this._reconnecting = true;\n            const timer = this.setTimeoutFn(() => {\n                if (self.skipReconnect)\n                    return;\n                debug(\"attempting reconnect\");\n                this.emitReserved(\"reconnect_attempt\", self.backoff.attempts);\n                // check again for the case socket closed in above events\n                if (self.skipReconnect)\n                    return;\n                self.open((err) => {\n                    if (err) {\n                        debug(\"reconnect attempt error\");\n                        self._reconnecting = false;\n                        self.reconnect();\n                        this.emitReserved(\"reconnect_error\", err);\n                    }\n                    else {\n                        debug(\"reconnect success\");\n                        self.onreconnect();\n                    }\n                });\n            }, delay);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n    }\n    /**\n     * Called upon successful reconnect.\n     *\n     * @private\n     */\n    onreconnect() {\n        const attempt = this.backoff.attempts;\n        this._reconnecting = false;\n        this.backoff.reset();\n        this.emitReserved(\"reconnect\", attempt);\n    }\n}\nexports.Manager = Manager;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.on = on;\nfunction on(obj, ev, fn) {\n    obj.on(ev, fn);\n    return function subDestroy() {\n        obj.off(ev, fn);\n    };\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Socket = void 0;\nconst socket_io_parser_1 = require(\"socket.io-parser\");\nconst on_js_1 = require(\"./on.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client:socket\"); // debug()\n/**\n * Internal events.\n * These events can't be emitted by the user.\n */\nconst RESERVED_EVENTS = Object.freeze({\n    connect: 1,\n    connect_error: 1,\n    disconnect: 1,\n    disconnecting: 1,\n    // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener\n    newListener: 1,\n    removeListener: 1,\n});\n/**\n * A Socket is the fundamental class for interacting with the server.\n *\n * A Socket belongs to a certain Namespace (by default /) and uses an underlying {@link Manager} to communicate.\n *\n * @example\n * const socket = io();\n *\n * socket.on(\"connect\", () => {\n *   console.log(\"connected\");\n * });\n *\n * // send an event to the server\n * socket.emit(\"foo\", \"bar\");\n *\n * socket.on(\"foobar\", () => {\n *   // an event was received from the server\n * });\n *\n * // upon disconnection\n * socket.on(\"disconnect\", (reason) => {\n *   console.log(`disconnected due to ${reason}`);\n * });\n */\nclass Socket extends component_emitter_1.Emitter {\n    /**\n     * `Socket` constructor.\n     */\n    constructor(io, nsp, opts) {\n        super();\n        /**\n         * Whether the socket is currently connected to the server.\n         *\n         * @example\n         * const socket = io();\n         *\n         * socket.on(\"connect\", () => {\n         *   console.log(socket.connected); // true\n         * });\n         *\n         * socket.on(\"disconnect\", () => {\n         *   console.log(socket.connected); // false\n         * });\n         */\n        this.connected = false;\n        /**\n         * Whether the connection state was recovered after a temporary disconnection. In that case, any missed packets will\n         * be transmitted by the server.\n         */\n        this.recovered = false;\n        /**\n         * Buffer for packets received before the CONNECT packet\n         */\n        this.receiveBuffer = [];\n        /**\n         * Buffer for packets that will be sent once the socket is connected\n         */\n        this.sendBuffer = [];\n        /**\n         * The queue of packets to be sent with retry in case of failure.\n         *\n         * Packets are sent one by one, each waiting for the server acknowledgement, in order to guarantee the delivery order.\n         * @private\n         */\n        this._queue = [];\n        /**\n         * A sequence to generate the ID of the {@link QueuedPacket}.\n         * @private\n         */\n        this._queueSeq = 0;\n        this.ids = 0;\n        /**\n         * A map containing acknowledgement handlers.\n         *\n         * The `withError` attribute is used to differentiate handlers that accept an error as first argument:\n         *\n         * - `socket.emit(\"test\", (err, value) => { ... })` with `ackTimeout` option\n         * - `socket.timeout(5000).emit(\"test\", (err, value) => { ... })`\n         * - `const value = await socket.emitWithAck(\"test\")`\n         *\n         * From those that don't:\n         *\n         * - `socket.emit(\"test\", (value) => { ... });`\n         *\n         * In the first case, the handlers will be called with an error when:\n         *\n         * - the timeout is reached\n         * - the socket gets disconnected\n         *\n         * In the second case, the handlers will be simply discarded upon disconnection, since the client will never receive\n         * an acknowledgement from the server.\n         *\n         * @private\n         */\n        this.acks = {};\n        this.flags = {};\n        this.io = io;\n        this.nsp = nsp;\n        if (opts && opts.auth) {\n            this.auth = opts.auth;\n        }\n        this._opts = Object.assign({}, opts);\n        if (this.io._autoConnect)\n            this.open();\n    }\n    /**\n     * Whether the socket is currently disconnected\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"connect\", () => {\n     *   console.log(socket.disconnected); // false\n     * });\n     *\n     * socket.on(\"disconnect\", () => {\n     *   console.log(socket.disconnected); // true\n     * });\n     */\n    get disconnected() {\n        return !this.connected;\n    }\n    /**\n     * Subscribe to open, close and packet events\n     *\n     * @private\n     */\n    subEvents() {\n        if (this.subs)\n            return;\n        const io = this.io;\n        this.subs = [\n            (0, on_js_1.on)(io, \"open\", this.onopen.bind(this)),\n            (0, on_js_1.on)(io, \"packet\", this.onpacket.bind(this)),\n            (0, on_js_1.on)(io, \"error\", this.onerror.bind(this)),\n            (0, on_js_1.on)(io, \"close\", this.onclose.bind(this)),\n        ];\n    }\n    /**\n     * Whether the Socket will try to reconnect when its Manager connects or reconnects.\n     *\n     * @example\n     * const socket = io();\n     *\n     * console.log(socket.active); // true\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   if (reason === \"io server disconnect\") {\n     *     // the disconnection was initiated by the server, you need to manually reconnect\n     *     console.log(socket.active); // false\n     *   }\n     *   // else the socket will automatically try to reconnect\n     *   console.log(socket.active); // true\n     * });\n     */\n    get active() {\n        return !!this.subs;\n    }\n    /**\n     * \"Opens\" the socket.\n     *\n     * @example\n     * const socket = io({\n     *   autoConnect: false\n     * });\n     *\n     * socket.connect();\n     */\n    connect() {\n        if (this.connected)\n            return this;\n        this.subEvents();\n        if (!this.io[\"_reconnecting\"])\n            this.io.open(); // ensure open\n        if (\"open\" === this.io._readyState)\n            this.onopen();\n        return this;\n    }\n    /**\n     * Alias for {@link connect()}.\n     */\n    open() {\n        return this.connect();\n    }\n    /**\n     * Sends a `message` event.\n     *\n     * This method mimics the WebSocket.send() method.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send\n     *\n     * @example\n     * socket.send(\"hello\");\n     *\n     * // this is equivalent to\n     * socket.emit(\"message\", \"hello\");\n     *\n     * @return self\n     */\n    send(...args) {\n        args.unshift(\"message\");\n        this.emit.apply(this, args);\n        return this;\n    }\n    /**\n     * Override `emit`.\n     * If the event is in `events`, it's emitted normally.\n     *\n     * @example\n     * socket.emit(\"hello\", \"world\");\n     *\n     * // all serializable datastructures are supported (no need to call JSON.stringify)\n     * socket.emit(\"hello\", 1, \"2\", { 3: [\"4\"], 5: Uint8Array.from([6]) });\n     *\n     * // with an acknowledgement from the server\n     * socket.emit(\"hello\", \"world\", (val) => {\n     *   // ...\n     * });\n     *\n     * @return self\n     */\n    emit(ev, ...args) {\n        var _a, _b, _c;\n        if (RESERVED_EVENTS.hasOwnProperty(ev)) {\n            throw new Error('\"' + ev.toString() + '\" is a reserved event name');\n        }\n        args.unshift(ev);\n        if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {\n            this._addToQueue(args);\n            return this;\n        }\n        const packet = {\n            type: socket_io_parser_1.PacketType.EVENT,\n            data: args,\n        };\n        packet.options = {};\n        packet.options.compress = this.flags.compress !== false;\n        // event ack callback\n        if (\"function\" === typeof args[args.length - 1]) {\n            const id = this.ids++;\n            debug(\"emitting packet with ack id %d\", id);\n            const ack = args.pop();\n            this._registerAckCallback(id, ack);\n            packet.id = id;\n        }\n        const isTransportWritable = (_b = (_a = this.io.engine) === null || _a === void 0 ? void 0 : _a.transport) === null || _b === void 0 ? void 0 : _b.writable;\n        const isConnected = this.connected && !((_c = this.io.engine) === null || _c === void 0 ? void 0 : _c._hasPingExpired());\n        const discardPacket = this.flags.volatile && !isTransportWritable;\n        if (discardPacket) {\n            debug(\"discard packet as the transport is not currently writable\");\n        }\n        else if (isConnected) {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        }\n        else {\n            this.sendBuffer.push(packet);\n        }\n        this.flags = {};\n        return this;\n    }\n    /**\n     * @private\n     */\n    _registerAckCallback(id, ack) {\n        var _a;\n        const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;\n        if (timeout === undefined) {\n            this.acks[id] = ack;\n            return;\n        }\n        // @ts-ignore\n        const timer = this.io.setTimeoutFn(() => {\n            delete this.acks[id];\n            for (let i = 0; i < this.sendBuffer.length; i++) {\n                if (this.sendBuffer[i].id === id) {\n                    debug(\"removing packet with ack id %d from the buffer\", id);\n                    this.sendBuffer.splice(i, 1);\n                }\n            }\n            debug(\"event with ack id %d has timed out after %d ms\", id, timeout);\n            ack.call(this, new Error(\"operation has timed out\"));\n        }, timeout);\n        const fn = (...args) => {\n            // @ts-ignore\n            this.io.clearTimeoutFn(timer);\n            ack.apply(this, args);\n        };\n        fn.withError = true;\n        this.acks[id] = fn;\n    }\n    /**\n     * Emits an event and waits for an acknowledgement\n     *\n     * @example\n     * // without timeout\n     * const response = await socket.emitWithAck(\"hello\", \"world\");\n     *\n     * // with a specific timeout\n     * try {\n     *   const response = await socket.timeout(1000).emitWithAck(\"hello\", \"world\");\n     * } catch (err) {\n     *   // the server did not acknowledge the event in the given delay\n     * }\n     *\n     * @return a Promise that will be fulfilled when the server acknowledges the event\n     */\n    emitWithAck(ev, ...args) {\n        return new Promise((resolve, reject) => {\n            const fn = (arg1, arg2) => {\n                return arg1 ? reject(arg1) : resolve(arg2);\n            };\n            fn.withError = true;\n            args.push(fn);\n            this.emit(ev, ...args);\n        });\n    }\n    /**\n     * Add the packet to the queue.\n     * @param args\n     * @private\n     */\n    _addToQueue(args) {\n        let ack;\n        if (typeof args[args.length - 1] === \"function\") {\n            ack = args.pop();\n        }\n        const packet = {\n            id: this._queueSeq++,\n            tryCount: 0,\n            pending: false,\n            args,\n            flags: Object.assign({ fromQueue: true }, this.flags),\n        };\n        args.push((err, ...responseArgs) => {\n            if (packet !== this._queue[0]) {\n                return debug(\"packet [%d] already acknowledged\", packet.id);\n            }\n            const hasError = err !== null;\n            if (hasError) {\n                if (packet.tryCount > this._opts.retries) {\n                    debug(\"packet [%d] is discarded after %d tries\", packet.id, packet.tryCount);\n                    this._queue.shift();\n                    if (ack) {\n                        ack(err);\n                    }\n                }\n            }\n            else {\n                debug(\"packet [%d] was successfully sent\", packet.id);\n                this._queue.shift();\n                if (ack) {\n                    ack(null, ...responseArgs);\n                }\n            }\n            packet.pending = false;\n            return this._drainQueue();\n        });\n        this._queue.push(packet);\n        this._drainQueue();\n    }\n    /**\n     * Send the first packet of the queue, and wait for an acknowledgement from the server.\n     * @param force - whether to resend a packet that has not been acknowledged yet\n     *\n     * @private\n     */\n    _drainQueue(force = false) {\n        debug(\"draining queue\");\n        if (!this.connected || this._queue.length === 0) {\n            return;\n        }\n        const packet = this._queue[0];\n        if (packet.pending && !force) {\n            debug(\"packet [%d] has already been sent and is waiting for an ack\", packet.id);\n            return;\n        }\n        packet.pending = true;\n        packet.tryCount++;\n        debug(\"sending packet [%d] (try n%d)\", packet.id, packet.tryCount);\n        this.flags = packet.flags;\n        this.emit.apply(this, packet.args);\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param packet\n     * @private\n     */\n    packet(packet) {\n        packet.nsp = this.nsp;\n        this.io._packet(packet);\n    }\n    /**\n     * Called upon engine `open`.\n     *\n     * @private\n     */\n    onopen() {\n        debug(\"transport is open - connecting\");\n        if (typeof this.auth == \"function\") {\n            this.auth((data) => {\n                this._sendConnectPacket(data);\n            });\n        }\n        else {\n            this._sendConnectPacket(this.auth);\n        }\n    }\n    /**\n     * Sends a CONNECT packet to initiate the Socket.IO session.\n     *\n     * @param data\n     * @private\n     */\n    _sendConnectPacket(data) {\n        this.packet({\n            type: socket_io_parser_1.PacketType.CONNECT,\n            data: this._pid\n                ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data)\n                : data,\n        });\n    }\n    /**\n     * Called upon engine or manager `error`.\n     *\n     * @param err\n     * @private\n     */\n    onerror(err) {\n        if (!this.connected) {\n            this.emitReserved(\"connect_error\", err);\n        }\n    }\n    /**\n     * Called upon engine `close`.\n     *\n     * @param reason\n     * @param description\n     * @private\n     */\n    onclose(reason, description) {\n        debug(\"close (%s)\", reason);\n        this.connected = false;\n        delete this.id;\n        this.emitReserved(\"disconnect\", reason, description);\n        this._clearAcks();\n    }\n    /**\n     * Clears the acknowledgement handlers upon disconnection, since the client will never receive an acknowledgement from\n     * the server.\n     *\n     * @private\n     */\n    _clearAcks() {\n        Object.keys(this.acks).forEach((id) => {\n            const isBuffered = this.sendBuffer.some((packet) => String(packet.id) === id);\n            if (!isBuffered) {\n                // note: handlers that do not accept an error as first argument are ignored here\n                const ack = this.acks[id];\n                delete this.acks[id];\n                if (ack.withError) {\n                    ack.call(this, new Error(\"socket has been disconnected\"));\n                }\n            }\n        });\n    }\n    /**\n     * Called with socket packet.\n     *\n     * @param packet\n     * @private\n     */\n    onpacket(packet) {\n        const sameNamespace = packet.nsp === this.nsp;\n        if (!sameNamespace)\n            return;\n        switch (packet.type) {\n            case socket_io_parser_1.PacketType.CONNECT:\n                if (packet.data && packet.data.sid) {\n                    this.onconnect(packet.data.sid, packet.data.pid);\n                }\n                else {\n                    this.emitReserved(\"connect_error\", new Error(\"It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)\"));\n                }\n                break;\n            case socket_io_parser_1.PacketType.EVENT:\n            case socket_io_parser_1.PacketType.BINARY_EVENT:\n                this.onevent(packet);\n                break;\n            case socket_io_parser_1.PacketType.ACK:\n            case socket_io_parser_1.PacketType.BINARY_ACK:\n                this.onack(packet);\n                break;\n            case socket_io_parser_1.PacketType.DISCONNECT:\n                this.ondisconnect();\n                break;\n            case socket_io_parser_1.PacketType.CONNECT_ERROR:\n                this.destroy();\n                const err = new Error(packet.data.message);\n                // @ts-ignore\n                err.data = packet.data.data;\n                this.emitReserved(\"connect_error\", err);\n                break;\n        }\n    }\n    /**\n     * Called upon a server event.\n     *\n     * @param packet\n     * @private\n     */\n    onevent(packet) {\n        const args = packet.data || [];\n        debug(\"emitting event %j\", args);\n        if (null != packet.id) {\n            debug(\"attaching ack callback to event\");\n            args.push(this.ack(packet.id));\n        }\n        if (this.connected) {\n            this.emitEvent(args);\n        }\n        else {\n            this.receiveBuffer.push(Object.freeze(args));\n        }\n    }\n    emitEvent(args) {\n        if (this._anyListeners && this._anyListeners.length) {\n            const listeners = this._anyListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, args);\n            }\n        }\n        super.emit.apply(this, args);\n        if (this._pid && args.length && typeof args[args.length - 1] === \"string\") {\n            this._lastOffset = args[args.length - 1];\n        }\n    }\n    /**\n     * Produces an ack callback to emit with an event.\n     *\n     * @private\n     */\n    ack(id) {\n        const self = this;\n        let sent = false;\n        return function (...args) {\n            // prevent double callbacks\n            if (sent)\n                return;\n            sent = true;\n            debug(\"sending ack %j\", args);\n            self.packet({\n                type: socket_io_parser_1.PacketType.ACK,\n                id: id,\n                data: args,\n            });\n        };\n    }\n    /**\n     * Called upon a server acknowledgement.\n     *\n     * @param packet\n     * @private\n     */\n    onack(packet) {\n        const ack = this.acks[packet.id];\n        if (typeof ack !== \"function\") {\n            debug(\"bad ack %s\", packet.id);\n            return;\n        }\n        delete this.acks[packet.id];\n        debug(\"calling ack %s with %j\", packet.id, packet.data);\n        // @ts-ignore FIXME ack is incorrectly inferred as 'never'\n        if (ack.withError) {\n            packet.data.unshift(null);\n        }\n        // @ts-ignore\n        ack.apply(this, packet.data);\n    }\n    /**\n     * Called upon server connect.\n     *\n     * @private\n     */\n    onconnect(id, pid) {\n        debug(\"socket connected with id %s\", id);\n        this.id = id;\n        this.recovered = pid && this._pid === pid;\n        this._pid = pid; // defined only if connection state recovery is enabled\n        this.connected = true;\n        this.emitBuffered();\n        this._drainQueue(true);\n        this.emitReserved(\"connect\");\n    }\n    /**\n     * Emit buffered events (received and emitted).\n     *\n     * @private\n     */\n    emitBuffered() {\n        this.receiveBuffer.forEach((args) => this.emitEvent(args));\n        this.receiveBuffer = [];\n        this.sendBuffer.forEach((packet) => {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        });\n        this.sendBuffer = [];\n    }\n    /**\n     * Called upon server disconnect.\n     *\n     * @private\n     */\n    ondisconnect() {\n        debug(\"server disconnect (%s)\", this.nsp);\n        this.destroy();\n        this.onclose(\"io server disconnect\");\n    }\n    /**\n     * Called upon forced client/server side disconnections,\n     * this method ensures the manager stops tracking us and\n     * that reconnections don't get triggered for this.\n     *\n     * @private\n     */\n    destroy() {\n        if (this.subs) {\n            // clean subscriptions to avoid reconnections\n            this.subs.forEach((subDestroy) => subDestroy());\n            this.subs = undefined;\n        }\n        this.io[\"_destroy\"](this);\n    }\n    /**\n     * Disconnects the socket manually. In that case, the socket will not try to reconnect.\n     *\n     * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   // console.log(reason); prints \"io client disconnect\"\n     * });\n     *\n     * socket.disconnect();\n     *\n     * @return self\n     */\n    disconnect() {\n        if (this.connected) {\n            debug(\"performing disconnect (%s)\", this.nsp);\n            this.packet({ type: socket_io_parser_1.PacketType.DISCONNECT });\n        }\n        // remove socket from pool\n        this.destroy();\n        if (this.connected) {\n            // fire events\n            this.onclose(\"io client disconnect\");\n        }\n        return this;\n    }\n    /**\n     * Alias for {@link disconnect()}.\n     *\n     * @return self\n     */\n    close() {\n        return this.disconnect();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @example\n     * socket.compress(false).emit(\"hello\");\n     *\n     * @param compress - if `true`, compresses the sending data\n     * @return self\n     */\n    compress(compress) {\n        this.flags.compress = compress;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not\n     * ready to send messages.\n     *\n     * @example\n     * socket.volatile.emit(\"hello\"); // the server may or may not receive it\n     *\n     * @returns self\n     */\n    get volatile() {\n        this.flags.volatile = true;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the callback will be called with an error when the\n     * given number of milliseconds have elapsed without an acknowledgement from the server:\n     *\n     * @example\n     * socket.timeout(5000).emit(\"my-event\", (err) => {\n     *   if (err) {\n     *     // the server did not acknowledge the event in the given delay\n     *   }\n     * });\n     *\n     * @returns self\n     */\n    timeout(timeout) {\n        this.flags.timeout = timeout;\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * @example\n     * socket.onAny((event, ...args) => {\n     *   console.log(`got ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * @example\n     * socket.prependAny((event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * }\n     *\n     * socket.onAny(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAny(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAny();\n     *\n     * @param listener\n     */\n    offAny(listener) {\n        if (!this._anyListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAny() {\n        return this._anyListeners || [];\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.onAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.prependAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * }\n     *\n     * socket.onAnyOutgoing(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAnyOutgoing(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAnyOutgoing();\n     *\n     * @param [listener] - the catch-all listener (optional)\n     */\n    offAnyOutgoing(listener) {\n        if (!this._anyOutgoingListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyOutgoingListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyOutgoingListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAnyOutgoing() {\n        return this._anyOutgoingListeners || [];\n    }\n    /**\n     * Notify the listeners for each packet sent\n     *\n     * @param packet\n     *\n     * @private\n     */\n    notifyOutgoingListeners(packet) {\n        if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {\n            const listeners = this._anyOutgoingListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, packet.data);\n            }\n        }\n    }\n}\nexports.Socket = Socket;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.url = url;\nconst engine_io_client_1 = require(\"engine.io-client\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client:url\"); // debug()\n/**\n * URL parser.\n *\n * @param uri - url\n * @param path - the request path of the connection\n * @param loc - An object meant to mimic window.location.\n *        Defaults to window.location.\n * @public\n */\nfunction url(uri, path = \"\", loc) {\n    let obj = uri;\n    // default to window.location\n    loc = loc || (typeof location !== \"undefined\" && location);\n    if (null == uri)\n        uri = loc.protocol + \"//\" + loc.host;\n    // relative path support\n    if (typeof uri === \"string\") {\n        if (\"/\" === uri.charAt(0)) {\n            if (\"/\" === uri.charAt(1)) {\n                uri = loc.protocol + uri;\n            }\n            else {\n                uri = loc.host + uri;\n            }\n        }\n        if (!/^(https?|wss?):\\/\\//.test(uri)) {\n            debug(\"protocol-less url %s\", uri);\n            if (\"undefined\" !== typeof loc) {\n                uri = loc.protocol + \"//\" + uri;\n            }\n            else {\n                uri = \"https://\" + uri;\n            }\n        }\n        // parse\n        debug(\"parse %s\", uri);\n        obj = (0, engine_io_client_1.parse)(uri);\n    }\n    // make sure we treat `localhost:80` and `localhost` equally\n    if (!obj.port) {\n        if (/^(http|ws)$/.test(obj.protocol)) {\n            obj.port = \"80\";\n        }\n        else if (/^(http|ws)s$/.test(obj.protocol)) {\n            obj.port = \"443\";\n        }\n    }\n    obj.path = obj.path || \"/\";\n    const ipv6 = obj.host.indexOf(\":\") !== -1;\n    const host = ipv6 ? \"[\" + obj.host + \"]\" : obj.host;\n    // define unique id\n    obj.id = obj.protocol + \"://\" + host + \":\" + obj.port + path;\n    // define href\n    obj.href =\n        obj.protocol +\n            \"://\" +\n            host +\n            (loc && loc.port === obj.port ? \"\" : \":\" + obj.port);\n    return obj;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.deconstructPacket = deconstructPacket;\nexports.reconstructPacket = reconstructPacket;\nconst is_binary_js_1 = require(\"./is-binary.js\");\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nfunction deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if ((0, is_binary_js_1.isBinary)(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nfunction reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n}\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Decoder = exports.Encoder = exports.PacketType = exports.protocol = void 0;\nexports.isPacketValid = isPacketValid;\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst binary_js_1 = require(\"./binary.js\");\nconst is_binary_js_1 = require(\"./is-binary.js\");\nconst debug_1 = require(\"debug\"); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-parser\"); // debug()\n/**\n * These strings must not be used as event names, as they have a special meaning.\n */\nconst RESERVED_EVENTS = [\n    \"connect\", // used on the client side\n    \"connect_error\", // used on the client side\n    \"disconnect\", // used on both sides\n    \"disconnecting\", // used on the server side\n    \"newListener\", // used by the Node.js EventEmitter\n    \"removeListener\", // used by the Node.js EventEmitter\n];\n/**\n * Protocol version.\n *\n * @public\n */\nexports.protocol = 5;\nvar PacketType;\n(function (PacketType) {\n    PacketType[PacketType[\"CONNECT\"] = 0] = \"CONNECT\";\n    PacketType[PacketType[\"DISCONNECT\"] = 1] = \"DISCONNECT\";\n    PacketType[PacketType[\"EVENT\"] = 2] = \"EVENT\";\n    PacketType[PacketType[\"ACK\"] = 3] = \"ACK\";\n    PacketType[PacketType[\"CONNECT_ERROR\"] = 4] = \"CONNECT_ERROR\";\n    PacketType[PacketType[\"BINARY_EVENT\"] = 5] = \"BINARY_EVENT\";\n    PacketType[PacketType[\"BINARY_ACK\"] = 6] = \"BINARY_ACK\";\n})(PacketType || (exports.PacketType = PacketType = {}));\n/**\n * A socket.io Encoder instance\n */\nclass Encoder {\n    /**\n     * Encoder constructor\n     *\n     * @param {function} replacer - custom replacer to pass down to JSON.parse\n     */\n    constructor(replacer) {\n        this.replacer = replacer;\n    }\n    /**\n     * Encode a packet as a single string if non-binary, or as a\n     * buffer sequence, depending on packet type.\n     *\n     * @param {Object} obj - packet object\n     */\n    encode(obj) {\n        debug(\"encoding packet %j\", obj);\n        if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {\n            if ((0, is_binary_js_1.hasBinary)(obj)) {\n                return this.encodeAsBinary({\n                    type: obj.type === PacketType.EVENT\n                        ? PacketType.BINARY_EVENT\n                        : PacketType.BINARY_ACK,\n                    nsp: obj.nsp,\n                    data: obj.data,\n                    id: obj.id,\n                });\n            }\n        }\n        return [this.encodeAsString(obj)];\n    }\n    /**\n     * Encode packet as string.\n     */\n    encodeAsString(obj) {\n        // first is type\n        let str = \"\" + obj.type;\n        // attachments if we have them\n        if (obj.type === PacketType.BINARY_EVENT ||\n            obj.type === PacketType.BINARY_ACK) {\n            str += obj.attachments + \"-\";\n        }\n        // if we have a namespace other than `/`\n        // we append it followed by a comma `,`\n        if (obj.nsp && \"/\" !== obj.nsp) {\n            str += obj.nsp + \",\";\n        }\n        // immediately followed by the id\n        if (null != obj.id) {\n            str += obj.id;\n        }\n        // json data\n        if (null != obj.data) {\n            str += JSON.stringify(obj.data, this.replacer);\n        }\n        debug(\"encoded %j as %s\", obj, str);\n        return str;\n    }\n    /**\n     * Encode packet as 'buffer sequence' by removing blobs, and\n     * deconstructing packet into object with placeholders and\n     * a list of buffers.\n     */\n    encodeAsBinary(obj) {\n        const deconstruction = (0, binary_js_1.deconstructPacket)(obj);\n        const pack = this.encodeAsString(deconstruction.packet);\n        const buffers = deconstruction.buffers;\n        buffers.unshift(pack); // add packet info to beginning of data list\n        return buffers; // write all the buffers\n    }\n}\nexports.Encoder = Encoder;\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n */\nclass Decoder extends component_emitter_1.Emitter {\n    /**\n     * Decoder constructor\n     *\n     * @param {function} reviver - custom reviver to pass down to JSON.stringify\n     */\n    constructor(reviver) {\n        super();\n        this.reviver = reviver;\n    }\n    /**\n     * Decodes an encoded packet string into packet JSON.\n     *\n     * @param {String} obj - encoded packet\n     */\n    add(obj) {\n        let packet;\n        if (typeof obj === \"string\") {\n            if (this.reconstructor) {\n                throw new Error(\"got plaintext data when reconstructing a packet\");\n            }\n            packet = this.decodeString(obj);\n            const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;\n            if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {\n                packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;\n                // binary packet's json\n                this.reconstructor = new BinaryReconstructor(packet);\n                // no attachments, labeled binary but no binary data to follow\n                if (packet.attachments === 0) {\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n            else {\n                // non-binary full packet\n                super.emitReserved(\"decoded\", packet);\n            }\n        }\n        else if ((0, is_binary_js_1.isBinary)(obj) || obj.base64) {\n            // raw binary data\n            if (!this.reconstructor) {\n                throw new Error(\"got binary data when not reconstructing a packet\");\n            }\n            else {\n                packet = this.reconstructor.takeBinaryData(obj);\n                if (packet) {\n                    // received final buffer\n                    this.reconstructor = null;\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n        }\n        else {\n            throw new Error(\"Unknown type: \" + obj);\n        }\n    }\n    /**\n     * Decode a packet String (JSON data)\n     *\n     * @param {String} str\n     * @return {Object} packet\n     */\n    decodeString(str) {\n        let i = 0;\n        // look up type\n        const p = {\n            type: Number(str.charAt(0)),\n        };\n        if (PacketType[p.type] === undefined) {\n            throw new Error(\"unknown packet type \" + p.type);\n        }\n        // look up attachments if type binary\n        if (p.type === PacketType.BINARY_EVENT ||\n            p.type === PacketType.BINARY_ACK) {\n            const start = i + 1;\n            while (str.charAt(++i) !== \"-\" && i != str.length) { }\n            const buf = str.substring(start, i);\n            if (buf != Number(buf) || str.charAt(i) !== \"-\") {\n                throw new Error(\"Illegal attachments\");\n            }\n            p.attachments = Number(buf);\n        }\n        // look up namespace (if any)\n        if (\"/\" === str.charAt(i + 1)) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (\",\" === c)\n                    break;\n                if (i === str.length)\n                    break;\n            }\n            p.nsp = str.substring(start, i);\n        }\n        else {\n            p.nsp = \"/\";\n        }\n        // look up id\n        const next = str.charAt(i + 1);\n        if (\"\" !== next && Number(next) == next) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (null == c || Number(c) != c) {\n                    --i;\n                    break;\n                }\n                if (i === str.length)\n                    break;\n            }\n            p.id = Number(str.substring(start, i + 1));\n        }\n        // look up json data\n        if (str.charAt(++i)) {\n            const payload = this.tryParse(str.substr(i));\n            if (Decoder.isPayloadValid(p.type, payload)) {\n                p.data = payload;\n            }\n            else {\n                throw new Error(\"invalid payload\");\n            }\n        }\n        debug(\"decoded %s as %j\", str, p);\n        return p;\n    }\n    tryParse(str) {\n        try {\n            return JSON.parse(str, this.reviver);\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    static isPayloadValid(type, payload) {\n        switch (type) {\n            case PacketType.CONNECT:\n                return isObject(payload);\n            case PacketType.DISCONNECT:\n                return payload === undefined;\n            case PacketType.CONNECT_ERROR:\n                return typeof payload === \"string\" || isObject(payload);\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                return (Array.isArray(payload) &&\n                    (typeof payload[0] === \"number\" ||\n                        (typeof payload[0] === \"string\" &&\n                            RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                return Array.isArray(payload);\n        }\n    }\n    /**\n     * Deallocates a parser's resources\n     */\n    destroy() {\n        if (this.reconstructor) {\n            this.reconstructor.finishedReconstruction();\n            this.reconstructor = null;\n        }\n    }\n}\nexports.Decoder = Decoder;\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n */\nclass BinaryReconstructor {\n    constructor(packet) {\n        this.packet = packet;\n        this.buffers = [];\n        this.reconPack = packet;\n    }\n    /**\n     * Method to be called when binary data received from connection\n     * after a BINARY_EVENT packet.\n     *\n     * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n     * @return {null | Object} returns null if more binary data is expected or\n     *   a reconstructed packet object if all buffers have been received.\n     */\n    takeBinaryData(binData) {\n        this.buffers.push(binData);\n        if (this.buffers.length === this.reconPack.attachments) {\n            // done with buffer list\n            const packet = (0, binary_js_1.reconstructPacket)(this.reconPack, this.buffers);\n            this.finishedReconstruction();\n            return packet;\n        }\n        return null;\n    }\n    /**\n     * Cleans up binary packet reconstruction variables.\n     */\n    finishedReconstruction() {\n        this.reconPack = null;\n        this.buffers = [];\n    }\n}\nfunction isNamespaceValid(nsp) {\n    return typeof nsp === \"string\";\n}\n// see https://caniuse.com/mdn-javascript_builtins_number_isinteger\nconst isInteger = Number.isInteger ||\n    function (value) {\n        return (typeof value === \"number\" &&\n            isFinite(value) &&\n            Math.floor(value) === value);\n    };\nfunction isAckIdValid(id) {\n    return id === undefined || isInteger(id);\n}\n// see https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript\nfunction isObject(value) {\n    return Object.prototype.toString.call(value) === \"[object Object]\";\n}\nfunction isDataValid(type, payload) {\n    switch (type) {\n        case PacketType.CONNECT:\n            return payload === undefined || isObject(payload);\n        case PacketType.DISCONNECT:\n            return payload === undefined;\n        case PacketType.EVENT:\n            return (Array.isArray(payload) &&\n                (typeof payload[0] === \"number\" ||\n                    (typeof payload[0] === \"string\" &&\n                        RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n        case PacketType.ACK:\n            return Array.isArray(payload);\n        case PacketType.CONNECT_ERROR:\n            return typeof payload === \"string\" || isObject(payload);\n        default:\n            return false;\n    }\n}\nfunction isPacketValid(packet) {\n    return (isNamespaceValid(packet.nsp) &&\n        isAckIdValid(packet.id) &&\n        isDataValid(packet.type, packet.data));\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isBinary = isBinary;\nexports.hasBinary = hasBinary;\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj.buffer instanceof ArrayBuffer;\n};\nconst toString = Object.prototype.toString;\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeFile = typeof File === \"function\" ||\n    (typeof File !== \"undefined\" &&\n        toString.call(File) === \"[object FileConstructor]\");\n/**\n * Returns true if obj is a Buffer, an ArrayBuffer, a Blob or a File.\n *\n * @private\n */\nfunction isBinary(obj) {\n    return ((withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj))) ||\n        (withNativeBlob && obj instanceof Blob) ||\n        (withNativeFile && obj instanceof File));\n}\nfunction hasBinary(obj, toJSON) {\n    if (!obj || typeof obj !== \"object\") {\n        return false;\n    }\n    if (Array.isArray(obj)) {\n        for (let i = 0, l = obj.length; i < l; i++) {\n            if (hasBinary(obj[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    if (isBinary(obj)) {\n        return true;\n    }\n    if (obj.toJSON &&\n        typeof obj.toJSON === \"function\" &&\n        arguments.length === 1) {\n        return hasBinary(obj.toJSON(), true);\n    }\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {\n            return true;\n        }\n    }\n    return false;\n}\n","/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nexport function Emitter(obj) {\n  if (obj) return mixin(obj);\n}\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n\n  // Remove event specific arrays for event types that no\n  // one is subscribed for to avoid memory leak.\n  if (callbacks.length === 0) {\n    delete this._callbacks['$' + event];\n  }\n\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n\n  var args = new Array(arguments.length - 1)\n    , callbacks = this._callbacks['$' + event];\n\n  for (var i = 1; i < arguments.length; i++) {\n    args[i - 1] = arguments[i];\n  }\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n// alias used for reserved events (protected method)\nEmitter.prototype.emitReserved = Emitter.prototype.emit;\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(2845);\n"],"names":["Object","defineProperty","exports","value","HDSItemDef","localizeText_1","constructor","key","definitionData","this","eventTypes","eventType","variations","options","map","o","data","label","localizeText","description","eventTemplate","streamIds","streamId","type","authorizationOverride","level1","level2","mixAuthorizationLevels","levels","sort","includes","Error","HDSModelAuthorizations","model","forItemKeys","itemKeys","opts","defaultLevel","preRequest","includeDefaultName","assign","streamsRequested","pre","JSON","stringify","defaultName","stream","streams","getDataById","name","level","itemKey","itemsDefs","forKey","auth","values","parents","getParentsIds","parent","found","HDSModelEventTypes","getEventTypeDefinition","modelData","types","getEventTypeExtra","extras","getEventTypeSymbol","symbol","HDSModelItemsDefs","HDSItemDef_1","item","push","keyStreamIdEventType","loadModelDataByStreamIdEventTypes","items","getAll","res","keys","throwErrorIfNotFound","defData","forEvent","event","candidates","candidate","length","c","join","HDSModelStreams","internalModelUtils_1","loadModelStreamsById","id","children","getNecessaryListForItems","itemKeysOrDefs","params","itemDefs","itemKeysOrDefsToDefs","knowExistingStreamsIds","nameProperty","result","Map","knowStreamId","strs","reverse","strId","set","itemDef","streamParentIds","resultToBeReversed","i","has","itemStream","parentId","streamData","initialArray","unshift","HDSModel","errors_1","utils_1","HDSModel_Streams_1","HDSModel_Authorizations_1","HDSModel_ItemsDefs_1","HDSModel_EventTypes_1","throwNotLoadedError","HDSLibError","laziliyLoadedMap","modelUrl","isLoaded","load","response","fetch","resultText","text","parse","entries","deepFreeze","authorizations","getModel","resetModel","hdsModelInstance","initHDSModel","async","service","HDSService_1","HDSService","serviceInfo","info","assets","HDSModel_1","keysOrDefs","keyOrDef","itemKeyOrDefToDef","ownKeys","__createBinding","create","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","__setModuleDefault","v","__importStar","getOwnPropertyNames","ar","prototype","hasOwnProperty","call","mod","settings","patchedPryv_1","pryv","Service","serviceInfoUrl","serviceCustomizations","super","getServiceInfoURL","AppClientAccount","Application_1","CollectorClient_1","logger","Application","baseStreamId","connection","appName","features","cache","collectorClientsMap","appSettings","canBePersonnal","mustBeMaster","handleIncomingRequest","apiEndpoint","incomingEventId","getCollectorClients","requesterConnection","Connection","accessInfo","collectorClientKey","CollectorClient","keyFromInfo","debug","collectorClient","requesterApiEndpoint","actual","incoming","requesterEventId","clientData","hdsCollector","version","getCollectorClientByKey","collectorKey","forceRefresh","collectorClientsMapInitialized","apiCalls","method","includeDeletions","limit","accessesRes","eventRes","api","accessHDSCollectorMap","access","accesses","hdsCollectorClient","events","accessData","checkConsistency","init","__importDefault","AppManagingAccount","short_unique_id_1","Collector_1","collectorIdGenerator","default","dictionary","appNameFromAccessInfo","getCollectors","collectorsMap","getCollectorById","loadStreamData","collector","Collector","createCollector","createCollectorUnitialized","rnd","apiOne","toolkit_1","APPS_ROOT_STREAM","findStreamByid","streamFromChildren","newFromApiEndpoint","newFromConnection","app","streamsAutoCreate","StreamsAutoCreate","attachToConnection","infos","isPersonalOrMaster","allowPersonalStr","masterFound","permissions","find","p","mustBemaster","e","innerObject","streamCreateResult","error","createAppStreams","setCustomSettings","content","getCustomSettings","customSettingsEvent","updatedEvent","update","createdEvent","setCustomSetting","currentCustomSettings","_a","CollectorRequest_1","CollectorInvite_1","COLLECTOR_STREAMID_SUFFIXES","archive","internal","public","pending","inbox","active","freeze","static","draft","deactivated","appManaging","request","CollectorRequest","initialized","invites","invitesInitialized","invitesInitializing","statusEvent","statusCode","status","checkStreamStructure","streamIdFor","STREAMID_SUFFIXES","statusEvents","STATUSES","loadFromStatusEvent","save","publish","publicEventData","eventData","CollectorInvite","getKeyForEvent","setEventData","getInviteByKey","getInvites","waitUntilFalse","queryParams","fromTime","toTime","getEventsStreamed","checkInbox","newCollectorInvites","responseEvents","responseEvent","inviteEvent","eventId","updateInvite","structuredClone","sourceEventId","chat","errorType","results","errors","filter","r","eventUpdated","inviteUpdated","createInvite","eventParams","customData","newInvite","sharingApiEndpoint","sharedAccessId","sharedAccess","feature","setting","newSharingApiEndpoint","requestParams","revokeInvite","invite","alreadyChecked","checkAndGetAccessInfo","deletionResult","accessDeletion","warn","childrenData","toCreate","suffix","child","created","resultsApi","resultCreate","message","inviteStatusForStreamId","refused","requesterUsername","user","username","requestData","requesterEventData","hasChatFeature","chatSettings","chatStreamIncoming","chatStreamMain","eventStatus","deleted","loadFromInviteEvent","publicStreamId","requesterEvents","reset","newStatus","extraData","newContent","accept","forceAndSkipAccessCreation","responseContent","delete","cleanedPermissions","chatStreamsCreateApiCalls","streamCreateResults","forEach","streamRead","streamWrite","accessCreateData","requesterEvent","revoke","Date","now","refuse","deactivatedDetail","deactivatedResult","console","log","getSections","sections","chatEventInfos","source","chatPost","hdsConnection","newEvent","dateCreation","hasChat","body","displayName","getSharingData","HDSModelInitAndSingleton_1","validateString","totest","url","setContent","potentialContent","requestContent","futureContent","numV","Number","parseInt","v0Data","forms","en","vo0ToV1","requester","requesterName","appId","appUrl","appCustomData","sectionData","section","createSection","setName","addItemKeys","addPermission","permissionsExtra","addPermissionExtra","addChatFeature","title","validateLocalizableText","consent","sectionsData","getData","getSectionByKey","CollectorRequestSection","s","addPermissions","permission","resetPermissions","splice","buildPermissions","addItemKey","localizedName","languageCode","setNameLocal","AppManagingAccount_1","AppClientAccount_1","toString","toolkit","l","appTemplates","getHDSModel","HDSModelInitAndSingleton","HDSLib","getPreferredLocales","preferredLocales","getSupportedLocales","supportedLocales","resetPreferredLocales","setPreferredLocales","textItem","toTest","optionalLang","arrayOfLocals","Array","isArray","unsupportedLocales","indexOf","Set","setLogger","newLogger","args","_args","monitor_1","socket_io_1","setServiceInfoURL","StreamsTools_1","knownStreams","knownStreamStructure","addStreamStructure","WeakRef","ensureExistsForItems","from","knowStreamIds","deref","streamsCreated","streamStructure","allStreamsAndChildren","getStreamIdAndChildrenIds","StreamTools","StreamsAutoCreate_1","callBackToReturnFalse","maxWaitMs","started","Promise","resolve","setTimeout","object","propNames","Reflect","EventEmitter","UpdateMethod","_updateEvents","_updateStreams","Changes","Monitor","apiEndpointOrConnection","eventsGetScope","MAX_VALUE","modifiedSince","states","starting","updatingEvents","updatingStreams","start","state","ready","updateEvents","updateEventRequired","emit","ERROR","bind","updateStreams","updateStreamsRequired","READY","stop","STOP","addUpdateMethod","updateMethod","setMonitor","module","updateRateMS","timer","isNaN","clearTimeout","monitor","socket","open","on","close","Null","Socket","EventsTimer","Pryv","EVENT","EVENT_DELETE","STREAMS","modified","io","EVENTS","SocketIO","connecting","_io","reject","then","socketEndpoint","endpoint","token","forceNew","errcode","myCode","ex","registerListeners","catch","checkOpen","eventName","listener","arrayOfAPICalls","progress","_chunkedBatchCall","batchCall","err","_socket","formatArgs","useColors","namespace","humanize","diff","color","index","lastC","replace","match","namespaces","storage","setItem","removeItem","getItem","process","env","DEBUG","window","__nwjs","navigator","userAgent","toLowerCase","document","documentElement","style","WebkitAppearance","firebug","exception","table","localStorage","localstorage","destroy","warned","colors","formatters","j","createDebug","prevTime","namespacesCache","enabledCache","enableOverride","enabled","self","curr","ms","prev","coerce","format","formatter","val","apply","selectColor","extend","delimiter","newDebug","matchesTemplate","search","template","searchIndex","templateIndex","starIndex","matchIndex","stack","disable","names","skips","enable","split","trim","Boolean","ns","slice","skip","hash","charCodeAt","Math","abs","ReflectOwnKeys","R","ReflectApply","target","receiver","Function","getOwnPropertySymbols","concat","NumberIsNaN","once","emitter","errorListener","removeListener","resolver","arguments","eventTargetAgnosticAddListener","handler","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","TypeError","_getMaxListeners","that","_addListener","prepend","existing","warning","newListener","w","String","count","onceWrapper","fired","wrapFn","_onceWrap","wrapped","_listeners","unwrap","evlistener","arr","ret","unwrapListeners","arrayClone","listenerCount","n","copy","flags","addEventListener","wrapListener","arg","removeEventListener","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","context","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","pop","spliceOne","off","removeAllListeners","rawListeners","eventNames","h","d","plural","msAbs","isPlural","round","str","exec","parseFloat","isFinite","long","fmtShort","utils","AuthStates","Messages","loginButton","authRequest","returnURL","getReturnURL","requestingAppId","requestedPermissions","stateChangeListeners","onStateChange","messages","infoSync","LOADING","authController","loadedAssets","location","loginButtonLoadCSS","thisMessages","loginButtonGetMessages","loadAssets","storedCredentials","getAuthorizationData","AUTHORIZED","checkAutoLogin","INITIALIZED","finishAuthProcessAfterRedirection","stopAuthRequest","msg","handleClick","startAuthRequest","NEED_SIGNIN","_state","SIGNOUT","windowLocationForTest","navigatorForTests","RETURN_URL_AUTO","trailer","returnUrlIsAuto","browserIsMobileOrTablet","href","substring","cleanURLFromPrYvParams","fetchPost","ok","doPolling","pollResponse","pollUrl","fetchGet","pollAccess","poll","poll_rate_ms","newState","REFUSED","definitions","myMessages","fr","LOGIN","SIGNOUT_CONFIRM","AuthController","LoginButton","setupAuth","HumanInteraction","humanInteraction","cookieKey","expireInDays","isBrowser","myDate","hostName","hostname","path","pathname","setDate","getDate","cookieStr","encodeURIComponent","toUTCString","cookie","parts","decodeURIComponent","del","Cookies","authSettings","loginBtn","loginButtonSpan","getElementById","spanButtonID","loginButtonText","onClick","innerHTML","loginButtonGetHTML","_cookieKey","serviceName","loginUrl","authUrl","screenX","screenLeft","screenY","screenTop","outerWidth","clientWidth","outerHeight","clientHeight","floor","popup","focus","startLoginScreen","saveAuthorizationData","confirm","deleteAuthorizationData","getErrorMessage","authData","getQueryParamsFromURL","prYvkey","prYvpoll","retrievePollUrl","CookieUtils","serviceInfoFromUrl","pryvServiceInfoUrl","jsonParser","libGetEventStreamed","PryvError","buildSearchParams","getTimestamp","extractTokenAndAPIEndpoint","chunkSize","_deltaTime","weight","_service","post","expectedKey","throwOnFail","usingConnection","callHandler","percent","cursor","thisBatch","cursorMax","min","resRequest","handleResult","_postFetch","_handleMeta","_postFetchRaw","contentType","headers","Authorization","Accept","json","_getFetchRaw","queryStr","addPointsToHFEvent","fields","points","forEachEvent","myParser","createEventWithFile","filePath","fs","fileName","basename","mimeType","getMimeType","extname","fileBlob","openAsBlob","formData","FormData","append","createEventWithFileFromBuffer","bufferData","filename","lastDot","lastIndexOf","getExtname","Blob","createEventWithFormData","deltaTime","buildAPIEndpoint","requestLocalTimestamp","meta","serverTime","MIME_TYPES","ext","Assets","_serviceInfo","_assets","_polling","_serviceInfoUrl","_pryvServiceCustomizations","forceFetch","baseServiceInfo","setServiceInfo","supportsHF","noHF","isDnsLess","setup","apiEndpointFor","login","password","originHeader","register","Origin","ServiceAssets","assetsURL","_assetsURL","pryvServiceAssetsSourceUrl","keyPath","getUrl","relativeURL","baseUrlString","sRelPath","baseLocation","createElement","nUpLn","nEnd","sDir","sPath","nStart","RegExp","portStr","port","protocol","substr","relPathToAbs","baseUrl","setAllDefaults","setFavicon","loadCSS","link","querySelector","rel","favicon","getElementsByTagName","appendChild","css","buttonSignIn","fetchGetText","html","head","media","Auth","Browser","captureStackTrace","searchParams","URLSearchParams","conn","queryParam","parser","parserSettings","ondata","onend","encoding","fakeRes","setEncoding","f","errResult","bodyObjectResult","bodyObject","URL","fetchParams","reader","getReader","done","read","TextDecoder","decode","pair","EVENTMARKERS","foreachEvent","eventOrEventDeletions","buffer","depth","inString","skipNextOne","cursorPos","eventsCount","eventDeletionsCount","processEvents","eventsOrDeletionMsg","ignoreComa","eventStr","addEvent","fn","chunk","searchStartEvents","processBuffer","err_","rawResponse","strEvent","regexAPIandToken","regexSchemaAndPath","myHeaders","lastIndex","endsWith","res2","tokenAndAPI","check","a","vendor","opera","test","vars","extractTokenAndApiEndpoint","buildPryvApiEndpoint","ShortUniqueId","__defProp","__getOwnPropDesc","__getOwnPropNames","__getOwnPropSymbols","__hasOwnProp","__propIsEnum","propertyIsEnumerable","__defNormalProp","obj","__spreadValues","b","prop","__publicField","index_exports","all","__export","DEFAULT_OPTIONS","DEFAULT_UUID_LENGTH","shuffle","counter","_ShortUniqueId","argOptions","digits","_digit_first_ascii","_digit_last_ascii","lowerCase","_alpha_lower_first_ascii","_alpha_lower_last_ascii","upperCase","_alpha_upper_first_ascii","_alpha_upper_last_ascii","decDigits","alphaDigits","_hex_last_ascii","_number_dict_ranges","_alpha_dict_ranges","_alpha_lower_dict_ranges","_alpha_upper_dict_ranges","_alphanum_dict_ranges","_alphanum_lower_dict_ranges","_alphanum_upper_dict_ranges","_hex_dict_ranges","finalArgs","finalDict","dictIndex","rangesName","ranges","_dict_ranges","capacity","rangeValue","lower","upper","dictIdx","rangeTypeValue","dictRange","lowerBound","upperBound","isAscending","end","fromCharCode","random","dict","_normalizeDictionary","dictLength","setCounter","sequentialUUID","dictLen","counterDiv","idParts","counterRem","trunc","uuidLength","randomUUID","randomPartIdx","date","formattedUUID","fnMap","$r","$s","$t","stamp","padStart","toFixed","rounds","availableUUIDs","cacheKey","cached","_collisionCache","sqrt","PI","approxMaxBeforeCollision","score","finalLength","hexStamp","idLength","rndIdx","suid","len2","_m","p1","p2","uid","finalDictionary","every","setDictionary","seq","fmt","collisionProbability","uniqueness","getVersion","parseStamp","to","except","__copyProps","hasCORS","XMLHttpRequest","encode","qs","qry","pairs","src","re","uri","host","authority","ipv6uri","pathNames","queryKey","query","$0","$1","$2","defaultBinaryType","globalThisShim","nextTick","createCookieJar","cb","setTimeoutFn","WebTransport","WebSocket","NodeWebSocket","XHR","NodeXHR","Fetch","installTimerFunctions","transports","TransportError","Transport","SocketWithUpgrade","SocketWithoutUpgrade","socket_js_1","socket_js_2","transport_js_1","index_js_1","util_js_1","parseuri_js_1","globals_node_js_1","polling_fetch_js_1","polling_xhr_node_js_1","polling_xhr_js_1","websocket_node_js_1","WS","websocket_js_1","webtransport_js_1","WT","parseqs_js_1","component_emitter_1","engine_io_parser_1","withEventListeners","OFFLINE_EVENT_LISTENERS","Emitter","binaryType","writeBuffer","_prevBufferLen","_pingInterval","_pingTimeout","_maxPayload","_pingTimeoutTime","Infinity","parsedUri","secure","_transportsByName","t","transportName","agent","withCredentials","upgrade","timestampParam","rememberUpgrade","addTrailingSlash","rejectUnauthorized","perMessageDeflate","threshold","transportOptions","closeOnBeforeunload","_beforeunloadEventListener","transport","_offlineEventListener","_onClose","_cookieJar","_open","createTransport","EIO","sid","emitReserved","priorWebsocketSuccess","readyState","setTransport","_onDrain","_onPacket","_onError","reason","onOpen","flush","packet","onHandshake","_sendPacket","_resetPingTimeout","code","pingInterval","pingTimeout","maxPayload","clearTimeoutFn","_pingTimeoutTimer","delay","autoUnref","unref","upgrading","packets","_getWritablePackets","send","payloadSize","byteLength","_hasPingExpired","hasExpired","write","compress","cleanupAndClose","waitForUpgrade","tryAllTransports","_upgrades","_probe","failed","onTransportOpen","pause","cleanup","freezeTransport","onerror","onTransportClose","onclose","onupgrade","_filterUpgrades","upgrades","filteredUpgrades","supportsBinary","forceBase64","onError","doOpen","doClose","onClose","onData","decodePacket","onPacket","details","onPause","createUri","schema","_hostname","_port","_query","encodedQuery","websocket","webtransport","polling","polling_js_1","Polling","doPoll","_fetch","doWrite","callback","isPost","Headers","extraHeaders","appendCookies","credentials","parseCookies","getSetCookie","Request","BaseXHR","has_cors_js_1","empty","isSSL","xd","req","xhrStatus","pollXhr","createRequest","_opts","_method","_uri","_data","_create","pick","xdomain","xhr","_xhr","setDisableHeaderCheck","setRequestHeader","cookieJar","addCookies","requestTimeout","timeout","onreadystatechange","getResponseHeader","_onLoad","_index","requestsCount","requests","_cleanup","fromError","abort","responseText","attachEvent","unloadHandler","terminationEvent","hasXHR2","newRequest","responseType","_poll","total","decodePayload","encodePayload","timestampRequests","randomString","b64","BaseWS","isReactNative","product","protocols","ws","createSocket","addEventListeners","onopen","closeEvent","onmessage","ev","lastPacket","encodePacket","WebSocketCtor","MozWebSocket","_packet","_transport","closed","createBidirectionalStream","decoderStream","createPacketDecoderStream","MAX_SAFE_INTEGER","readable","pipeThrough","encoderStream","createPacketEncoderStream","pipeTo","_writer","getWriter","attr","reduce","acc","useNativeTimers","NATIVE_SET_TIMEOUT","NATIVE_CLEAR_TIMEOUT","utf8Length","ceil","size","ERROR_PACKET","PACKET_TYPES_REVERSE","PACKET_TYPES","chars","lookup","Uint8Array","arraybuffer","bytes","base64","encoded1","encoded2","encoded3","encoded4","bufferLength","ArrayBuffer","commons_js_1","base64_arraybuffer_js_1","withNativeArrayBuffer","encodedPacket","mapBinary","charAt","decodeBase64Packet","decoded","encodePacketToBinary","withNativeBlob","arrayBuffer","toArray","isView","encoded","TEXT_ENCODER","TextEncoder","encodeBlobAsBase64","fileReader","FileReader","onload","readAsDataURL","byteOffset","TransformStream","transform","controller","encodePacket_js_1","payloadLength","header","DataView","setUint8","view","setUint16","setBigUint64","BigInt","enqueue","TEXT_DECODER","chunks","expectedLength","isBinary","totalLength","concatChunks","headerArray","getUint16","getUint32","pow","decodePacket_js_1","SEPARATOR","encodedPackets","encodedPayload","decodedPacket","Backoff","max","factor","jitter","attempts","duration","rand","deviation","setMin","setMax","setJitter","Manager","connect","url_js_1","manager_js_1","parsed","sameNamespace","multiplex","socket_io_parser_1","engine_io_client_1","on_js_1","backo2_js_1","nsps","subs","reconnection","reconnectionAttempts","reconnectionDelay","reconnectionDelayMax","randomizationFactor","backoff","_readyState","_parser","encoder","Encoder","decoder","Decoder","_autoConnect","autoConnect","_reconnection","skipReconnect","_reconnectionAttempts","_reconnectionDelay","_randomizationFactor","_reconnectionDelayMax","_timeout","maybeReconnectOnOpen","_reconnecting","reconnect","engine","openSubDestroy","errorSub","onping","ondecoded","add","nsp","_destroy","_close","subDestroy","disconnect","onreconnect","attempt","RESERVED_EVENTS","connect_error","disconnecting","connected","recovered","receiveBuffer","sendBuffer","_queue","_queueSeq","ids","acks","disconnected","subEvents","onpacket","_b","_c","retries","fromQueue","volatile","_addToQueue","PacketType","ack","_registerAckCallback","isTransportWritable","isConnected","notifyOutgoingListeners","ackTimeout","withError","emitWithAck","arg1","arg2","tryCount","responseArgs","_drainQueue","force","_sendConnectPacket","CONNECT","_pid","pid","offset","_lastOffset","_clearAcks","some","onconnect","BINARY_EVENT","onevent","ACK","BINARY_ACK","onack","DISCONNECT","ondisconnect","CONNECT_ERROR","emitEvent","_anyListeners","sent","emitBuffered","onAny","prependAny","offAny","listenersAny","onAnyOutgoing","_anyOutgoingListeners","prependAnyOutgoing","offAnyOutgoing","listenersAnyOutgoing","loc","deconstructPacket","buffers","packetData","pack","_deconstructPacket","attachments","reconstructPacket","_reconstructPacket","is_binary_js_1","placeholder","_placeholder","num","newData","isPacketValid","isInteger","payload","isObject","isDataValid","binary_js_1","replacer","hasBinary","encodeAsString","encodeAsBinary","deconstruction","reviver","reconstructor","decodeString","isBinaryEvent","BinaryReconstructor","takeBinaryData","buf","next","tryParse","isPayloadValid","finishedReconstruction","reconPack","binData","toJSON","withNativeFile","File","mixin","_callbacks","callbacks","hasListeners","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","definition","Symbol","toStringTag","__webpack_exports__"],"sourceRoot":""}